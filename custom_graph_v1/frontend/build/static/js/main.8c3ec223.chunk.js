(this.webpackJsonpstreamlit_custom_graph=this.webpackJsonpstreamlit_custom_graph||[]).push([[0],{14:function(t,e,a){t.exports=a(30)},30:function(t,e,a){"use strict";a.r(e);var s=a(2),o=a.n(s),r=a(12),n=a.n(r),i=a(7),l=a(8),c=a.n(l),h=a(9),p=a(6),d=a.n(p),g=(a(25),a(32)),m=i.a.CanvasJSChart,u=i.a.CanvasJS;const x=[[],[],[],[],[],[],[],[],[],[]];d.a.options={positionClass:"toast-top-full-width",hideDuration:300,timeOut:3e3};class f extends s.Component{constructor(t){super(t),this.updateChart=this.updateChart.bind(this),this.toggleDataSeries=this.toggleDataSeries.bind(this)}componentDidMount(){const{kwargs:t}=this.props.args,{refresh_sec:e}=t;h.a.setFrameHeight(),this.updateChart(),e&&setInterval(this.updateChart,1e3*e)}toggleDataSeries(t){"undefined"===typeof t.dataSeries.visible||t.dataSeries.visible?t.dataSeries.visible=!1:t.dataSeries.visible=!0,this.chart.render()}toggleDataSeries(){const{chartType:t}=this.state,e="spline"===t?"candlestick":"spline";this.setState({chartType:e},()=>{const{kwargs:t}=this.props.args,a=t.data.map(t=>({x:new Date(t.timestamp_est),y:[t.open,t.high,t.low,t.close]}));this.chart.options.data[0].type=e,this.chart.options.data[0].dataPoints=a,this.chart.render()})}async fetchGraphData(){const{kwargs:t}=this.props.args,{api:e}=t;console.log("sdkhgfvbosdjk",t);const a=await g.a.post(e,{...t});return JSON.parse(a.data)}async updateChart(){const{kwargs:t}=this.props.args,{x_axis:e,y_axis:a,refresh_sec:s,refresh_button:o,theme_options:r}=t;try{const t=await this.fetchGraphData(),n=[];for(a.map((a,s)=>n[s]=t.map((s,o)=>o===t.length-1&&r.showInLegendPerLine?{x:s[e.field],y:s[a.field],indexLabel:a.name+" "+s[a.field].toFixed(3)+"                        \n.",indexLabelFontColor:a.color}:{x:s[e.field],y:s[a.field]}));x[0].length;)a.map((t,e)=>x[e].pop());console.log("fetchGraphData",x),a.map((t,e)=>(x[e].push(...n[e]),this.chart.options.data[e].legendText=t.name+n[e].pop().y));const i=this.state.chartType;if("spline"===i)this.chart.options.data.forEach((t,e)=>{t.type="spline",t.dataPoints=x[e]});else if("candlestick"===i){const e=t.map(t=>({x:new Date(t.timestamp_est),y:[t.open,t.high,t.low,t.close]}));this.chart.options.data[0].type="candlestick",this.chart.options.data[0].dataPoints=e}this.chart.render(),o&&!s&&d.a.success("Success!")}catch(n){o&&!s&&d.a.error("Fetch Error: ".concat(n.message))}}render(){const t=[],{kwargs:e}=this.props.args,{y_axis:a,y_max:s,refresh_sec:r,theme_options:n,refresh_button:i}=e,l=a.map((e,a)=>(t.push(e.color),{type:"spline",xValueFormatString:"#.##0 ",yValueFormatString:"#.##0",showInLegend:n.showInLegend,name:e.name,dataPoints:x[a]}));u.addColorSet("greenShades",t);const h={colorSet:"greenShades",backgroundColor:n.backgroundColor?n.backgroundColor:"white",zoomEnabled:!0,title:{text:n.main_title?n.main_title:""},axisX:{title:n.x_axis_title?n.x_axis_title:"",labelFormatter:t=>c()(t.value).format("DD/MM/YYYY hh"),labelFontSize:12},axisY:{suffix:"",maximum:s||null,gridColor:n.grid_color?n.grid_color:""},toolTip:{shared:!0,contentFormatter:function(t){let e="";const a=c()(t.entries[0].dataPoint.x).format("DD/MM/YYYY HH:mm");e+="<strong>Date</strong>: ".concat(a,"<br/>");for(let s=1;s<t.entries.length;s++){const a=t.entries[s],o=a.dataSeries,r=a.dataPoint,n=o.color?o.color:o.options.color;e+='<strong style="color: '.concat(n,'">').concat(o.name,"</strong>: ").concat(r.y,"<br/>")}return e}},legend:{cursor:"pointer",verticalAlign:"top",fontSize:18,fontColor:"dimGrey",itemclick:this.toggleDataSeries},data:l,height:e.graph_height?e.graph_height:400};return o.a.createElement("div",null,i&&!r&&o.a.createElement("div",{style:{display:"flex"}},o.a.createElement("div",{style:{margin:"10px 10px 10px 2px"}},o.a.createElement("button",{className:"btn btn-warning",onClick:this.updateChart},"Refresh")),o.a.createElement("div",{style:{margin:"10px 10px 10px 2px"}},o.a.createElement("button",{className:"btn btn-warning",onClick:this.toggleDataSeries},"Toggle Chart"))),o.a.createElement(m,{options:h,onRef:t=>this.chart=t}))}}var b=Object(h.b)(f);n.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(b,null)),document.getElementById("root"))}},[[14,1,2]]]);
//# sourceMappingURL=main.8c3ec223.chunk.js.map