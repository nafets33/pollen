{"version":3,"sources":["components/Modal.tsx","utils.js","Aggrid.tsx","Main.tsx","index.tsx"],"names":["formats","sliderRules","sliderRules_stars","sliderRules_stars_margin","map","rule","ReactModal","setAppElement","isExecuting","MyModal","_ref","isOpen","closeModal","modalData","promptText","setPromptText","toastr","prompt_field","prompt_order_rules","selectedRow","selectedField","add_symbol_row_info","display_grid_column","showStarsSliders","setShowStarsSliders","React","useState","showStarsMarginSliders","setShowStarsMarginSliders","showActiveOrders","setShowActiveOrders","showWaveData","setShowWaveData","showButtonColData","setShowButtonColData","sellQtys","setSellQtys","editableValues","setEditableValues","editableCols","ordersToRender","Array","isArray","dataCols","length","Object","keys","editableColHeaders","col","col_header","allCols","from","Set","ref","useRef","useEffect","setTimeout","_ref$current","current","focus","orders","reset","forEach","_ref2","order","idx","_order$col_header","isValidDate","dateStr","some","format","moment","isValid","formatToLocalDatetime","date","toDate","timeZone","Intl","DateTimeFormat","resolvedOptions","zonedDate","utcToZonedTime","textFields","booleanFields","datetimeFields","arrayFields","filter","field","value","push","createElement","onRequestClose","ariaHideApp","className","style","position","prompt_message","onClick","right","border","borderRadius","padding","background","index","key","marginRight","minWidth","textAlign","fontSize","type","checked","onChange","e","target","width","height","marginTop","flex","marginBottom","undefined","paddingRight","Number","toLocaleString","maximumFractionDigits","String","includes","isSliderRule","marginLeft","cursor","title","Fragment","min","max","step","fontWeight","item","i","prev","margin","textDecoration","color","overflowX","editableCol","find","ec","whiteSpace","wordWrap","backgroundColor","display","alignItems","justifyContent","display_name","replace","info","_editableValues$col","qty_available","num","updatedOrders","ord","_editableValues$col2","sell_qty","active_orders_with_qty","dtype","_editableValues$col3","options","values","disabled","option","_editableValues$col4","_editableValues$col5","_editableValues$col6","_editableValues$col7","sum","reduce","acc","val","isNaN","hasNumeric","bottom","async","error","ordersWithEdits","edits","_editableValues$col$c","body","username","prod","selected_row","default_value","editable_orders","kwargs","data","res","axios","post","button_api","status","description","message_type","success","alert","close_modal","console","log","message","mapObject","obj","fn","keysToIgnore","deepMap","arguments","deepMapper","g_rowdata","g_newRowData","dateFormatter","isoString","formaterString","Date","currencyFormatter","number","currencySymbol","n","parseFloat","toFixed","numberFormatter","precision","HyperlinkRenderer","props","linkField","column","colDef","baseURL","linkValue","href","rel","positionClass","hideDuration","timeOut","AgGrid","BtnCellRenderer","node","rowPinned","subtotalStyle","cellStyle","btnClickedHandler","clicked","id","buttonName","buildDetailGridOptions","detailGridOptions","level","masterDetail","getDetailRowData","params","nestedRows","successCallback","detailCellRendererParams","gridRef","api","api_update","api_ws","refresh_sec","refresh_cutoff_sec","enable_JsCode","grid_options","parseJsCodeFromPython","subtotalsRow","setSubtotalsRow","buttons","toggle_views","api_key","api_lastmod_key","columnOrder","refresh_success","total_col","subtotal_cols","filter_button","rowData","setRowData","modalShow","setModalshow","setModalData","viewId","setViewId","lastModified","setLastModified","previousViewId","setpreviousViewId","activeFilter","setActiveFilter","selectedColumnSetKeys","setSelectedColumnSetKeys","initialColumnState","setInitialColumnState","selectedCellContent","setSelectedCellContent","warn","ws","WebSocket","onopen","send","JSON","stringify","grid","onmessage","event","_gridRef$current","row_id","updates","parse","existingNode","getRowNode","_gridRef$current2","updatedRow","applyTransaction","update","close","_gridRef$current3","Streamlit","setFrameHeight","button","col_headername","col_width","pinned","button_name","border_color","otherKeys","filterParams","columnDefs","headerName","cellRenderer","cellRendererParams","borderColor","row_index","row","str","rules_value","window","confirm","sort","a","b","indexOf","refreshHeader","fetchAndSetData","array","fetchData","onRefresh","toggle_view","currentViewId","checkViewIdChanged","_res$data","baseurl","split","slice","join","get","client_user","checkLastModified","toggle_view_selection","calculateSubtotals","useCallback","filteredRows","forEachNodeAfterFilterAndSort","subtotal","Boolean","btn","match","onFilterChanged","interval","setInterval","timeout","clearInterval","clearTimeout","autoSizeAll","skipHeader","_grid_options","allColumnIds","columnApi","gridColumnDefs","getColumns","def","getColDef","initialWidth","getId","autoSizeColumns","onGridReady","sizeColumnsToFit","defaultMinWidth","getColumnState","autoGroupColumnDef","useMemo","getRowId","sideBar","toolPanels","labelDefault","labelKey","iconKey","toolPanel","defaultToolPanel","onCellValueChanged","loading","setLoading","columnTypes","dateColumnFilter","comparator","filterValue","cellValue","compareAsc","numberColumnFilter","shortDateTimeFormat","valueFormatter","customDateTimeFormat","custom_format_string","customNumericFormat","_params$column$colDef2","customCurrencyFormat","custom_currency_symbol","timedeltaFormat","duration","humanize","customNumberFormat","minimumFractionDigits","customHyperlinkRenderer","v","RegExp","exec","funcStr","Function","buttonStyle","uniqueValues","getUniqueColumnValues","show_cell_content","top","boxShadow","zIndex","maxWidth","maxHeight","overflow","wordBreak","toggle_header","flexWrap","gap","view","borderTop","animation","gridTemplateColumns","overflowY","flexDirection","lineHeight","new_data","warning","theme","column_sets","_gridRef$current4","applyColumnState","state","applyOrder","transition","k","_gridRef$current5","columnsToShow","flatMap","setColumnVisible","moveColumn","streaming_list_text","borderBottom","textOverflow","paddingLeft","setFilterModel","getFilterModel","filterType","model","handleButtonFilter","AgGridReact","pinnedBottomRowData","getRowStyle","_params$data$color_ro","_params$data$color_ro2","headerHeight","rowHeight","animateRows","suppressAggFuncInHeader","gridOptions","getGridOptions","nestedGridEnabled","onCellClicked","withStreamlitConnection","gridoption_build","args","Aggrid","ReactDOM","render","StrictMode","Main","document","getElementById"],"mappings":"0VAOA,MAAMA,EAAU,CAAC,mBAAoB,mBAAoB,mBAAoB,oBACvEC,EAAc,CAAC,eAAgB,gBAC/BC,EAAoB,CAAC,MAAO,OAAQ,QAAS,UAAW,WAAY,QACpEC,EAA2BD,EAAkBE,IAAIC,GAAWA,EAAH,WAoB/DC,IAAWC,cAAc,SACzB,IAAIC,GAAc,EAouBHC,MAztByBC,IAOjC,IAPkC,OACvCC,EAAM,WACNC,EAAU,UACVC,EAAS,WACTC,EAAU,cACVC,EAAa,OACbC,GACDN,EACC,MAAM,aAAEO,EAAY,mBAAEC,EAAkB,YAAEC,EAAW,cAAEC,EAAa,oBAAEC,EAAmB,oBAAEC,GAAwBT,GAE5GU,EAAkBC,GAAuBC,IAAMC,UAAS,IACxDC,EAAwBC,GAA6BH,IAAMC,UAAS,IACpEG,EAAkBC,GAAuBL,IAAMC,UAAS,IACxDK,EAAcC,GAAmBP,IAAMC,UAAS,IAChDO,EAAmBC,GAAwBT,IAAMC,UAAS,IAC1DS,EAAUC,GAAeX,IAAMC,SAAoC,KAMrEW,EAAgBC,GAAqBb,IAAMC,SAAoD,IAChGa,EAAe1B,EAAU0B,cAAgB,GACzCC,EAAkBrB,GAAeG,GAAuBmB,MAAMC,QAAQvB,EAAYG,IACpFH,EAAYG,GACZ,GACEqB,EAAWH,EAAeI,OAAS,EAAIC,OAAOC,KAAKN,EAAe,IAAM,GACxEO,EAAqBR,EAAanC,IAAK4C,GAAgCA,EAAIC,YAC3EC,EAAUT,MAAMU,KAAK,IAAIC,IAAI,IAAIL,KAAuBJ,KAExDU,EAAMC,iBAA0B,MAClBA,iBAA0B,MAwD5CC,oBAAU,KACJ5C,GAAQ6C,WAAW,SAAAC,EAAA,OAAiB,QAAjBA,EAAMJ,EAAIK,eAAO,IAAAD,OAAA,EAAXA,EAAaE,SAAS,MAClD,CAAChD,IAEJ4C,oBAAU,KACVnB,EAAY,KACX,CAACzB,EAAQQ,IAGZoC,oBAAU,KACR,IAAKhB,IAAiBpB,IAAgBG,IAAwBmB,MAAMC,QAAQvB,EAAYG,IAAuB,OAC/G,MAAMsC,EAASzC,EAAYG,GACrBuC,EAAa,GACnBtB,EAAauB,QAAQC,IAA6C,IAA5C,WAAEd,GAAoCc,EAC1DF,EAAMZ,GAAc,GACpBW,EAAOE,QAAQ,CAACE,EAAYC,KAAiB,IAADC,EAC1CL,EAAMZ,GAAYgB,GAAwB,QAApBC,EAAGF,EAAMf,UAAW,IAAAiB,IAAI,OAGlD5B,EAAkBuB,IACjB,CAAClD,EAAQQ,EAAaG,EAAqBiB,IAE5C,MAAM4B,EAAeC,GACZpE,EAAQqE,KAAKC,GAAUC,IAAOH,EAASE,GAAQ,GAAME,WAGxDC,EAAyBL,IAC7B,MAAMM,EAAOH,IAAOH,EAASpE,GAAS,GAAM2E,SACtCC,EAAWC,KAAKC,iBAAiBC,kBAAkBH,SACnDI,EAAYC,YAAeP,EAAME,GACvC,OAAON,YAAOU,EAAW,uBAIrBE,EAAa,GACbC,EAAgB,GAChBC,EAAiB,GACjBC,EAAc,GAEgB5C,MAAMC,QAAQxB,IAAuBJ,GACvEI,EAAmBoE,OAAQC,GAAUA,GAAUA,KAASzE,GAG1D,GAAII,EACF,IAAK,MAAMb,KAAQa,EAAoB,CACrC,MAAMsE,EAAQ1E,EAAWT,GACrBoC,MAAMC,QAAQ8C,GAChBH,EAAYI,KAAKpF,GACS,mBAAVmF,EAChBL,EAAcM,KAAKpF,GACV8D,EAAYqB,GACrBJ,EAAeK,KAAKpF,GAEpB6E,EAAWO,KAAKpF,GAOxB,OACEoB,IAAAiE,cAACpF,IAAU,CACTK,OAAQA,EACRgF,eAAgB/E,EAEhBgF,aAAa,GAEbnE,IAAAiE,cAAA,OAAKG,UAAU,oBAEbpE,IAAAiE,cAAA,OAAKG,UAAU,qEAAqEC,MAAO,CAAEC,SAAU,aACvGtE,IAAAiE,cAAA,MAAIG,UAAU,mBAAmBhF,EAAUmF,gBAC3CvE,IAAAiE,cAAA,QAAMG,UAAU,QAAQI,QAASrF,EAAYkF,MAAO,CAAEC,SAAU,WAAYG,MAAO,SAAU,SAO7FzE,IAAAiE,cAAA,OAAKG,UAAU,kBACbpE,IAAAiE,cAAA,OAAKG,UAAU,sBAEZV,EAAcvC,OAAS,GACtBnB,IAAAiE,cAAA,OACEG,UAAU,+CACVC,MAAO,CACLK,OAAQ,oBACRC,aAAc,MACdC,QAAS,MACTC,WAAY,YAGbnB,EAAc/E,IAAI,CAACC,EAAWkG,IAC7B9E,IAAAiE,cAAA,OAAKG,UAAU,wCAAwCW,IAAKD,EAAOT,MAAO,CAAEW,YAAa,QACvFhF,IAAAiE,cAAA,SAAOG,UAAU,OAAOC,MAAO,CAAEY,SAAU,QAASC,UAAW,SAAUC,SAAU,WAChFvG,EAAK,KAERoB,IAAAiE,cAAA,SACEmB,KAAK,WACLC,QAAShG,EAAWT,GACpB0G,SAAWC,GACTjG,EAAc,IACTD,EACH,CAACT,GAAO2G,EAAEC,OAAOH,UAGrBhB,MAAO,CAAEoB,MAAO,OAAQC,OAAQ,OAAQC,UAAW,YAUhE/F,GAAuBoB,MAAMC,QAAQrB,IACpCI,IAAAiE,cAAA,OACEG,UAAU,mBACVC,MAAO,CACTuB,KAAM,EACNlB,OAAQ,oBACRC,aAAc,MACdC,QAAS,MACTC,WAAY,UACZgB,aAAc,QAGXjG,EAAoBjB,IAAI,CAAC4C,EAAaiB,IACzC9C,QAAoCoG,IAArBpG,EAAY6B,IACzBvB,IAAAiE,cAAA,OACEc,IAAKxD,EACL8C,MAAO,CACTuB,KAAM,UACNX,SAAU,QACVY,aAAc,MACdE,aAAc,SAGZ/F,IAAAiE,cAAA,SAAI1C,EAAI,MACqB,kBAArB7B,EAAY6B,GACpByE,OAAOtG,EAAY6B,IAAM0E,oBAAeH,EAAW,CAAEI,sBAAuB,IAC5EC,OAAOzG,EAAY6B,OAQzBvB,IAAAiE,cAAA,OAAKG,UAAU,2CAEZX,EAAWtC,OAAS,GACnBnB,IAAAiE,cAAA,OAAKG,UAAU,qBAAqBC,MAAO,CAAEuB,KAAM,EAAGZ,YAAa,QAChEvB,EAAW9E,IAAI,CAACC,EAAWkG,KAC1B,GAAIrG,EAAkB2H,SAASxH,GAAO,OAAO,KAC7C,GAAIF,EAAyB0H,SAASxH,GAAO,OAAO,KACpD,MAAMyH,EAAe7H,EAAY4H,SAASxH,GAC1C,OACEoB,IAAAiE,cAAA,OAAKG,UAAU,4CAA4CW,IAAKD,GAC9D9E,IAAAiE,cAAA,SAAOG,UAAU,OAAOC,MAAO,CAAEc,SAAU,WACxCvG,EAAK,IACI,gBAATA,GACCoB,IAAAiE,cAAA,QACEI,MAAO,CAAEiC,WAAY,MAAOC,OAAQ,WACpCC,MAAM,sCACP,WAKJH,EACCrG,IAAAiE,cAAAjE,IAAAyG,SAAA,KACEzG,IAAAiE,cAAA,SACEmB,KAAK,QACLsB,IAAI,IACJC,IAAI,IACJC,KAAK,MACL7C,MAAO1E,EAAWT,IAAS,EAC3B0G,SAAWC,GACTjG,EAAc,IACTD,EACH,CAACT,GAAOoH,OAAOT,EAAEC,OAAOzB,SAG5BM,MAAO,CAAEoB,MAAO,UAElBzF,IAAAiE,cAAA,QAAMI,MAAO,CAAEc,SAAU,SAAU0B,WAAY,OAAQlB,UAAW,QAC/DtG,EAAWT,IAAS,IAIzBoB,IAAAiE,cAAA,SACEmB,KAAK,OACLrB,MAAO1E,EAAWT,GAClB0G,SAAWC,GACTjG,EAAc,IACTD,EACH,CAACT,GAAO2G,EAAEC,OAAOzB,QAGrBM,MAAO,CAAEuB,KAAM,EAAGH,MAAO,OAAQb,QAAS,MAAOO,SAAU,gBAUxEvB,EAAYzC,OAAS,GACpBnB,IAAAiE,cAAA,OAAKG,UAAU,qBAAqBC,MAAO,CAAEuB,KAAM,IAChDhC,EAAYjF,IAAI,CAACC,EAAWkG,IAC3B9E,IAAAiE,cAAA,OAAKG,UAAU,4CAA4CW,IAAKD,GAC9D9E,IAAAiE,cAAA,SAAOG,UAAU,OAAOC,MAAO,CAAEc,SAAU,WACxCvG,EAAK,KAERoB,IAAAiE,cAAA,UACEF,MAAO1E,EAAWT,GAAM,GACxB0G,SAAWC,GACTjG,EAAc,IACTD,EACH,CAACT,GAAO,CAAC2G,EAAEC,OAAOzB,SAGtBM,MAAO,CAAEuB,KAAM,EAAGH,MAAO,OAAQb,QAAS,MAAOO,SAAU,WAE1D9F,EAAWT,GAAMD,IAAI,CAACmI,EAAWC,IAChC/G,IAAAiE,cAAA,UAAQc,IAAKgC,EAAGhD,MAAO+C,GACpBA,QAUdrI,EAAkBmE,KAAMhE,GAAgC,OAAlBa,QAAkB,IAAlBA,OAAkB,EAAlBA,EAAoB2G,SAASxH,KAClEoB,IAAAiE,cAAA,OAAKI,MAAO,CAAEuB,KAAM,EAAGZ,YAAa,QAClChF,IAAAiE,cAAA,OACEI,MAAO,CAAEkC,OAAQ,UAAWM,WAAY,OAAQhB,aAAc,OAC9DrB,QAASA,IAAMzE,EAAqBiH,IAAUA,IAE7ClH,EAAmB,SAAM,SAAI,gCAE/BA,GACCE,IAAAiE,cAAA,WACGxF,EAAkBE,IAAI,CAACC,EAAWkG,KACf,OAAlBrF,QAAkB,IAAlBA,OAAkB,EAAlBA,EAAoB2G,SAASxH,UAA8BkH,IAArBzG,EAAWT,IAC/CoB,IAAAiE,cAAA,OAAKG,UAAU,4CAA4CW,IAAKD,GAC9D9E,IAAAiE,cAAA,SAAOG,UAAU,OAAOC,MAAO,CAAEc,SAAU,WACxCvG,EAAK,KAERoB,IAAAiE,cAAA,SACEmB,KAAK,QACLsB,IAAI,IACJC,IAAI,IACJC,KAAK,MACL7C,MAAO1E,EAAWT,IAAS,EAC3B0G,SAAWC,GACTjG,EAAc,IACTD,EACH,CAACT,GAAOoH,OAAOT,EAAEC,OAAOzB,SAG5BM,MAAO,CAAEoB,MAAO,UAElBzF,IAAAiE,cAAA,QAAMI,MAAO,CAAEc,SAAU,SAAU0B,WAAY,OAAQlB,UAAW,QAC/DtG,EAAWT,IAAS,OAWpCF,EAAyBkE,KAAMhE,GAAgC,OAAlBa,QAAkB,IAAlBA,OAAkB,EAAlBA,EAAoB2G,SAASxH,KACzEoB,IAAAiE,cAAA,OAAKI,MAAO,CAAEuB,KAAM,EAAGZ,YAAa,QAClChF,IAAAiE,cAAA,OACEI,MAAO,CAAEkC,OAAQ,UAAWM,WAAY,OAAQhB,aAAc,OAC9DrB,QAASA,IAAMrE,EAA2B6G,IAAUA,IAEnD9G,EAAyB,SAAM,SAAI,uCAErCA,GACCF,IAAAiE,cAAA,WACGvF,EAAyBC,IAAI,CAACC,EAAWkG,KACtB,OAAlBrF,QAAkB,IAAlBA,OAAkB,EAAlBA,EAAoB2G,SAASxH,UAA8BkH,IAArBzG,EAAWT,IAC/CoB,IAAAiE,cAAA,OAAKG,UAAU,4CAA4CW,IAAKD,GAC9D9E,IAAAiE,cAAA,SAAOG,UAAU,OAAOC,MAAO,CAAEc,SAAU,WACxCvG,EAAK,KAERoB,IAAAiE,cAAA,SACEmB,KAAK,QACLsB,IAAI,IACJC,IAAI,IACJC,KAAK,MACL7C,MAAO1E,EAAWT,IAAS,EAC3B0G,SAAWC,GACTjG,EAAc,IACTD,EACH,CAACT,GAAOoH,OAAOT,EAAEC,OAAOzB,SAG5BM,MAAO,CAAEoB,MAAO,UAElBzF,IAAAiE,cAAA,QAAMI,MAAO,CAAEc,SAAU,SAAU0B,WAAY,OAAQlB,UAAW,QAC/DtG,EAAWT,IAAS,OAWpC+E,EAAexC,OAAS,GACvBnB,IAAAiE,cAAA,OAAKG,UAAU,qBAAqBC,MAAO,CAAEuB,KAAM,EAAGZ,YAAa,QAChErB,EAAehF,IAAI,CAACC,EAAWkG,IAC9B9E,IAAAiE,cAAA,OAAKG,UAAU,4CAA4CW,IAAKD,GAC9D9E,IAAAiE,cAAA,SAAOG,UAAU,OAAOC,MAAO,CAAEc,SAAU,WACxCvG,EAAK,KAERoB,IAAAiE,cAAA,SACEmB,KAAK,iBACLrB,MAAO1E,EAAWT,IAASoE,EAAsB3D,EAAWT,IAC5D0G,SAAWC,GACTjG,EAAc,IACTD,EACH,CAACT,GAAO2G,EAAEC,OAAOzB,QAGrBM,MAAO,CAAEuB,KAAM,EAAGH,MAAO,OAAQb,QAAS,MAAOO,SAAU,gBAStEtF,GACCH,GACAsB,MAAMC,QAAQvB,EAAYG,KAC1BH,EAAYG,GAAqBsB,OAAS,GACxCnB,IAAAiE,cAAA,OAAKI,MAAO,CAAE4C,OAAQ,WACpBjH,IAAAiE,cAAA,OACEI,MAAO,CAAEkC,OAAQ,UAAWM,WAAY,OAAQhB,aAAc,OAC9DrB,QAASA,IAAM/D,EAAsBuG,IAAmBA,IAExDhH,IAAAiE,cAAA,QAAMI,MAAO,CAAEW,YAAa,QACzBxE,EAAoB,SAAM,UAE7BR,IAAAiE,cAAA,UACEmB,KAAK,SACLhB,UAAU,mBACVC,MAAO,CAAEwC,WAAY,OAAQK,eAAgB,YAAaC,MAAO,UAAWtC,WAAY,OAAQH,OAAQ,OAAQ6B,OAAQ,WACxH/B,QAASA,IAAM/D,EAAsBuG,IAAmBA,IAEvDnH,IAGJW,GAAqB,MACpB,MAAMO,EAAiBrB,EAAYG,GACnC,OACEG,IAAAiE,cAAA,OAAKI,MAAO,CAAE+C,UAAW,SACvBpH,IAAAiE,cAAA,SAAOG,UAAU,gCAAgCC,MAAO,CAAEc,SAAU,WACtFnF,IAAAiE,cAAA,aACEjE,IAAAiE,cAAA,UACGxC,EAAQ9C,IAAK4C,IACZ,MAAM8F,EAAcvG,EAAawG,KAC9BC,GAA+BA,EAAG/F,aAAeD,GAGpD,OACEvB,IAAAiE,cAAA,MACEc,IAAKxD,EACL8C,MAAO,CACLmD,WAAY,SACZC,SAAU,aACVC,gBAAiB,UACjBP,MAAO,QACPjC,UAAW,WAGblF,IAAAiE,cAAA,OAAKI,MAAO,CAAEsD,QAAS,OAAQC,WAAY,SAAUC,eAAgB,YAEvD,OAAXR,QAAW,IAAXA,OAAW,EAAXA,EAAaS,eAAgBvG,EAAIwG,QAAQ,KAAM,MACpC,OAAXV,QAAW,IAAXA,OAAW,EAAXA,EAAaW,OACZhI,IAAAiE,cAAA,QACEI,MAAO,CACLiC,WAAY,MACZC,OAAQ,UACRY,MAAO,UACPhC,SAAU,UAEZqB,MAAOa,EAAYW,MACpB,gBAUThI,IAAAiE,cAAA,aACGlD,EAAepC,IAAI,CAAC4D,EAAYC,IAC/BxC,IAAAiE,cAAA,MAAIc,IAAKvC,GACNf,EAAQ9C,IAAK4C,IACZ,MAAM8F,EAAcvG,EAAawG,KAAMC,GAAgCA,EAAG/F,aAAeD,GAExD,IAAD0G,EAAxB,GAAY,aAAR1G,EAEhB,OACEvB,IAAAiE,cAAA,MAAIc,IAAKxD,GACPvB,IAAAiE,cAAA,SACEmB,KAAK,SACLsB,IAAK,EACLC,IAAKpE,EAAM2F,cACXnE,OAA0B,QAAnBkE,EAAArH,EAAeW,UAAI,IAAA0G,OAAA,EAAnBA,EAAsBzF,KAAQ,GACrC8C,SAAWC,IACT,IAAIxB,EAAQwB,EAAEC,OAAOzB,MACrB,GAAc,KAAVA,EAKF,YAJAlD,EAAmBmG,IAAI,IAClBA,EACH,CAACzF,GAAM,IAAKyF,EAAKzF,GAAM,CAACiB,GAAM,OAIlC,IAAI2F,EAAMnC,OAAOjC,GACboE,EAAM,IAAGA,EAAM,QAEOrC,IAAxBvD,EAAM2F,eACNC,EAAM5F,EAAM2F,gBAEZC,EAAM5F,EAAM2F,eAEdrH,EAAmBmG,IAAI,IAClBA,EACH,CAACzF,GAAM,IAAKyF,EAAKzF,GAAM,CAACiB,GAAM2F,MAIhC,MAAMC,EAAgBrH,EAAepC,IACnC,CAAC0J,EAAUtB,KAAS,IAAAuB,EAAA,MAAM,IACrBD,EACHE,SACExB,IAAMvE,EACF2D,OAAOgC,IACY,QAAnBG,EAAA1H,EAAeW,UAAI,IAAA+G,OAAA,EAAnBA,EAAsBvB,KAAM,MAGtCzH,EAAc,IACTD,EACHmJ,uBAAwBJ,KAG5B/D,MAAO,CAAEoB,MAAO,OAAQN,SAAU,aAInC,GAAIkC,EAAa,CAElB,GAA0B,SAAtBA,EAAYoB,MAAkB,CAAC,IAADC,EAE1C,MAAMC,EAAUtB,EAAYuB,QAAU,GACtC,OACE5I,IAAAiE,cAAA,MAAIc,IAAKxD,GACPvB,IAAAiE,cAAA,UACEF,OAA0B,QAAnB2E,EAAA9H,EAAeW,UAAI,IAAAmH,OAAA,EAAnBA,EAAsBlG,KAAQ,GACrC8C,SAAWC,IACT,MAAMxB,EAAQwB,EAAEC,OAAOzB,MACvBlD,EAAmBmG,IAAI,IAClBA,EACH,CAACzF,GAAM,IAAKyF,EAAKzF,GAAM,CAACiB,GAAMuB,OAGlCM,MAAO,CAAEoB,MAAO,OAAQN,SAAU,SAAUP,QAAS,MAAOK,SAAU,SAEtEjF,IAAAiE,cAAA,UAAQF,MAAM,GAAG8E,UAAQ,GAAC,aAGzBF,EAAQhK,IAAI,CAACmK,EAAgB/B,IAC5B/G,IAAAiE,cAAA,UAAQc,IAAKgC,EAAGhD,MAAO+E,GACpBA,MAUqC,IAADC,EAgBMC,EAiBCC,EAiBrCC,EAlDR,MAA0B,aAAtB7B,EAAYoB,MAEjBzI,IAAAiE,cAAA,MAAIc,IAAKxD,GACPvB,IAAAiE,cAAA,SACQmB,KAAK,WACLC,WAA8B,QAApB0D,EAACnI,EAAeW,UAAI,IAAAwH,OAAA,EAAnBA,EAAsBvG,IACjC8C,SAAUC,IACR,MAAMxB,EAAQwB,EAAEC,OAAOH,QACvBxE,EAAkBmG,IAAI,IACjBA,EACH,CAACzF,GAAM,IAAKyF,EAAKzF,GAAM,CAACiB,GAAMuB,UAMT,WAAtBsD,EAAYoB,MAEnBzI,IAAAiE,cAAA,MAAIc,IAAKxD,GACPvB,IAAAiE,cAAA,SACEmB,KAAK,SACLrB,OAA0B,QAAnBiF,EAAApI,EAAeW,UAAI,IAAAyH,OAAA,EAAnBA,EAAsBxG,KAAQ,GACrC8C,SAAUC,IACR,MAAMxB,EAAQwB,EAAEC,OAAOzB,MACvBlD,EAAkBmG,IAAI,IACjBA,EACH,CAACzF,GAAM,IAAKyF,EAAKzF,GAAM,CAACiB,GAAMuB,OAGlCM,MAAO,CAAEoB,MAAO,OAAQN,SAAU,aAIV,aAAtBkC,EAAYoB,MAEZzI,IAAAiE,cAAA,MAAIc,IAAKxD,GACPvB,IAAAiE,cAAA,SACEmB,KAAK,iBACLrB,OAA0B,QAAnBkF,EAAArI,EAAeW,UAAI,IAAA0H,OAAA,EAAnBA,EAAsBzG,KAAQ,GACrC8C,SAAUC,IACR,MAAMxB,EAAQwB,EAAEC,OAAOzB,MACvBlD,EAAkBmG,IAAI,IACjBA,EACH,CAACzF,GAAM,IAAKyF,EAAKzF,GAAM,CAACiB,GAAMuB,OAGlCM,MAAO,CAAEoB,MAAO,QAASN,SAAU,aAO7CnF,IAAAiE,cAAA,MAAIc,IAAKxD,GACPvB,IAAAiE,cAAA,SACEmB,KAAK,OACLrB,OAA0B,QAAnBmF,EAAAtI,EAAeW,UAAI,IAAA2H,OAAA,EAAnBA,EAAsB1G,KAAQ,GACrC8C,SAAUC,IACR,MAAMxB,EAAQwB,EAAEC,OAAOzB,MACvBlD,EAAkBmG,IAAI,IACjBA,EACH,CAACzF,GAAM,IAAKyF,EAAKzF,GAAM,CAACiB,GAAMuB,OAGlCM,MAAO,CAAEoB,MAAO,OAAQN,SAAU,aAO1C,OACEnF,IAAAiE,cAAA,MAAIc,IAAKxD,GACNgB,QAAwBuD,IAAfvD,EAAMhB,GACU,kBAAfgB,EAAMhB,GACXyE,OAAOzD,EAAMhB,IAAM0E,oBAAeH,EAAW,CAAEI,sBAAuB,IACtEC,OAAO5D,EAAMhB,IACf,SAQlBvB,IAAAiE,cAAA,aACEjE,IAAAiE,cAAA,UACGxC,EAAQ9C,IAAK4C,IACZ,IAEE,MAAM4H,EAAMpI,EAAeqI,OAAO,CAACC,EAAa9G,KAC9C,MAAM+G,EAAM/G,EAAMhB,GAClB,MAAsB,kBAAR+H,GAAqBC,MAAMD,GAAmBD,EAAZA,EAAMC,GACrD,GAEGE,EAAazI,EAAe6B,KAAML,GAAqC,kBAAfA,EAAMhB,KAAsBgI,MAAMhH,EAAMhB,KACtG,OACEvB,IAAAiE,cAAA,MAAIc,IAAKxD,EAAK8C,MAAO,CAAEwC,WAAY,OAAQhC,WAAY,YACpD2E,EAAaL,EAAIlD,oBAAeH,EAAW,CAAEI,sBAAuB,IAAO,IAGhF,MAAOX,GACP,OAAOvF,IAAAiE,cAAA,MAAIc,IAAKxD,YA5OI,MAmQ5BvB,IAAAiE,cAAA,OAAKG,UAAU,6CAA6CC,MAAO,CAAEC,SAAU,SAAUmF,OAAQ,IAC/FzJ,IAAAiE,cAAA,UAAQmB,KAAK,SAAShB,UAAU,uBAAuBI,QA1qBtCkF,UACrB,IAAI3K,EAAJ,CACAA,GAAc,EAChB,IAEI,MAAMgC,EAAiBlB,GAAuBH,GAAesB,MAAMC,QAAQvB,EAAYG,IACnFH,EAAYG,GACZ,GAEJ,IAAKkB,IAAmBC,MAAMC,QAAQF,GAEpC,YADAxB,EAAOoK,MAAM,6CAIf,MAAMC,EAAkB7I,EAAepC,IAAI,CAAC4D,EAAYC,KACtD,IAAIqH,EAAa,GAIjB,OAHA/I,EAAauB,QAASd,IAAiC,IAADuI,EACpDD,EAAMtI,EAAIC,aAA4C,QAA9BsI,EAAAlJ,EAAeW,EAAIC,mBAAW,IAAAsI,OAAA,EAA9BA,EAAiCtH,KAAQ,KAE5D,IAAKD,KAAUsH,KAEpBE,EAAO,CACXC,SAAU5K,EAAU4K,SACpBC,KAAM7K,EAAU6K,KAChBC,aAAc9K,EAAUM,YACxByK,cAAe9K,EACf+K,gBAAiBR,KACdxK,EAAUiL,SAELC,KAAMC,SAAcC,IAAMC,KAAKrL,EAAUsL,WAAYX,IAC7D,OAAEY,EAAM,KAAEL,EAAI,YAAEM,GAAgBL,EACvB,YAAXI,EACEL,GAA8B,SAAtBA,EAAKO,aACftL,EAAOuL,QAAQF,EAAa,WAE5BG,MAAM,0BAA4BH,GAGhCN,GAA8B,SAAtBA,EAAKO,aACftL,EAAOoK,MAAMiB,EAAa,SAE1BG,MAAM,wBAA0BH,IAGV,KAAlB,OAAJN,QAAI,IAAJA,OAAI,EAAJA,EAAMU,cAAuB7L,IAC3B,MAAOwK,GACPsB,QAAQC,IAAI,aAAcvB,GAC1BpK,EAAOoK,MAAMA,EAAMwB,SAErBpM,GAAc,IAynBsE6C,IAAKA,GAAK,MAG1F5B,IAAAiE,cAAA,UAAQmB,KAAK,SAAShB,UAAU,yBAAyBI,QAASrF,GAAY,c,gCCxvBtF,SAASiM,EAAUC,EAAKC,EAAIC,GAExB,OADgBnK,OAAOC,KAAKgK,GACXjC,OAAO,CAACmB,EAAKxF,IACrBwG,EAAanF,SAASrB,IAI3BwF,EAAIxF,GAAOsG,EAAItG,GACRwF,IAJHA,EAAIxF,GAAOuG,EAAGD,EAAItG,IACXwF,GAKZ,IAGP,SAASiB,EAAQH,EAAKC,GAAwB,IAApBC,EAAYE,UAAAtK,OAAA,QAAA2E,IAAA2F,UAAA,GAAAA,UAAA,GAAG,GACrC,MAAMC,EAAcpC,GACR,OAARA,GAA+B,kBAARA,EAAmBkC,EAAQlC,EAAKgC,GAAMA,EAAGhC,GACpE,OAAItI,MAAMC,QAAQoK,GACPA,EAAI1M,IAAI+M,GAEA,kBAARL,EACAD,EAAUC,EAAKK,EAAYH,GAE/BF,ECsCX,IAAIM,EAAmB,GACnBC,EAAoB,KAGxB,SAASC,EAAcC,EAAmBC,GACxC,IACE,IAAI9I,EAAO,IAAI+I,KAAKF,GACpB,OAAOjJ,YAAOI,EAAM8I,GACpB,MACA,OAAOD,GAKX,SAASG,EAAkBC,EAAaC,GACtC,IAAIC,EAAIpG,OAAOqG,WAAWH,GAC1B,OAAKlG,OAAOuD,MAAM6C,GAGTF,EAFAC,EAAiBC,EAAEE,QAAQ,GAMtC,SAASC,EAAgBL,EAAaM,GACpC,IAAIJ,EAAIpG,OAAOqG,WAAWH,GAC1B,OAAKlG,OAAOuD,MAAM6C,GAGTF,EAFAE,EAAEE,QAAQE,GAMrB,MAsCMC,EAAqBC,IACzB,MAAMC,EAAYD,EAAME,OAAOC,OAAkB,UAC3CC,EAAUJ,EAAME,OAAOC,OAAOC,QAC9BC,EAAYL,EAAMpC,MAAQqC,EAAYD,EAAMpC,KAAKqC,GAAa,KAGpE,OAAII,GAAaD,EAEb9M,IAAAiE,cAAA,KAAG+I,KAAM,GAAGF,KAAWC,IAAavH,OAAO,SAASyH,IAAI,uBACrDP,EAAM3I,OAKN/D,IAAAiE,cAAA,YAAOyI,EAAM3I,QAItBxE,IAAOoJ,QAAU,CACfuE,cAAe,uBACfC,aAAc,IACdC,QAAS,KAiwCIC,MA5vCCX,IAChB,MAAMY,EAAmBZ,IAIvB,IAAKA,IAAUA,EAAMa,KAAM,OAAO,KAClC,GAA6B,WAAzBb,EAAMa,KAAKC,UACb,OAAOxN,IAAAiE,cAAA,YAAOyI,EAAM3I,OAGtB,MAAM0J,EACJf,EAAMpC,MAAQoC,EAAMlL,YAAckL,EAAMpC,KAAQoC,EAAMlL,WAAT,cACzCkL,EAAMpC,KAAQoC,EAAMlL,WAAT,cACXkL,EAAMgB,UAEZ,OACE1N,IAAAiE,cAAA,UACEO,QAfsBmJ,KACxBjB,EAAMkB,QAAQlB,EAAMa,KAAKM,KAevBxJ,MAAO,CACLQ,WAAY,cACZH,QAAqB,OAAb+I,QAAa,IAAbA,OAAa,EAAbA,EAAe/I,SAAU,OACjCe,MAAOiH,EAAMjH,MAAQiH,EAAMjH,MAAQ,OACnC0B,OAAoB,OAAbsG,QAAa,IAAbA,OAAa,EAAbA,EAAetG,QAAS,aAC5BsG,IAGJf,EAAMlL,WAAakL,EAAM3I,MAAQ2I,EAAMoB,aAI9C,SAASC,EAAuBC,EAAwBC,GACtD,MAAMtF,EAAU,IAAKqF,EAAmBE,cAAc,GAsBtD,OApBAvF,EAAQwF,iBAAoBC,IAC1B,IAAIC,EAAa,GACbrN,MAAMC,QAAQmN,EAAO9D,KAAK+D,YAC5BA,EAAaD,EAAO9D,KAAK+D,WAChBD,EAAO9D,KAAK+D,aACrBA,EAAa,CAACD,EAAO9D,KAAK+D,aAE5BD,EAAOE,gBAAgBD,EAAWlN,OAASkN,EAAa,KAIxD1F,EAAQ4F,0BACR5F,EAAQ4F,yBAAyBP,oBAEjCrF,EAAQ4F,yBAAyBP,kBAAoBD,EACnDpF,EAAQ4F,yBAAyBP,kBACjCC,EAAQ,IAILtF,EAGT,MAwBQ6F,EAAU3M,iBAAoB,OAC9B,SACJmI,EAAQ,IACRyE,EAAG,WACHC,EAAU,OACVC,EAAkB,YAClBC,EAAuB,mBACvBC,EAAqB,EAAC,KACtB5E,GAAO,EAAI,MACXnF,EAAK,cACLgK,EAAa,OACbzE,GACEqC,EACJ,IAAI,aAAEqC,EAAe,IAAOrC,EAKxBoC,IACFC,EAAevD,EAAQuD,EAAcC,GAAuB,CAAC,aAG/D,MAAOC,EAAcC,GAAmBjP,mBAAgB,IACxD,IAAI,QAAEkP,EAAO,aAAEC,EAAY,QAAEC,EAAO,gBAAEC,EAAkB,KAAI,YAAEC,EAAY,GAAE,gBAC1EC,EAAgB,KAAI,UAAEC,GAAU,EAAK,cAAEC,EAAc,GAAE,cAAEC,EAAc,IAAMtF,EAC/E,MAAOuF,EAASC,GAAc5P,mBAAgB,KACvC6P,EAAWC,GAAgB9P,oBAAS,IACpCb,EAAW4Q,GAAgB/P,mBAAS,KACpCZ,EAAYC,GAAiBW,mBAAS,KACtCgQ,EAAQC,GAAajQ,mBAAS,IAC9BkQ,EAAcC,GAAmBnQ,mBAAwB,OACzDoQ,GAAgBC,IAAqBrQ,mBAAS,KAC9CsQ,GAAcC,IAAmBvQ,mBAAwB,OACzDwQ,GAAuBC,IAA4BzQ,mBAAmB,KACtE0Q,GAAoBC,IAAyB3Q,mBAAc,OAE3D4Q,GAAqBC,IAA0B7Q,mBAAwB,MAQhF6B,oBAAU,KACR,IAAKuI,EAAOsE,OAEV,YADA1D,QAAQ8F,KAAK,+CAIhB,MAAMC,EAAK,IAAIC,UAAU5G,EAAOsE,QAuB/B,OArBDqC,EAAGE,OAAS,KACTF,EAAGG,KAAKC,KAAKC,UAAU,CACrBrH,SAAUA,EACVsH,KAAM1B,EACNP,QAASA,MAIf2B,EAAGO,UAAaC,IAAW,IAADC,EACxB,MAAM,OAAEC,EAAM,QAAEC,GAAYP,KAAKQ,MAAMJ,EAAMlH,MACvCuH,EAA8B,QAAlBJ,EAAGjD,EAAQvM,eAAO,IAAAwP,OAAA,EAAfA,EAAiBhD,IAAIqD,WAAWJ,GACrD,GAAIG,GAAgBA,EAAavH,KAAM,CAAC,IAADyH,EACrC,MAAMC,EAAa,IAAKH,EAAavH,QAASqH,GAC9CK,EAAWlN,GAAS4M,EACL,QAAfK,EAAAvD,EAAQvM,eAAO,IAAA8P,GAAfA,EAAiBtD,IAAIwD,iBAAiB,CACpCC,OAAQ,CAACF,UAGX/G,QAAQC,IAAI,4BAA6BwG,IAGpC,IAAMV,EAAGmB,SACf,CAAC9H,EAAOsE,OAAQ7J,EAAO8K,IA+CxB9N,oBAAU,KAAO,IAADsQ,EACdC,IAAUC,iBAENnD,EAAQhO,SAEVgO,EAAU3D,EAAQ2D,EAASH,GAAuB,CAAC,YAEnDG,EAAQ9M,QAASkQ,IAEf,MAAM,aACJ/S,EAAY,eACZ+E,EAAc,WACdmG,EAAU,mBACVjL,EAAkB,WAClB+B,EAAU,eACVgR,EAAc,UACdC,EAAS,OACTC,EAAM,YACNC,EAAW,aACXC,EAAY,OACZlO,EAAM,oBACN9E,EAAmB,oBACnBC,EAAmB,aACnBiB,KACG+R,GACDN,EAEJ,IAAIO,EAAeP,EAAOO,cAAgB,GACtCzI,EAAqB,eACvByI,EAAe,IAAKA,EAAc3D,QAAS,CAAC,QAAS,WAGvDJ,EAAagE,WAAY/O,KAAK,IACzB6O,EACH/O,MAAOtC,GAAcsD,EACrBkO,WAAYR,EACZ/M,MAAOgN,EACPC,OAAQA,EACRO,aAAc3F,EAEdwF,eACAI,mBAAoB,CAClB1R,aACAsM,WAAY6E,EACZQ,YAAaP,EACblO,OAAQA,EACRoO,eACApF,UAAW6E,EAAO7E,aAEd6E,EAAOW,oBAAsB,GACjCtF,QAASlE,eAAgB0J,GACvB,IACE,MAAM1T,EAAciM,EAAUrE,KAAM+L,GAAQA,EAAIvO,KAAWsO,GAC3D,GAAI3T,EAAoB,CACtB,MAAM6T,EAAM5T,EAAYF,GAClBG,EACW,kBAAR2T,EACHlC,KAAKQ,MACHlS,EAAYF,GACTuI,QAAQ,KAAM,KACdA,QAAQ,MAAO,IACfA,QAAQ,MAAO,IACfA,QAAQ,SAAU,SAClBA,QAAQ,QAAS,SAEtBuL,EAENvD,GAAa,GACbC,EAAa,CACXzL,iBACAmG,WAAYA,EACZV,SAAUA,EACVC,KAAMA,EACNvK,YAAaA,EACb2K,OAAQA,EACR7K,eACAC,qBACAE,gBACAC,sBACAC,sBACAiB,iBAGF,MAAMyS,EAAmB,GACzB9T,EAAmB4C,QAASzD,IAC1B2U,EAAY3U,GAAQe,EAAcf,KAGpCU,EAAciU,QACL/T,GAAgB+E,GACzBwL,GAAa,GACbC,EAAa,CACXzL,iBACAmG,WAAYA,EACZV,SAAUA,EACVC,KAAMA,EACNvK,YAAaA,EACb2K,OAAQA,IAEV/K,EAAcI,EAAYF,MAEtBgU,OAAOC,QAAQlP,UACXiG,IAAMC,KAAKC,EAAY,CAC3BV,SAAUA,EACVC,KAAMA,EACNC,aAAcxK,KACX2K,IAGP9K,IAAOuL,QAAQ,aAEjB,MAAOnB,GACPoB,MAAM,GAAGpB,WAWjB4F,EAAYpO,OAAS,GAAK4N,EAAagE,YACzChE,EAAagE,WAAWW,KAAK,CAACC,EAAQC,KAEA,IAAlCrE,EAAYsE,QAAQF,EAAE7P,SAAmD,IAAlCyL,EAAYsE,QAAQD,EAAE9P,OACxDyL,EAAYsE,QAAQF,EAAE7P,OAASyL,EAAYsE,QAAQD,EAAE9P,QAIxB,IAAlCyL,EAAYsE,QAAQF,EAAE7P,OAAsB,GACV,IAAlCyL,EAAYsE,QAAQD,EAAE9P,QAAuB,EAE1C,IAMU,QAAnBsO,EAAI5D,EAAQvM,eAAO,IAAAmQ,OAAA,EAAfA,EAAiB3D,MACnBD,EAAQvM,QAAQwM,IAAIqF,iBAErB,CAAC3E,EAASJ,EAAagE,aAE1B,MAAMgB,GAAkBrK,UACtB,MAAMsK,QAAcC,KACpB,OAAc,IAAVD,IACJnE,EAAWmE,GACXrI,EAAYqI,GACL,IAGTlS,oBAAU,KACRoS,MACC,CAACjE,IAGJ,MAAMgE,GAAYvK,UAChB,IACE,IAAIyK,EAAc/E,EAAeA,EAAaa,GAAU,OAKxD,SAjLuBvG,OAAO0K,EAAuB/D,IACnD+D,IAAkB/D,IAEpBC,GAAkB8D,IACX,GAyKsBC,CAAmBpE,EAAQI,KAIjCzB,GAAeA,EAAc,EAAG,CAErD,SAnNkBlF,WACtB,IACE,GAAwB,OAApB4F,EAEF,OADArE,QAAQC,IAAI,qCACL,EAET,GAAwB,OAApBoE,QAAgDxJ,IAApBwJ,EAA+B,CAAC,IAADgF,EAC7D,MAAMC,EAAU9F,EAAI+F,MAAM,KAAKC,MAAM,GAAI,GAAGC,KAAK,KAC3CnK,QAAYC,IAAMmK,IAAOJ,EAAH,eAA0B,CACpDnG,OAAQ,CACNiB,QAASA,EACTuF,YAAa5K,EACbC,KAAMA,EACNqF,gBAAiBA,KAIrB,OAAY,QAARgF,EAAA/J,EAAID,YAAI,IAAAgK,OAAA,EAARA,EAAUnE,gBAAiBA,IAE7BC,EAAgB7F,EAAID,KAAK6F,eAClB,GAKX,OAAO,EACP,MAAOxG,GAEP,OADApK,IAAOoK,MAAM,kCAAkCA,EAAMwB,UAC9C,IAsLwB0J,GAE3B,OAAO,EAIX5J,QAAQC,IAAI,mBAAoBuD,GAChC,MAAMlE,QAAYC,IAAMC,KAAKgE,EAAK,CAChCzE,SAAUA,EACVC,KAAMA,KACHI,EACHyK,sBAAuBX,IAKzB,OAHc/C,KAAKQ,MAAMrH,EAAID,MAK/B,MAAOX,GAEL,OADApK,IAAOoK,MAAM,gBAAgBA,EAAMwB,UAC5B,IAsCP4J,GAAqBC,sBAAY,KACrC,IAAKxG,EAAQvM,QAAS,OACtB,IAAKyN,GAA0C,IAAzBA,EAAcvO,OAElC,YADA+N,EAAgB,IAGlB,MAAMT,EAAMD,EAAQvM,QAAQwM,IAC5B,IAAIwG,EAAsB,GAK1B,GAJAxG,EAAIyG,8BAA+B3H,IAC7BA,EAAKjD,MAAM2K,EAAajR,KAAKuJ,EAAKjD,QAGZ,IAAxB2K,EAAa9T,OAEf,YADA+N,EAAgB,IAIpB,IAAIiG,EAAgB,GAEhB1T,EAAoB,GACpBsN,GAAgBA,EAAagE,WAC/BtR,EAAUsN,EAAagE,WAAWpU,IAAKkO,GAAgBA,EAAO/I,OAAOD,OAAOuR,SACnEH,EAAa9T,OAAS,IAC/BM,EAAUL,OAAOC,KAAK4T,EAAa,KAIZ,kBAAdxF,GAA0BhO,EAAQ2E,SAASqJ,GACpD0F,EAAS1F,GAAa,YACbhO,EAAQN,OAAS,IAC1BgU,EAAS1T,EAAQ,IAAM,aAMrBT,MAAMC,QAAQkO,IAChBA,EAAQ9M,QAASgT,IACXA,EAAI7T,YAAc6T,EAAI3H,YACxByH,EAAYE,EAAI7T,WAAP,cAAiC6T,EAAI3H,aAKpDjM,EAAQY,QAASd,IACf,GAAImO,EAActJ,SAAS7E,GAAM,CAE/B,MAAM4H,EAAM8L,EAAa7L,OAAO,CAACD,EAAKkK,KACpC,IAAI/J,EAAM+J,EAAI9R,GACd,GAAmB,kBAAR+H,GAAoBA,EAAIlD,SAAS,KAAM,CAEhD,MAAMkP,EAAQhM,EAAIgM,MAAM,iBACpBA,GAASA,EAAM,KACjBhM,EAAMgM,EAAM,GAAGvN,QAAQ,KAAM,KAGjC,MAAMI,EAAMnC,OAAOsD,GACnB,OAAOH,GAAOI,MAAMpB,GAAO,EAAIA,IAC9B,GACHgN,EAAS5T,GAAOgI,MAAMJ,GAAO,GAAKA,MACD,cAAxBgM,EAAS1F,IAA8BlO,IAAQkO,IACxD0F,EAAS5T,GAAO,MAIlB2N,EAAgB,CAACiG,KAChB,CAACzF,EAAeD,IACb8F,GAAkBP,sBAAY,KAClCD,MACC,CAACA,KAEFjT,oBAAU,KACR,GAAI8M,GAAeA,EAAc,EAAG,CAClC,MAAM4G,EAAWC,YAAY1B,GAA+B,IAAdnF,GAC9C,IAAI8G,EASJ,OARI7G,EAAqB,IACvB5D,QAAQC,IAAI2D,GACZ6G,EAAU3T,WAAW,KACnB4T,cAAcH,GACdvK,QAAQC,IAAI,qCAAsC0D,IAC5B,IAArBC,IAEL5D,QAAQtB,MAAM,qBAAsB+C,GAC7B,KACLiJ,cAAcH,GACVE,GAASE,aAAaF,MAG7B,CAAChJ,EAAOuD,IAKX,MAAM4F,GAAcb,sBAAac,IAAyB,IAADC,EACvD,MAAMC,EAAyB,GACzBC,EAAYzH,EAAQvM,QAASgU,UAC7BC,GAA6B,QAAZH,EAAAhH,SAAY,IAAAgH,OAAA,EAAZA,EAAchD,aAAc,GACnDkD,EAAUE,aAAc9T,QAASuK,IAC/B,MAAMC,EAASqJ,EAAe5O,KAAM8O,GAAaA,EAAItS,QAAU8I,EAAOyJ,YAAYvS,OAC7E+I,QAAkC/G,IAAxB+G,EAAOyJ,cACpBN,EAAahS,KAAK4I,EAAO2J,WAG7BN,EAAUO,gBAAgBR,EAAcF,IACvC,IAQGW,IANYzB,sBAAY,KAC5BxG,EAAQvM,QAASwM,IAAIiI,iBAAiB,CACpCC,gBAAiB,OAElB,IAEiB3B,sBAAYtL,UAC9B3H,WAAW2H,UACT,IACEuB,QAAQC,IAAI,YAAayD,EAAQtE,EAAOsE,QACxC,MAAMqF,QAAcC,KACpB,IAAc,IAAVD,EAAiB,OAErBnE,EAAWmE,GACXrI,EAAYqI,EAERtE,GAAiBA,EAAcvO,OAAS,EAC1C4T,KAEA7F,EAAgB,IAGlB2G,IAAY,GAGVzH,EAAO6H,WACTrF,GAAsBxC,EAAO6H,UAAUW,kBAGvC,MAAOjN,GACPpK,IAAOoK,MAAM,UAAUA,EAAMwB,WAE9B,MACF,KAEG0L,GAAqBC,kBAAgB,KAClC,CACL7R,SAAU,MAEX,IAEG8R,GAAWD,kBAAsB,IAC7B1I,GACCA,EAAO9D,KAAKxF,GAEpB,CAACA,IAEEkS,GAAUF,kBAEd,KACO,CACLG,WAAY,CACV,CACEpJ,GAAI,UACJqJ,aAAc,UACdC,SAAU,UACVC,QAAS,UACTC,UAAW,sBAEb,CACExJ,GAAI,UACJqJ,aAAc,UACdC,SAAU,UACVC,QAAS,SACTC,UAAW,uBAGfC,iBAAkB,gBAEnB,IAEGC,GAAqBvC,sBAAaxD,IACjB,OAAjB5F,IAAuBA,EAAe,IAC1CA,EAAa4F,EAAMlH,KAAKxF,IAAU0M,EAAMlH,KACxCW,QAAQC,IAAI,uBAAwBU,IACnC,KAGI4L,GAASC,IAAcxX,oBAAS,GAGjCiU,IAFkBrS,iBAA8B,MAEpC6H,UAChB+N,IAAW,GACX,IACE,MAAM3M,QAAgBiJ,KAEtBvE,GAAmB1E,GAAWvL,IAAOuL,QAAQ,oBAC7C,MAAOnB,GACPpK,IAAOoK,MAAM,mBAAmBA,EAAMwB,SACvC,QACCsM,IAAW,MAwBTC,GAAcZ,kBAAa,KACxB,CACLa,iBAAkB,CAChB9T,OAAQ,qBACRiP,aAAc,CACZ8E,WAAYA,CAACC,EAAkBC,IAC7BC,YAAW,IAAI/L,KAAK8L,GAAYD,KAGtCG,mBAAoB,CAClBnU,OAAQ,wBAEVoU,oBAAqB,CACnBC,eAAiB9J,GACfvC,EAAcuC,EAAOrK,MAAO,qBAEhCoU,qBAAsB,CACpBD,eAAiB9J,GACfvC,EACEuC,EAAOrK,MACPqK,EAAOxB,OAAOC,OAAOuL,uBAG3BC,oBAAqB,CACnBH,eAAiB9J,IAAW,IAAAkK,EAAA,OAC1B/L,EAAgB6B,EAAOrK,MAAqC,QAAhCuU,EAAElK,EAAOxB,OAAOC,OAAOL,iBAAS,IAAA8L,IAAI,KAEpEC,qBAAsB,CACpBL,eAAiB9J,GACfnC,EACEmC,EAAOrK,MACPqK,EAAOxB,OAAOC,OAAO2L,yBAG3BC,gBAAiB,CACfP,eAAiB9J,GAAgBsK,mBAAStK,EAAOrK,OAAO4U,UAAS,IAEnEC,mBAAoB,CAClBV,eAAiB9J,GACfpI,OAAOoI,EAAOrK,OAAOkC,eAAe,QAAS,CAC3C4S,sBAAuB,KAG7BC,wBAAyB,CAGvB7F,aAAcxG,EACdyG,mBAAoB,CAClBpG,QAAS,yBAId,IAaH,SAASkC,GAAsB+J,GAE7B,IAIIzD,EAJU,IAAI0D,OAChB,wDAGkBC,KAAKF,GAEzB,GAAIzD,EAAO,CAET,MAAM4D,EAAU5D,EAAM,GAEtB,OAAO,IAAI6D,SAAS,UAAYD,EAAzB,GAEP,OAAOH,EAIX,MA6BMK,IAdkBjY,GAcWiO,EAAajO,QAbjC,EACJ,CAAEyD,QAAS,YAAaO,SAAU,QAChChE,GAAS,EACX,CAAEyD,QAAS,YAAaO,SAAU,QAChChE,GAAS,GACX,CAAEyD,QAAS,YAAaO,SAAU,QAChChE,GAAS,GACX,CAAEyD,QAAS,YAAaO,SAAU,QAElC,CAAEP,QAAS,UAAWO,SAAU,QAVnBhE,OAgBxB,MAqBIkY,GAAevC,kBACnB,IAR8BwC,EAAC1M,EAAgBgD,IACtC5O,MAAMU,KAAK,IAAIC,IAAIiO,EAAQjR,IAAI0U,GAAOA,EAAIzG,MAAW/I,OAC1DkV,QAAWjT,IAANiT,GAAyB,OAANA,GAMtBO,CAAsB3J,EAAeC,GAC3C,CAACA,EAASD,IA0BV,OACE3P,IAAAiE,cAAAjE,IAAAyG,SAAA,KAEH4D,EAAOkP,mBAAqB1I,IAC3B7Q,IAAAiE,cAAA,OACEI,MAAO,CACLC,SAAU,WACVkV,IAAK,OACL/U,MAAO,OACPI,WAAY,QACZH,OAAQ,iBACRC,aAAc,MACdC,QAAS,OACT6U,UAAW,+BACXC,OAAQ,IACRC,SAAU,QACVC,UAAW,QACXC,SAAU,OACVpU,MAAO,gBAGTzF,IAAAiE,cAAA,KAAGI,MAAO,CAAEmD,WAAY,WAAYsS,UAAW,eAC5CjJ,IAEH7Q,IAAAiE,cAAA,UACEO,QAASA,IAAMsM,GAAuB,MACtCzM,MAAO,CACLQ,WAAY,UACZsC,MAAO,QACPzC,OAAQ,OACRC,aAAc,MACdC,QAAS,UACT2B,OAAQ,YAGVvG,IAAAiE,cAAA,MAAII,MAAO,CAAEc,SAAU,MAAO8B,OAAQ,cAAe,OAK1DmI,GAAgBA,EAAajO,OAAS,GACrCnB,IAAAiE,cAAAjE,IAAAyG,SAAA,KACEzG,IAAAiE,cAAA,OACEI,MAAO,CACLwC,WAAY,OACZM,MAAO,UACPtB,aAAc,MACdV,SAAU,SAGXkF,EAAO0P,cAAgB1P,EAAO0P,cAAgB,IAEhD3K,EAAajO,OAAS,GAErBnB,IAAAiE,cAAA,OACEI,MAAO,CACLsD,QAAS,OACTqS,SAAU,OACVC,IAAK,OACLrV,QAAS,OACTiB,aAAc,SAGfuJ,EAAazQ,IAAI,CAACub,EAAcpV,IAC/B9E,IAAAiE,cAAA,UACEc,IAAKD,EACLV,UAAW,QAAO6L,IAAWnL,EAAQ,aAAe,iBACpDT,MAAO,IACF+U,GACHzU,aAAc,MACdwC,MAAO,UACPO,gBAAiB,UACjBb,WAAY,QAEdrC,QAASA,KACP0L,EAAUpL,GACVwL,GAAkBL,IAEpBpH,SAAU2O,IAET0C,EACA1C,IAAWvH,IAAWnL,EACrB9E,IAAAiE,cAAA,OACEI,MAAO,CACLoB,MAAO,OACPC,OAAQ,OACRhB,OAAQ,kBACRyV,UAAW,wBACXxV,aAAc,MACdyV,UAAW,4BACX9T,WAAY,SAGd,QAMVtG,IAAAiE,cAAA,OACEG,UAAU,wBACVC,MAAO,CACLsD,QAAS,OACT0S,oBAAqB,uCACrBJ,IAAK,OACLK,UAAW,OACXV,UAAW,QACXhV,QAAS,OACTF,OAAQ,iBACRC,aAAc,MACd+C,gBAAiB,UACjBjC,MAAO,OACPI,aAAc,SAGfuJ,EAAazQ,IAAI,CAACub,EAAcpV,IAC/B9E,IAAAiE,cAAA,UACEc,IAAKD,EACLV,UAAW,QAAO6L,IAAWnL,EAAQ,aAAe,iBACpDT,MAAO,IACF+U,GACHzU,aAAc,MACdwC,MAAO,UACPO,gBAAiB,UACjBb,WAAY,QAEdrC,QAASA,KACP0L,EAAUpL,GACVwL,GAAkBL,IAEpBpH,SAAU2O,IAET0C,EACA1C,IAAWvH,IAAWnL,EACrB9E,IAAAiE,cAAA,OACEI,MAAO,CACLoB,MAAO,OACPC,OAAQ,OACRhB,OAAQ,kBACRyV,UAAW,wBACXxV,aAAc,MACdyV,UAAW,4BACX9T,WAAY,SAGd,SAQVtG,IAAAiE,cAACjF,EAAO,CACNE,OAAQ4Q,EACR3Q,WAAYA,IAAM4Q,GAAa,GAC/B3Q,UAAWA,EACXC,WAAYA,EACZC,cAAeA,EACfC,OAAQA,MAEVS,IAAAiE,cAAA,OACEI,MAAO,CAAEkW,cAAe,MAAO7U,OAAQ,OAAQD,MAAO,QACtDoI,GAAG,UAIH7N,IAAAiE,cAAA,OAAKG,UAAU,2DACI0B,GAAf8I,GAA2C,GAAfA,IAC5B5O,IAAAiE,cAAA,OAAKI,MAAO,CAAEsD,QAAS,SACrB3H,IAAAiE,cAAA,OAAKI,MAAO,CAAE4C,OAAQ,oBACpBjH,IAAAiE,cAAA,UACEG,UAAU,MACVC,MAAO,CACLqD,gBA/NG,UAgOHP,MAAO,QACPvC,QAAS,UAETD,aAAc,MACdgD,QAAS,OACTC,WAAY,SACZC,eAAgB,SAChB5C,SAAU,QAEZT,QAAS0P,GACT1N,MAAM,UACNqC,SAAU2O,IAETA,GACCxX,IAAAiE,cAAA,OACEI,MAAO,CACLoB,MAAO,OACPC,OAAQ,OACRhB,OAAQ,kBACRyV,UAAW,wBACXxV,aAAc,MACdyV,UAAW,+BAIfpa,IAAAiE,cAAA,QAAMI,MAAO,CAAEc,SAAU,OAAQqV,WAAY,MAAO,WAKxDxa,IAAAiE,cAAA,aACG,gMASHjE,IAAAiE,cAAA,OAAKI,MAAO,CAAE4C,OAAQ,oBACtBjH,IAAAiE,cAAA,UACEG,UAAU,MACVC,MAAO,CACPqD,gBAAiB,QACjBP,MAAO,QACPvC,QAAS,UACTO,SAAU,OACVR,aAAc,MACdgD,QAAS,OACTC,WAAY,SACZqS,IAAK,OAELzV,QA3ZCkF,UACf,GAAqB,OAAjBkC,EAIJ,IACE,MAAMrB,QAAiBC,IAAMC,KAAKiE,EAAY,CAC5C1E,SAAUA,EACVC,KAAMA,EACNwQ,SAAU7O,KACPvB,IAELuB,EAAe,KACXrB,EAAII,OAAQpL,IAAOuL,QAAQ,0BAC1BvL,IAAOoK,MAAM,WAAWY,EAAIY,SACjC,MAAOxB,GACPpK,IAAOoK,MAAM,WAAWA,QAdxBpK,IAAOmb,QAAQ,yBA0ZHlU,MAAM,UAENxG,IAAAiE,cAAA,QAAMI,MAAO,CAAEc,SAAU,OAAQqV,WAAY,MAAO,cAS9Dxa,IAAAiE,cAAA,OACEG,UAAW2K,EAAa4L,OAAS,uBACjCtW,MAAO,CACLoB,MAAO,OACPC,OAAQ2E,EAAoB,YAAIA,EAAoB,YAAI,SAInEA,EAAOuQ,aAEN5a,IAAAiE,cAAA,OAAKI,MAAO,CAAEwB,aAAc,GAAI8B,QAAS,OAAQsS,IAAK,MAAOrS,WAAY,SAAUoS,SAAU,SAE/Fha,IAAAiE,cAAA,UACEO,QAASA,KACPkM,GAAyB,IACzB3O,WAAW,KAAO,IAAD8Y,EACf,MAAM5E,EAA2B,QAAlB4E,EAAGrM,EAAQvM,eAAO,IAAA4Y,OAAA,EAAfA,EAAiB5E,UAC/BA,GAAatF,IACfsF,EAAU6E,iBAAiB,CACzBC,MAAOpK,GACPqK,YAAY,KAGf,IAEH3W,MAAO,CACLQ,WAAY,qBACZsC,MAAO,QACPzC,OAAQ,iCACRC,aAAc,MACdkC,WAAY,OACZ1B,SAAU,OACVP,QAAS,WACTqC,OAAQ,cACRwS,UAAW,+BACXwB,WAAY,YACZ1U,OAAQ,YAEb,iBAKInF,OAAOC,KAAKgJ,EAAOuQ,aAAajc,IAAIoG,GAGnC/E,IAAAiE,cAAA,UACEc,IAAKA,EACLP,QAASA,KACPkM,GAAyB1J,GACvBA,EAAKZ,SAASrB,GACViC,EAAKnD,OAAOqX,GAAKA,IAAMnW,GACvB,IAAIiC,EAAMjC,IAEhBhD,WAAW,KAAO,IAADoZ,EACf,MAAM9Z,EAAOoP,GAAsBrK,SAASrB,GACxC0L,GAAsB5M,OAAOqX,GAAKA,IAAMnW,GACxC,IAAI0L,GAAuB1L,GACzBqW,EAAgBpa,MAAMU,KAC1B,IAAIC,IAAIN,EAAKga,QAAQH,GAAK7Q,EAAOuQ,YAAYM,MAEzCjF,EAA2B,QAAlBkF,EAAG3M,EAAQvM,eAAO,IAAAkZ,OAAA,EAAfA,EAAiBlF,UAC/BA,GAAajV,MAAMC,QAAQ8N,EAAagE,cAC1ChE,EAAagE,WAAW1Q,QAASd,IAC/B0U,EAAUqF,iBACR/Z,EAAIuC,MACJsX,EAAchV,SAAS7E,EAAIuC,UAG/BsX,EAAc/Y,QAAQ,CAACyB,EAAOtB,KAC5ByT,EAAUsF,WAAWzX,EAAOtB,OAG/B,IAEL6B,MAAO,CACLQ,WAAY4L,GAAsBrK,SAASrB,GAAO,UAAY,UAC9DoC,MAAOsJ,GAAsBrK,SAASrB,GAAO,QAAU,UACvDL,OAAQ+L,GAAsBrK,SAASrB,GAAO,oBAAsB,iBACpEJ,aAAc,MACdkC,WAAY,OACZ1B,SAAU,OACVP,QAAS,WACTqC,OAAQ,cACRwS,UAAWhJ,GAAsBrK,SAASrB,GAAO,kCAAoC,OACrFkW,WAAY,YACZ1U,OAAQ,YAGTxB,KAOEsF,EAAOmR,qBAAuBxa,MAAMC,QAAQoJ,EAAOmR,sBAClDxb,IAAAiE,cAAA,OACEI,MAAO,CACPoB,MAAO,OACPZ,WAAY,UACZsC,MAAO,UACPvC,QAAS,WACTO,SAAU,OACVsW,aAAc,iBACdjU,WAAY,SACZqS,SAAU,SACV6B,aAAc,WACd7V,aAAc,MACdgB,WAAY,SAGZ7G,IAAAiE,cAAA,OACAI,MAAO,CACLsD,QAAS,QACTlC,MAAO,OACP+B,WAAY,SACZqS,SAAU,SACVvV,SAAU,aAGZtE,IAAAiE,cAAA,OACEI,MAAO,CACPsD,QAAS,eACTgU,YAAa,OACbvB,UAAW,oCAGV/P,EAAOmR,oBAAoB9G,KAAK,YAEnC1U,IAAAiE,cAAA,aACG,gRAehBoG,EAAsB,eAAiC,KAA5BA,EAAsB,eAChDrK,IAAAiE,cAAA,OAAKI,MAAO,CAAEwB,aAAc,IAG7BwE,EAA+B,wBAC9BrK,IAAAiE,cAAA,UACEO,QAASA,KACHgK,EAAQvM,SAAWuM,EAAQvM,QAAQwM,KACrCD,EAAQvM,QAAQwM,IAAImN,eAAe,KAGvCvX,MAAO,CACLQ,WAAY,qBACZsC,MAAO,QACPzC,OAAQ,iCACRC,aAAc,MACdkC,WAAY,OACZ1B,SAAU,OACVP,QAAS,WACTqC,OAAQ,cACRwS,UAAW,+BACXwB,WAAY,YACZ1U,OAAQ,YAEX,iBAME8S,GAAa1a,IAAI2K,GAChBtJ,IAAAiE,cAAA,UACEc,IAAKuE,EACL9E,QAASA,IA1bWT,KAG1B,GAFAyM,GAAgBzM,GAEZyK,EAAQvM,SAAWuM,EAAQvM,QAAQwM,IAAK,CAC1C,MAAMA,EAAMD,EAAQvM,QAAQwM,IAC5B,GAAI1K,EACF0K,EAAImN,eAAe,IACdnN,EAAIoN,iBACP,CAAClM,GAAgB,CAAEmM,WAAY,MAAOlT,OAAQ,CAAC7E,UAE5C,CACL,MAAMgY,EAAQtN,EAAIoN,wBACXE,EAAMpM,GACblB,EAAImN,eAAeG,MA6aFC,CAAmB1S,GAClCjF,MAAO,CACLQ,WAAY0L,KAAiBjH,EAAM,UAAY,UAC/CnC,MAAOoJ,KAAiBjH,EAAM,QAAU,UACxC5E,OAAQ6L,KAAiBjH,EAAM,oBAAsB,iBACrD3E,aAAc,MACdkC,WAAY,OACZ1B,SAAU,OACVP,QAAS,WACTqC,OAAQ,cACRwS,UAAWlJ,KAAiBjH,EAAM,kCAAoC,OACtE2R,WAAY,YACZ1U,OAAQ,YAGT+C,KAQCtJ,IAAAiE,cAACgY,cAAW,CACVra,IAAK4M,EACLoB,QAASA,EACTsM,oBAAqBjN,EACrBsG,gBAAiBA,GACjB4G,YA/gBW/N,IACf,GAAIA,EAAO9D,MAAmC,cAA3B8D,EAAO9D,KAAKmF,GACjC,MAAO,CAAE5I,WAAY,OAAQhC,WAAY,WAE3C,IAAK,IAADuX,EAAAC,EACF,MAAMxX,EAAqC,QAA3BuX,EAAGhO,EAAO9D,KAAgB,iBAAC,IAAA8R,SAAItW,EAE/C,MAAO,CAAEjB,aAAYsC,MADsB,QAAhCkV,EAAGjO,EAAO9D,KAAqB,sBAAC,IAAA+R,SAAIvW,GAE/C,MAAO6D,GAEP,YADAsB,QAAQtB,MAAM,6BAA8BA,KAwgBtC2S,aAAc,GACdC,UAAW,GACX9F,YAAaA,GACbI,mBAAoBA,GACpB2F,aAAa,EACbC,yBAAyB,EACzB1F,SAAUA,GACV2F,YAxrCWC,MACrB,IAAIhU,EAAU,IAAKoG,GAmBnB,OAlBI1E,EAAOuS,mBAAqBvS,EAAO2D,mBACrCrF,EAAQuF,cAAe,EACvBvF,EAAQ4F,yBAA2B,CACjCP,kBAAmBD,EAAuB1D,EAAO2D,kBAAmB,GACpEG,iBAAmBC,IACjB,IAAIC,EAAa,GACbrN,MAAMC,QAAQmN,EAAO9D,KAAK+D,YAC5BA,EAAaD,EAAO9D,KAAK+D,WAChBD,EAAO9D,KAAK+D,aACrBA,EAAa,CAACD,EAAO9D,KAAK+D,aAE5BD,EAAOE,gBAAgBD,EAAWlN,OAASkN,EAAa,QAI5D1F,EAAQuF,cAAe,EACvBvF,EAAQ4F,8BAA2BzI,GAE9B6C,GAoqCgBgU,GACbpF,mBAAoBA,GACpBG,YAAaA,GACbV,SAAkC,IAAzBjI,EAAaiI,SAA4BA,GAClD6F,cA9nCarL,IACjBA,EAAMzN,OACR+M,GAAuBU,EAAMzN,cC1OpB+Y,kBAhCDpQ,IACZ,MAAM,SACJ1C,EAAQ,IACRyE,EAAG,WACHC,EAAU,YACVE,EAAW,mBACXC,EAAkB,iBAClBkO,EAAgB,cAChBjO,EAAa,KACb7E,GACEyC,EAAMsQ,MACJ,aAAEjO,EAAY,OAAE1E,EAAS,IAAOqC,EAAMsQ,MACtC,MAAElY,EAAK,MAAE6V,GAAU5L,EAEzB,OACE/O,IAAAiE,cAAA,WACEjE,IAAAiE,cAACgZ,EAAM,CACLjT,SAAUA,EACVyE,IAAKA,EACLC,WAAYA,EACZE,YAAaA,EACbC,mBAAoBA,EACpBkO,iBAAkBA,EAClB9S,KAAMA,EACN8E,aAAcA,EACdjK,MAAOA,EACPuF,OAAQA,EACRyE,cAAeA,OClCvBoO,IAASC,OACPnd,IAAAiE,cAACjE,IAAMod,WAAU,KACfpd,IAAAiE,cAACoZ,EAAI,OAEPC,SAASC,eAAe,U","file":"static/js/main.1db34d0b.chunk.js","sourcesContent":["import React, { useEffect, useRef } from \"react\";\nimport ReactModal from \"react-modal\";\nimport \"./modal.css\";\nimport axios from \"axios\";\nimport { utcToZonedTime, format } from 'date-fns-tz';\nimport moment from \"moment\";\n\nconst formats = [\"YYYY-MM-DDTHH:mm\", \"MM/DD/YYYYTHH:mm\", \"MM/DD/YYYY HH:mm\", \"YYYY-MM-DD HH:mm\"];\nconst sliderRules = [\"buying_power\", \"borrow_power\"]\nconst sliderRules_stars = [\"Day\", \"Week\", \"Month\", \"Quarter\", \"Quarters\", \"Year\"];\nconst sliderRules_stars_margin = sliderRules_stars.map(rule => `${rule} Margin`);\n\n\n\n// const modalStyle = {\n//   content: {\n//     top: \"50%\",\n//     left: \"50%\",\n//     right: \"auto\",\n//     bottom: \"auto\",\n//     marginRight: \"-50%\",\n//     transform: \"translate(-50%, -50%)\",\n//     backgroundColor: \"yellow\",\n//     width: \"95vw\",           // Responsive width\n//     maxWidth: \"400px\",       // Limit max width for desktop\n//     minWidth: \"280px\",       // Minimum for mobile\n//     padding: \"16px\",\n//   },\n// };\n\nReactModal.setAppElement(\"#root\");\nlet isExecuting = false;\n\ninterface MyModalProps {\n  isOpen: boolean;\n  closeModal: () => void;\n  modalData: any;\n  promptText: any;\n  setPromptText: (value: any) => void;\n  toastr: any; // Define the toastr type if available\n}\n\nconst MyModal: React.FC<MyModalProps> = ({\n  isOpen,\n  closeModal,\n  modalData,\n  promptText,\n  setPromptText,\n  toastr,\n}) => {\n  const { prompt_field, prompt_order_rules, selectedRow, selectedField, add_symbol_row_info, display_grid_column } = modalData;\n  // console.log(\"modalData :>> \", display_grid_column, prompt_field); // workerbee handle in agagrid display_grid_column add var from mount\n  const [showStarsSliders, setShowStarsSliders] = React.useState(false);\n  const [showStarsMarginSliders, setShowStarsMarginSliders] = React.useState(false);\n  const [showActiveOrders, setShowActiveOrders] = React.useState(false);\n  const [showWaveData, setShowWaveData] = React.useState(true);\n  const [showButtonColData, setShowButtonColData] = React.useState(true);\n  const [sellQtys, setSellQtys] = React.useState<{ [key: number]: string }>({});\n  const handleSellQtyChange = (idx: number, value: string) => {\n    setSellQtys((prev) => ({ ...prev, [idx]: value }));\n  };\n\n  \nconst [editableValues, setEditableValues] = React.useState<{ [col: string]: { [idx: number]: any } }>({});\nconst editableCols = modalData.editableCols || [];\nconst ordersToRender = (selectedRow && display_grid_column && Array.isArray(selectedRow[display_grid_column]))\n  ? selectedRow[display_grid_column]\n  : [];\nconst dataCols = ordersToRender.length > 0 ? Object.keys(ordersToRender[0]) : [];\nconst editableColHeaders = editableCols.map((col: { col_header: string }) => col.col_header);\nconst allCols = Array.from(new Set([...editableColHeaders, ...dataCols]));\n  \nconst ref = useRef<HTMLButtonElement>(null);\n  const selectRef = useRef<HTMLSelectElement>(null);\n\n\n  const handleOkSecond = async () => {\n    if (isExecuting) return;\n    isExecuting = true;\n  try {\n    // Merge editable values into each order\n      const ordersToRender = display_grid_column && selectedRow && Array.isArray(selectedRow[display_grid_column])\n        ? selectedRow[display_grid_column]\n        : [];\n\n      if (!ordersToRender || !Array.isArray(ordersToRender)) {\n        toastr.error(\"No editable orders found for this action.\");\n        return;\n      }\n\n      const ordersWithEdits = ordersToRender.map((order: any, idx: number) => {\n        let edits: any = {};\n        editableCols.forEach((col: { col_header: string }) => {\n          edits[col.col_header] = editableValues[col.col_header]?.[idx] || \"\";\n        });\n        return { ...order, ...edits };\n      });\n    const body = {\n      username: modalData.username,\n      prod: modalData.prod,\n      selected_row: modalData.selectedRow,\n      default_value: promptText,\n      editable_orders: ordersWithEdits,\n      ...modalData.kwargs,\n    };\n      const { data: res } = await axios.post(modalData.button_api, body);\nconst { status, data, description } = res;\nif (status === \"success\") {\n  if (data && data.message_type === \"fade\") {\n    toastr.success(description, \"Success\");\n  } else {\n    alert(\"Success!\\nDescription: \" + description);\n  }\n} else {\n  if (data && data.message_type === \"fade\") {\n    toastr.error(description, \"Error\");\n  } else {\n    alert(\"Error!\\nDescription: \" + description);\n  }\n}\nif (data?.close_modal !== false) closeModal();\n    } catch (error: any) {\n      console.log(\"error :>> \", error);\n      toastr.error(error.message);\n    }\n    isExecuting = false;\n  };\n\n\n  useEffect(() => {\n    if (isOpen) setTimeout(() => ref.current?.focus(), 100);\n  }, [isOpen]);\n\n  useEffect(() => {\n  setSellQtys({}); // Reset sellQtys to an empty object\n}, [isOpen, selectedRow]);\n\n\nuseEffect(() => {\n  if (!editableCols || !selectedRow || !display_grid_column || !Array.isArray(selectedRow[display_grid_column])) return;\n  const orders = selectedRow[display_grid_column];\n  const reset: any = {};\n  editableCols.forEach(({ col_header }: { col_header: string }) => {\n    reset[col_header] = {};\n    orders.forEach((order: any, idx: number) => {\n      reset[col_header][idx] = order[col_header] ?? \"\"; // default to value in row if present\n    });\n  });\n  setEditableValues(reset);\n}, [isOpen, selectedRow, display_grid_column, editableCols]);\n\n  const isValidDate = (dateStr: string) => {\n    return formats.some(format => moment(dateStr, format, true).isValid());\n  };\n\n  const formatToLocalDatetime = (dateStr: string) => {\n    const date = moment(dateStr, formats, true).toDate();\n    const timeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;\n    const zonedDate = utcToZonedTime(date, timeZone);\n    return format(zonedDate, 'yyyy-MM-dd\\'T\\'HH:mm');\n  };\n\n  // Categorize fields by type\n  const textFields = [];\n  const booleanFields = [];\n  const datetimeFields = [];\n  const arrayFields = [];\n\n  const filtered_prompt_order_rules = Array.isArray(prompt_order_rules) && promptText\n  ? prompt_order_rules.filter((field) => field && (field in promptText))\n  : [];\n\n  if (prompt_order_rules) {\n    for (const rule of prompt_order_rules) {\n      const value = promptText[rule];\n      if (Array.isArray(value)) {\n        arrayFields.push(rule);\n      } else if (typeof value === \"boolean\") {\n        booleanFields.push(rule);\n      } else if (isValidDate(value)) {\n        datetimeFields.push(rule);\n      } else {\n        textFields.push(rule);\n      }\n    }\n  }\n\n\n\nreturn (\n  <ReactModal\n    isOpen={isOpen}\n    onRequestClose={closeModal}\n    // style={modalStyle}\n    ariaHideApp={false}\n  >\n    <div className=\"my-modal-content\">\n      {/* Modal Header */}\n      <div className=\"modal-header px-3 d-flex justify-content-center align-items-center\" style={{ position: \"relative\" }}>\n      <h4 className=\"text-center m-0\">{modalData.prompt_message}</h4>\n      <span className=\"close\" onClick={closeModal} style={{ position: \"absolute\", right: \"20px\" }}>\n        &times;\n      </span>\n\n      </div>\n\n      {/* Modal Body */}\n      <div className=\"modal-body p-3\">\n        <div className=\"d-flex flex-column\">\n          {/* Boolean Fields Top Row */}\n          {booleanFields.length > 0 && (\n            <div\n              className=\"d-flex flex-row justify-content-between mb-2\"\n              style={{\n                border: \"1px solid #e0e0e0\", // Light gray outline\n                borderRadius: \"8px\",\n                padding: \"8px\",\n                background: \"#fafcff\"\n              }}\n            >\n              {booleanFields.map((rule: any, index: number) => (\n                <div className=\"d-flex flex-column align-items-center\" key={index} style={{ marginRight: \"8px\" }}>\n                  <label className=\"mb-0\" style={{ minWidth: \"100px\", textAlign: \"center\", fontSize: \"0.9rem\" }}>\n                    {rule}:\n                  </label>\n                  <input\n                    type=\"checkbox\"\n                    checked={promptText[rule]}\n                    onChange={(e) =>\n                      setPromptText({\n                        ...promptText,\n                        [rule]: e.target.checked,\n                      })\n                    }\n                    style={{ width: \"16px\", height: \"16px\", marginTop: \"4px\" }}\n                  />\n                </div>\n              ))}\n            </div>\n          )}\n\n\n\n      {/* Add Symbol Row Info Column */}\n      {add_symbol_row_info && Array.isArray(add_symbol_row_info) && (\n        <div\n          className=\"d-flex flex-wrap\"\n          style={{\n        flex: 1,\n        border: \"1px solid #e0e0e0\",\n        borderRadius: \"8px\",\n        padding: \"8px\",\n        background: \"#fafcff\",\n        marginBottom: \"8px\"\n          }}\n        >\n          {add_symbol_row_info.map((col: string, idx: number) =>\n        selectedRow && selectedRow[col] !== undefined && (\n          <div\n            key={col}\n            style={{\n          flex: \"1 1 30%\",\n          minWidth: \"120px\",\n          marginBottom: \"8px\",\n          paddingRight: \"12px\"\n            }}\n          >\n            <b>{col}: </b>\n            {typeof selectedRow[col] === \"number\"\n          ? Number(selectedRow[col]).toLocaleString(undefined, { maximumFractionDigits: 2 })\n          : String(selectedRow[col])}\n          </div>\n        )\n          )}\n        </div>\n      )}\n\n      {/* Other Fields (Text, Datetime, Array Fields) */}\n      <div className=\"d-flex flex-row justify-content-between\">\n        {/* Text Fields Column */}\n        {textFields.length > 0 && (\n          <div className=\"d-flex flex-column\" style={{ flex: 1, marginRight: \"8px\" }}>\n            {textFields.map((rule: any, index: number) => {\n              if (sliderRules_stars.includes(rule)) return null;\n              if (sliderRules_stars_margin.includes(rule)) return null;\n              const isSliderRule = sliderRules.includes(rule);\n              return (\n                <div className=\"d-flex flex-column align-items-start mb-1\" key={index}>\n                  <label className=\"mb-0\" style={{ fontSize: \"0.9rem\" }}>\n                    {rule}:\n                    {rule === \"sell_amount\" && (\n                      <span\n                        style={{ marginLeft: \"4px\", cursor: \"pointer\" }}\n                        title=\"This amount will override sell_qty\"\n                      >\n                        ❓\n                      </span>\n                    )}\n                  </label>\n                  {isSliderRule ? (\n                    <>\n                      <input\n                        type=\"range\"\n                        min=\"0\"\n                        max=\"1\"\n                        step=\".01\"\n                        value={promptText[rule] || 0}\n                        onChange={(e) =>\n                          setPromptText({\n                            ...promptText,\n                            [rule]: Number(e.target.value),\n                          })\n                        }\n                        style={{ width: \"100%\" }}\n                      />\n                      <span style={{ fontSize: \"0.9rem\", fontWeight: \"bold\", marginTop: \"4px\" }}>\n                        {promptText[rule] || 0}\n                      </span>\n                    </>\n                  ) : (\n                    <input\n                      type=\"text\"\n                      value={promptText[rule]}\n                      onChange={(e) =>\n                        setPromptText({\n                          ...promptText,\n                          [rule]: e.target.value,\n                        })\n                      }\n                      style={{ flex: 1, width: \"100%\", padding: \"4px\", fontSize: \"0.9rem\" }}\n                    />\n                  )}\n                </div>\n              );\n            })}\n          </div>\n        )}\n\n        {/* Array Fields Column */}\n        {arrayFields.length > 0 && (\n          <div className=\"d-flex flex-column\" style={{ flex: 1 }}>\n            {arrayFields.map((rule: any, index: number) => (\n              <div className=\"d-flex flex-column align-items-start mb-1\" key={index}>\n                <label className=\"mb-0\" style={{ fontSize: \"0.9rem\" }}>\n                  {rule}:\n                </label>\n                <select\n                  value={promptText[rule][0]}\n                  onChange={(e) =>\n                    setPromptText({\n                      ...promptText,\n                      [rule]: [e.target.value],\n                    })\n                  }\n                  style={{ flex: 1, width: \"100%\", padding: \"4px\", fontSize: \"0.9rem\" }}\n                >\n                  {promptText[rule].map((item: any, i: number) => (\n                    <option key={i} value={item}>\n                      {item}\n                    </option>\n                  ))}\n                </select>\n              </div>\n            ))}\n          </div>\n        )}\n\n        {/* Expander for sliderRules_stars */}\n        {sliderRules_stars.some((rule: any) => prompt_order_rules?.includes(rule)) && (\n          <div style={{ flex: 1, marginRight: \"8px\" }}>\n            <div\n              style={{ cursor: \"pointer\", fontWeight: \"bold\", marginBottom: \"4px\" }}\n              onClick={() => setShowStarsSliders((prev) => !prev)}\n            >\n              {showStarsSliders ? \"▼\" : \"►\"} Advanced Allocation Options\n            </div>\n            {showStarsSliders && (\n              <div>\n                {sliderRules_stars.map((rule: any, index: number) =>\n                  prompt_order_rules?.includes(rule) && promptText[rule] !== undefined && (\n                    <div className=\"d-flex flex-column align-items-start mb-1\" key={index}>\n                      <label className=\"mb-0\" style={{ fontSize: \"0.9rem\" }}>\n                        {rule}:\n                      </label>\n                      <input\n                        type=\"range\"\n                        min=\"0\"\n                        max=\"1\"\n                        step=\".01\"\n                        value={promptText[rule] || 0}\n                        onChange={(e) =>\n                          setPromptText({\n                            ...promptText,\n                            [rule]: Number(e.target.value),\n                          })\n                        }\n                        style={{ width: \"100%\" }}\n                      />\n                      <span style={{ fontSize: \"0.9rem\", fontWeight: \"bold\", marginTop: \"4px\" }}>\n                        {promptText[rule] || 0}\n                      </span>\n                    </div>\n                  )\n                )}\n              </div>\n            )}\n          </div>\n        )}\n\n        {/* Expander for sliderRules_stars_margin */}\n        {sliderRules_stars_margin.some((rule: any) => prompt_order_rules?.includes(rule)) && (\n          <div style={{ flex: 1, marginRight: \"8px\" }}>\n            <div\n              style={{ cursor: \"pointer\", fontWeight: \"bold\", marginBottom: \"4px\" }}\n              onClick={() => setShowStarsMarginSliders((prev) => !prev)}\n            >\n              {showStarsMarginSliders ? \"▼\" : \"►\"} Advanced Margin Allocation Options\n            </div>\n            {showStarsMarginSliders && (\n              <div>\n                {sliderRules_stars_margin.map((rule: any, index: number) =>\n                  prompt_order_rules?.includes(rule) && promptText[rule] !== undefined && (\n                    <div className=\"d-flex flex-column align-items-start mb-1\" key={index}>\n                      <label className=\"mb-0\" style={{ fontSize: \"0.9rem\" }}>\n                        {rule}:\n                      </label>\n                      <input\n                        type=\"range\"\n                        min=\"0\"\n                        max=\"1\"\n                        step=\".01\"\n                        value={promptText[rule] || 0}\n                        onChange={(e) =>\n                          setPromptText({\n                            ...promptText,\n                            [rule]: Number(e.target.value),\n                          })\n                        }\n                        style={{ width: \"100%\" }}\n                      />\n                      <span style={{ fontSize: \"0.9rem\", fontWeight: \"bold\", marginTop: \"4px\" }}>\n                        {promptText[rule] || 0}\n                      </span>\n                    </div>\n                  )\n                )}\n              </div>\n            )}\n          </div>\n        )}\n\n        {/* Datetime Fields Column */}\n        {datetimeFields.length > 0 && (\n          <div className=\"d-flex flex-column\" style={{ flex: 1, marginRight: \"8px\" }}>\n            {datetimeFields.map((rule: any, index: number) => (\n              <div className=\"d-flex flex-column align-items-start mb-1\" key={index}>\n                <label className=\"mb-0\" style={{ fontSize: \"0.9rem\" }}>\n                  {rule}:\n                </label>\n                <input\n                  type=\"datetime-local\"\n                  value={promptText[rule] && formatToLocalDatetime(promptText[rule])}\n                  onChange={(e) =>\n                    setPromptText({\n                      ...promptText,\n                      [rule]: e.target.value,\n                    })\n                  }\n                  style={{ flex: 1, width: \"100%\", padding: \"4px\", fontSize: \"0.9rem\" }}\n                />\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n\n      {/* Display Grid Column Table */}\n      {display_grid_column &&\n        selectedRow &&\n        Array.isArray(selectedRow[display_grid_column]) &&\n        selectedRow[display_grid_column].length > 0 && (\n          <div style={{ margin: \"16px 0\" }}>\n            <div\n              style={{ cursor: \"pointer\", fontWeight: \"bold\", marginBottom: \"4px\" }}\n              onClick={() => setShowButtonColData((prev: boolean) => !prev)}\n            >\n              <span style={{ marginRight: \"8px\" }}>\n                {showButtonColData ? \"▼\" : \"►\"}\n              </span>\n              <button\n                type=\"button\"\n                className=\"btn btn-link p-0\"\n                style={{ fontWeight: \"bold\", textDecoration: \"underline\", color: \"#007bff\", background: \"none\", border: \"none\", cursor: \"pointer\" }}\n                onClick={() => setShowButtonColData((prev: boolean) => !prev)}\n              >\n                {display_grid_column}\n              </button>\n            </div>\n            {showButtonColData && (() => {\n              const ordersToRender = selectedRow[display_grid_column];\n              return (\n                <div style={{ overflowX: \"auto\" }}>\n                  <table className=\"table table-bordered table-sm\" style={{ fontSize: \"0.6rem\" }}>\n<thead>\n  <tr>\n    {allCols.map((col) => {\n      const editableCol = editableCols.find(\n        (ec: { col_header: string }) => ec.col_header === col\n      );\n\n      return (\n        <th\n          key={col}\n          style={{\n            whiteSpace: \"normal\",\n            wordWrap: \"break-word\",\n            backgroundColor: \"#fafcff\", // Light background\n            color: \"black\", // Black text\n            textAlign: \"center\", // Center align text\n          }}\n        >\n          <div style={{ display: \"flex\", alignItems: \"center\", justifyContent: \"center\" }}>\n            {/* Use display_name if available, otherwise fallback to col */}\n            {editableCol?.display_name || col.replace(/_/g, \" \")}\n            {editableCol?.info && (\n              <span\n                style={{\n                  marginLeft: \"4px\",\n                  cursor: \"pointer\",\n                  color: \"#007bff\",\n                  fontSize: \"0.8rem\",\n                }}\n                title={editableCol.info} // Tooltip text from the \"info\" key\n              >\n                ❓\n              </span>\n            )}\n          </div>\n        </th>\n      );\n    })}\n  </tr>\n</thead>\n      <tbody>\n        {ordersToRender.map((order: any, idx: number) => (\n          <tr key={idx}>\n            {allCols.map((col) => {\n              const editableCol = editableCols.find((ec: { col_header: string; }) => ec.col_header === col);\n\n                      if (col === \"sell_qty\") {\n          // Handle sell_qty column logic\n          return (\n            <td key={col}>\n              <input\n                type=\"number\"\n                min={0}\n                max={order.qty_available} // Limit to qty_available\n                value={editableValues[col]?.[idx] || \"\"}\n                onChange={(e) => {\n                  let value = e.target.value;\n                  if (value === \"\") {\n                    setEditableValues((prev) => ({\n                      ...prev,\n                      [col]: { ...prev[col], [idx]: \"\" },\n                    }));\n                    return;\n                  }\n                  let num = Number(value);\n                  if (num < 0) num = 0; // Ensure no negative values\n                  if (\n                    order.qty_available !== undefined &&\n                    num > order.qty_available\n                  )\n                    num = order.qty_available; // Limit to max qty_available\n\n                  setEditableValues((prev) => ({\n                    ...prev,\n                    [col]: { ...prev[col], [idx]: num },\n                  }));\n\n                  // Update the promptText with the updated sell_qty\n                  const updatedOrders = ordersToRender.map(\n                    (ord: any, i: number) => ({\n                      ...ord,\n                      sell_qty:\n                        i === idx\n                          ? String(num)\n                          : editableValues[col]?.[i] || \"\",\n                    })\n                  );\n                  setPromptText({\n                    ...promptText,\n                    active_orders_with_qty: updatedOrders,\n                  });\n                }}\n                style={{ width: \"80px\", fontSize: \"0.8rem\" }}\n              />\n            </td>\n          );\n        } else if (editableCol) {\n\n              if (editableCol.dtype === \"list\") {\n      // Render dropdown for dtype: \"list\"\n      const options = editableCol.values || []; // Use editable dictionary for dropdown options\n      return (\n        <td key={col}>\n          <select\n            value={editableValues[col]?.[idx] || \"\"}\n            onChange={(e) => {\n              const value = e.target.value;\n              setEditableValues((prev) => ({\n                ...prev,\n                [col]: { ...prev[col], [idx]: value },\n              }));\n            }}\n            style={{ width: \"100%\", fontSize: \"0.8rem\", padding: \"4px\", minWidth: \"80px\", }}\n          >\n            <option value=\"\" disabled>\n              Select...\n            </option>\n            {options.map((option: string, i: number) => (\n              <option key={i} value={option}>\n                {option}\n              </option>\n            ))}\n          </select>\n        </td>\n      );\n    }\n\n\n          // Render input for editable column\n          else if (editableCol.dtype === \"checkbox\") {\n            return (\n              <td key={col}>\n                <input\n                        type=\"checkbox\"\n                        checked={!!editableValues[col]?.[idx]}\n                        onChange={e => {\n                          const value = e.target.checked;\n                          setEditableValues(prev => ({\n                            ...prev,\n                            [col]: { ...prev[col], [idx]: value }\n                          }));\n                        }}\n                      />\n                    </td>\n                  );\n                } else if (editableCol.dtype === \"number\") {\n                  return (\n                    <td key={col}>\n                      <input\n                        type=\"number\"\n                        value={editableValues[col]?.[idx] || \"\"}\n                        onChange={e => {\n                          const value = e.target.value;\n                          setEditableValues(prev => ({\n                            ...prev,\n                            [col]: { ...prev[col], [idx]: value }\n                          }));\n                        }}\n                        style={{ width: \"80px\", fontSize: \"0.8rem\" }}\n                      />\n                    </td>\n                  );\n                }else if (editableCol.dtype === \"datetime\") {\n                        return (\n                          <td key={col}>\n                            <input\n                              type=\"datetime-local\"\n                              value={editableValues[col]?.[idx] || \"\"}\n                              onChange={e => {\n                                const value = e.target.value;\n                                setEditableValues(prev => ({\n                                  ...prev,\n                                  [col]: { ...prev[col], [idx]: value }\n                                }));\n                              }}\n                              style={{ width: \"140px\", fontSize: \"0.8rem\" }}\n                            />\n                          </td>\n                        );\n                } else {\n                  // text\n                  return (\n                    <td key={col}>\n                      <input\n                        type=\"text\"\n                        value={editableValues[col]?.[idx] || \"\"}\n                        onChange={e => {\n                          const value = e.target.value;\n                          setEditableValues(prev => ({\n                            ...prev,\n                            [col]: { ...prev[col], [idx]: value }\n                          }));\n                        }}\n                        style={{ width: \"80px\", fontSize: \"0.8rem\" }}\n                      />\n                    </td>\n                  );\n                }\n              } else {\n                // Render plain text for non-editable columns\n                return (\n                  <td key={col}>\n                    {order && order[col] !== undefined\n                      ? typeof order[col] === \"number\"\n                        ? Number(order[col]).toLocaleString(undefined, { maximumFractionDigits: 2 })\n                        : String(order[col])\n                      : \"\"}\n                  </td>\n                );\n              }\n            })}\n          </tr>\n        ))}\n      </tbody>\n      <tfoot>\n        <tr>\n          {allCols.map((col) => {\n            try {\n              // Only sum numeric columns\n              const sum = ordersToRender.reduce((acc: number, order: any) => {\n                const val = order[col];\n                return typeof val === \"number\" && !isNaN(val) ? acc + val : acc;\n              }, 0);\n              // Show subtotal only if at least one value was numeric\n              const hasNumeric = ordersToRender.some((order: any) => typeof order[col] === \"number\" && !isNaN(order[col]));\n              return (\n                <td key={col} style={{ fontWeight: \"bold\", background: \"#f7f7f7\" }}>\n                  {hasNumeric ? sum.toLocaleString(undefined, { maximumFractionDigits: 2 }) : \"\"}\n                </td>\n              );\n            } catch (e) {\n              return <td key={col}></td>;\n            }\n          })}\n        </tr>\n      </tfoot>\n                  </table>\n                </div>\n              );\n            })()}\n          </div>\n      )}\n\n\n\n\n      \n      \n        \n        </div>\n      </div>\n\n\n      {/* Modal Footer */}\n      <div className=\"modal-footer d-flex justify-content-center\" style={{ position: \"sticky\", bottom: 0,}}>\n        <button type=\"button\" className=\"btn btn-primary mx-2\" onClick={handleOkSecond} ref={ref}>\n          Ok\n        </button>\n        <button type=\"button\" className=\"btn btn-secondary mx-2\" onClick={closeModal}>\n          Cancel\n        </button>\n      </div>\n    </div>\n  </ReactModal>\n);\n  \n};\n\nexport default MyModal;\n","// stole from https://github.com/andfanilo/streamlit-echarts/blob/master/streamlit_echarts/frontend/src/utils.js Thanks andfanilo\nfunction mapObject(obj, fn, keysToIgnore) {\n    let keysToMap = Object.keys(obj)\n    return keysToMap.reduce((res, key) => {\n        if (!keysToIgnore.includes(key)) {\n            res[key] = fn(obj[key]);\n            return res\n        }\n        res[key] = obj[key];\n        return res\n\n    }, {})\n}\n\nfunction deepMap(obj, fn, keysToIgnore = []) {\n    const deepMapper = (val) =>\n        val !== null && typeof val === \"object\" ? deepMap(val, fn) : fn(val)\n    if (Array.isArray(obj)) {\n        return obj.map(deepMapper)\n    }\n    if (typeof obj === \"object\") {\n        return mapObject(obj, deepMapper, keysToIgnore)\n    }\n    return obj\n}\n\nexport { deepMap }\n","import Select from \"react-select\";\r\nimport React, {\r\n  useState,\r\n  useEffect,\r\n  useMemo,\r\n  useRef,\r\n  useCallback\r\n} from \"react\"\r\nimport { AgGridReact } from \"ag-grid-react\"\r\nimport { RowClassParams } from 'ag-grid-community';\r\n\r\nimport toastr from \"toastr\"\r\nimport \"toastr/build/toastr.min.css\"\r\nimport \"ag-grid-community/styles/ag-grid.css\"\r\nimport \"ag-grid-community/styles/ag-theme-alpine.css\"\r\nimport \"ag-grid-community/styles/ag-theme-balham.css\"\r\nimport \"ag-grid-community/styles/ag-theme-material.css\"\r\nimport MyModal from './components/Modal'\r\nimport \"ag-grid-enterprise\"\r\nimport { parseISO, compareAsc, set, sub } from \"date-fns\"\r\nimport { format } from \"date-fns-tz\"\r\nimport { duration } from \"moment\"\r\nimport \"./styles.css\"\r\nimport axios from \"axios\"\r\n// import { io } from \"socket.io-client\";\r\n\r\nimport {\r\n  ComponentProps,\r\n  Streamlit,\r\n  withStreamlitConnection,\r\n} from \"streamlit-component-lib\"\r\nimport {\r\n  ColDef,\r\n  ColGroupDef,\r\n  ColumnResizedEvent,\r\n  GetRowIdFunc,\r\n  GetRowIdParams,\r\n  Grid,\r\n  GridOptions,\r\n  GridReadyEvent,\r\n  SideBarDef,\r\n  ValueParserParams,\r\n} from \"ag-grid-community\"\r\nimport {deepMap} from \"./utils\"\r\n\r\n\r\ntype Props = {\r\n  username: string\r\n  api: string\r\n  api_update: string\r\n  api_ws?: string\r\n  refresh_sec?: number\r\n  refresh_cutoff_sec?: number\r\n  gridoption_build?: any\r\n  prod?: boolean\r\n  grid_options?: any\r\n  index: string\r\n  enable_JsCode: boolean\r\n  kwargs: any,\r\n}\r\n\r\nlet g_rowdata: any[] = []\r\nlet g_newRowData: any = null\r\n\r\n\r\nfunction dateFormatter(isoString: string, formaterString: string): String {\r\n  try {\r\n    let date = new Date(isoString)\r\n    return format(date, formaterString)\r\n  } catch {\r\n    return isoString\r\n  } finally {\r\n  }\r\n}\r\n\r\nfunction currencyFormatter(number: any, currencySymbol: string): String {\r\n  let n = Number.parseFloat(number)\r\n  if (!Number.isNaN(n)) {\r\n    return currencySymbol + n.toFixed(2)\r\n  } else {\r\n    return number\r\n  }\r\n}\r\n\r\nfunction numberFormatter(number: any, precision: number): String {\r\n  let n = Number.parseFloat(number)\r\n  if (!Number.isNaN(n)) {\r\n    return n.toFixed(precision)\r\n  } else {\r\n    return number\r\n  }\r\n}\r\n\r\nconst columnFormaters = {\r\n  columnTypes: {\r\n    dateColumnFilter: {\r\n      filter: \"agDateColumnFilter\",\r\n      filterParams: {\r\n        comparator: (filterValue: any, cellValue: string) =>\r\n          compareAsc(parseISO(cellValue), filterValue),\r\n      },\r\n    },\r\n    numberColumnFilter: {\r\n      filter: \"agNumberColumnFilter\",\r\n    },\r\n    shortDateTimeFormat: {\r\n      valueFormatter: (params: any) =>\r\n        dateFormatter(params.value, \"dd/MM/yyyy HH:mm\"),\r\n    },\r\n    customDateTimeFormat: {\r\n      valueFormatter: (params: any) =>\r\n        dateFormatter(params.value, params.column.colDef.custom_format_string),\r\n    },\r\n    customNumericFormat: {\r\n      valueFormatter: (params: any) =>\r\n        numberFormatter(params.value, params.column.colDef.precision ?? 2),\r\n    },\r\n    customCurrencyFormat: {\r\n      valueFormatter: (params: any) =>\r\n        currencyFormatter(\r\n          params.value,\r\n          params.column.colDef.custom_currency_symbol\r\n        ),\r\n    },\r\n    timedeltaFormat: {\r\n      valueFormatter: (params: any) => duration(params.value).humanize(true),\r\n    },\r\n  },\r\n}\r\n\r\n\r\nconst HyperlinkRenderer = (props: any) => {\r\n  const linkField = props.column.colDef[\"linkField\"];\r\n  const baseURL = props.column.colDef.baseURL;\r\n  const linkValue = props.data && linkField ? props.data[linkField] : null;\r\n\r\n  // Only render a link for real data rows\r\n  if (linkValue && baseURL) {\r\n    return (\r\n      <a href={`${baseURL}/${linkValue}`} target=\"_blank\" rel=\"noopener noreferrer\">\r\n        {props.value}\r\n      </a>\r\n    );\r\n  }\r\n  // For pivot/group/total rows, just render the value\r\n  return <span>{props.value}</span>;\r\n};\r\n\r\n\r\ntoastr.options = {\r\n  positionClass: \"toast-top-full-width\",\r\n  hideDuration: 300,\r\n  timeOut: 3000,\r\n}\r\n\r\n\r\n\r\nconst AgGrid = (props: Props) => {\r\nconst BtnCellRenderer = (props: any) => {\r\n  const btnClickedHandler = () => {\r\n    props.clicked(props.node.id)\r\n  };\r\n  if (!props || !props.node) return null;\r\n  if (props.node.rowPinned === 'bottom') {\r\n    return <span>{props.value}</span>;\r\n  }\r\n  // Use subtotal row style if present\r\n  const subtotalStyle =\r\n    props.data && props.col_header && props.data[`${props.col_header}_cellStyle`]\r\n      ? props.data[`${props.col_header}_cellStyle`]\r\n      : props.cellStyle;\r\n\r\n  return (\r\n    <button\r\n      onClick={btnClickedHandler}\r\n      style={{\r\n        background: \"transparent\",\r\n        border: subtotalStyle?.border || \"none\",\r\n        width: props.width ? props.width : \"100%\",\r\n        color: subtotalStyle?.color || \"inherit\",\r\n        ...subtotalStyle,\r\n      }}\r\n    >\r\n      {props.col_header ? props.value : props.buttonName}\r\n    </button>\r\n  );\r\n};\r\nfunction buildDetailGridOptions(detailGridOptions: any, level: number): any {\r\n  const options = { ...detailGridOptions, masterDetail: true };\r\n\r\n  options.getDetailRowData = (params: any) => {\r\n    let nestedRows = [];\r\n    if (Array.isArray(params.data.nestedRows)) {\r\n      nestedRows = params.data.nestedRows;\r\n    } else if (params.data.nestedRows) {\r\n      nestedRows = [params.data.nestedRows];\r\n    }\r\n    params.successCallback(nestedRows.length ? nestedRows : []);\r\n  };\r\n\r\n  if (\r\n    options.detailCellRendererParams &&\r\n    options.detailCellRendererParams.detailGridOptions\r\n  ) {\r\n    options.detailCellRendererParams.detailGridOptions = buildDetailGridOptions(\r\n      options.detailCellRendererParams.detailGridOptions,\r\n      level + 1\r\n    );\r\n  }\r\n\r\n  return options;\r\n}\r\n\r\nconst getGridOptions = () => {\r\n  let options = { ...grid_options };\r\n  if (kwargs.nestedGridEnabled && kwargs.detailGridOptions) {\r\n    options.masterDetail = true;\r\n    options.detailCellRendererParams = {\r\n      detailGridOptions: buildDetailGridOptions(kwargs.detailGridOptions, 1),\r\n      getDetailRowData: (params: any) => {\r\n        let nestedRows = [];\r\n        if (Array.isArray(params.data.nestedRows)) {\r\n          nestedRows = params.data.nestedRows;\r\n        } else if (params.data.nestedRows) {\r\n          nestedRows = [params.data.nestedRows];\r\n        }\r\n        params.successCallback(nestedRows.length ? nestedRows : []);\r\n      },\r\n    };\r\n  } else {\r\n    options.masterDetail = false;\r\n    options.detailCellRendererParams = undefined;\r\n  }\r\n  return options;\r\n};\r\n\r\n\r\n  const gridRef = useRef<AgGridReact>(null)\r\n  const {\r\n    username,\r\n    api,\r\n    api_update,\r\n    api_ws = undefined,\r\n    refresh_sec = undefined,\r\n    refresh_cutoff_sec = 0,\r\n    prod = true,\r\n    index,\r\n    enable_JsCode,\r\n    kwargs,\r\n  } = props\r\n  let { grid_options = {} } = props\r\n\r\n  //parsing must be done here. For some unknow reason if its moved after the\r\n  //button mapping, deepMap gets lots of React objects (api, symbolRefs, etc.)\r\n  //this impacts performance and crashes the grid.\r\n  if (enable_JsCode) {\r\n    grid_options = deepMap(grid_options, parseJsCodeFromPython, [\"rowData\"])\r\n  }\r\n\r\n  const [subtotalsRow, setSubtotalsRow] = useState<any[]>([]);\r\n  let { buttons, toggle_views, api_key, api_lastmod_key = null, columnOrder=[], \r\n    refresh_success=null, total_col=false, subtotal_cols=[], filter_button=''} = kwargs\r\n  const [rowData, setRowData] = useState<any[]>([])\r\n  const [modalShow, setModalshow] = useState(false)\r\n  const [modalData, setModalData] = useState({})\r\n  const [promptText, setPromptText] = useState(\"\")\r\n  const [viewId, setViewId] = useState(0)\r\n  const [lastModified, setLastModified] = useState<string | null>(null);\r\n  const [previousViewId, setpreviousViewId] = useState(89)\r\n  const [activeFilter, setActiveFilter] = useState<string | null>(null);\r\n  const [selectedColumnSetKeys, setSelectedColumnSetKeys] = useState<string[]>([]);\r\n  const [initialColumnState, setInitialColumnState] = useState<any>(null);\r\n\r\n  const [selectedCellContent, setSelectedCellContent] = useState<string | null>(null);\r\n\r\n  const onCellClicked = (event: any) => {\r\n    if (event.value) {\r\n      setSelectedCellContent(event.value); // Set the clicked cell's value\r\n    }\r\n  };\r\n\r\nuseEffect(() => {\r\n  if (!kwargs.api_ws) {\r\n    console.warn(\"api_ws is undefined, WebSocket not started.\");\r\n    return;\r\n  }\r\n\r\n const ws = new WebSocket(kwargs.api_ws);\r\n   \r\n ws.onopen = () => {\r\n    ws.send(JSON.stringify({\r\n      username: username,\r\n      grid: rowData, // send the current grid data\r\n      api_key: api_key,\r\n    }));\r\n  };\r\n\r\nws.onmessage = (event) => {\r\n  const { row_id, updates } = JSON.parse(event.data);\r\n  const existingNode = gridRef.current?.api.getRowNode(row_id);\r\n  if (existingNode && existingNode.data) {\r\n    const updatedRow = { ...existingNode.data, ...updates };\r\n    updatedRow[index] = row_id; // Ensure the id field is present\r\n    gridRef.current?.api.applyTransaction({\r\n      update: [updatedRow]\r\n    });\r\n  } else {\r\n    console.log(\"Row not found for update:\", row_id);\r\n  }\r\n};\r\n  return () => ws.close();\r\n}, [kwargs.api_ws, index, rowData]);\r\n\r\n\r\nconst checkLastModified = async (): Promise<boolean> => {\r\n    try {\r\n      if (api_lastmod_key === null) {\r\n        console.log(\"api key is null, returning false\");\r\n        return true;\r\n      }\r\n      if (api_lastmod_key !== null && api_lastmod_key !== undefined) {\r\n        const baseurl = api.split('/').slice(0, -1).join('/');\r\n        const res = await axios.get(`${baseurl}/lastmod_key`, {\r\n          params: {\r\n            api_key: api_key,\r\n            client_user: username,\r\n            prod: prod,\r\n            api_lastmod_key: api_lastmod_key,\r\n          },\r\n        });\r\n        // console.log(\"fetching data...\", res.data.lastModified);\r\n        if (res.data?.lastModified !== lastModified) {\r\n          // console.log(\"setting modified changed, fetching data...\", res.data.lastModified, lastModified);\r\n          setLastModified(res.data.lastModified);\r\n          return true;\r\n        } else {\r\n          return false;\r\n        }\r\n      }\r\n      return false;\r\n    } catch (error: any) {\r\n      toastr.error(`Failed to check last modified: ${error.message}`);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const checkViewIdChanged = async (currentViewId: number, previousViewId: number): Promise<boolean> => {\r\n    if (currentViewId !== previousViewId) {\r\n      // console.log(\"viewId has changed from\", previousViewId, \"to\", currentViewId);\r\n      setpreviousViewId(currentViewId);\r\n      return true;\r\n    } else {\r\n      // console.log(\"viewId has not changed\");\r\n      return false;\r\n    }\r\n  };\r\n\r\n  // BUTTONS, MOVE OUT OF USEEFFECT\r\n  useEffect(() => {\r\n    Streamlit.setFrameHeight();\r\n  \r\n    if (buttons.length) {\r\n      // console.log(\"Processing buttons:\", buttons);\r\n      buttons = deepMap(buttons, parseJsCodeFromPython, [\"rowData\"]); // process JsCode from buttons props\r\n  \r\n      buttons.forEach((button: any) => {\r\n        \r\n        const {\r\n          prompt_field,\r\n          prompt_message,\r\n          button_api,\r\n          prompt_order_rules,\r\n          col_header,\r\n          col_headername,\r\n          col_width,\r\n          pinned,\r\n          button_name,\r\n          border_color,\r\n          border,\r\n          add_symbol_row_info,\r\n          display_grid_column,\r\n          editableCols,\r\n          ...otherKeys\r\n        } = button;\r\n\r\n        let filterParams = button.filterParams || {};\r\n        if (kwargs['filter_apply']) {\r\n          filterParams = { ...filterParams, buttons: ['apply', 'reset'] };\r\n        }\r\n\r\n        grid_options.columnDefs!.push({\r\n          ...otherKeys,\r\n          field: col_header || index,\r\n          headerName: col_headername,\r\n          width: col_width,\r\n          pinned: pinned,\r\n          cellRenderer: BtnCellRenderer,\r\n          // valueFormatter: otherKeys.valueFormatter ? otherKeys.valueFormatter : undefined,\r\n          filterParams,\r\n          cellRendererParams: {\r\n            col_header,\r\n            buttonName: button_name,\r\n            borderColor: border_color,\r\n            border: border,\r\n            filterParams,\r\n            cellStyle: button.cellStyle,\r\n            // valueFormatter: button.valueFormatter,\r\n            ...(button.cellRendererParams || {}),\r\n            clicked: async function (row_index: any) {\r\n              try {\r\n                const selectedRow = g_rowdata.find((row) => row[index] === row_index);\r\n                if (prompt_order_rules) {\r\n                  const str = selectedRow[prompt_field];\r\n                  const selectedField =\r\n                    typeof str === \"string\"\r\n                      ? JSON.parse(\r\n                          selectedRow[prompt_field]\r\n                            .replace(/'/g, '\"')\r\n                            .replace(/\\n/g, \"\")\r\n                            .replace(/\\s/g, \"\")\r\n                            .replace(/False/g, \"false\")\r\n                            .replace(/True/g, \"true\")\r\n                        )\r\n                      : str;\r\n  \r\n                  setModalshow(true);\r\n                  setModalData({\r\n                    prompt_message,\r\n                    button_api: button_api,\r\n                    username: username,\r\n                    prod: prod,\r\n                    selectedRow: selectedRow,\r\n                    kwargs: kwargs,\r\n                    prompt_field,\r\n                    prompt_order_rules,\r\n                    selectedField,\r\n                    add_symbol_row_info,\r\n                    display_grid_column,\r\n                    editableCols,\r\n                  });\r\n  \r\n                  const rules_value: any = {};\r\n                  prompt_order_rules.forEach((rule: string) => {\r\n                    rules_value[rule] = selectedField[rule];\r\n                  });\r\n  \r\n                  setPromptText(rules_value);\r\n                } else if (prompt_field && prompt_message) {\r\n                  setModalshow(true);\r\n                  setModalData({\r\n                    prompt_message,\r\n                    button_api: button_api,\r\n                    username: username,\r\n                    prod: prod,\r\n                    selectedRow: selectedRow,\r\n                    kwargs: kwargs,\r\n                  });\r\n                  setPromptText(selectedRow[prompt_field]);\r\n                } else {\r\n                  if (window.confirm(prompt_message)) {\r\n                    await axios.post(button_api, {\r\n                      username: username,\r\n                      prod: prod,\r\n                      selected_row: selectedRow,\r\n                      ...kwargs,\r\n                    });\r\n                  }\r\n                  toastr.success(\"Success!\");\r\n                }\r\n              } catch (error) {\r\n                alert(`${error}`);\r\n              }\r\n            },\r\n          },\r\n        });\r\n      });\r\n    }\r\n  \r\n    // Reorder columns based on a predefined list\r\n    // const columnOrder = [\"sector\", \"broker_qty_available\", \"queens_suggested_sell\"]; // Replace with your desired column order\r\n    \r\n    if (columnOrder.length > 0 && grid_options.columnDefs) {\r\n      grid_options.columnDefs.sort((a: any, b: any) => {\r\n      // If both columns are in the columnOrder array, maintain their order\r\n      if (columnOrder.indexOf(a.field) !== -1 && columnOrder.indexOf(b.field) !== -1) {\r\n        return columnOrder.indexOf(a.field) - columnOrder.indexOf(b.field);\r\n      }\r\n    \r\n      // If one of the columns isn't in columnOrder, keep its original position\r\n      if (columnOrder.indexOf(a.field) === -1) return 1;\r\n      if (columnOrder.indexOf(b.field) === -1) return -1;\r\n    \r\n      return 0;\r\n      });\r\n    }\r\n    \r\n  \r\n    // Optional: Refresh header if necessary (if needed)\r\n    if (gridRef.current?.api) {\r\n      gridRef.current.api.refreshHeader();\r\n    }\r\n  }, [buttons, grid_options.columnDefs]);\r\n\r\n  const fetchAndSetData = async () => {\r\n    const array = await fetchData();\r\n    if (array === false) return false;\r\n    setRowData(array);\r\n    g_rowdata = array;\r\n    return true;\r\n  };\r\n\r\n  useEffect(() => {\r\n    onRefresh()\r\n  }, [viewId])\r\n\r\n\r\n  const fetchData = async () => {\r\n    try {\r\n      let toggle_view = toggle_views ? toggle_views[viewId] : \"none\";\r\n      const hasViewChanged = await checkViewIdChanged(viewId, previousViewId);\r\n      // console.log(\"hasViewChanged\", hasViewChanged, viewId, previousViewId);\r\n\r\n      // If view has changed, skip checkLastModified\r\n      if (!hasViewChanged && refresh_sec && refresh_sec > 0) {\r\n        const isLastModified = await checkLastModified();\r\n        if (!isLastModified) {\r\n          return false;\r\n        }\r\n      }\r\n\r\n      console.log(\"fetching data...\", api);\r\n      const res = await axios.post(api, {\r\n        username: username,\r\n        prod: prod,\r\n        ...kwargs,\r\n        toggle_view_selection: toggle_view\r\n      });\r\n      const array = JSON.parse(res.data);\r\n\r\n\r\n      return array;\r\n    }\r\n    catch (error: any) {\r\n      toastr.error(`Fetch Error: ${error.message}`);\r\n      return false;\r\n    }\r\n  };\r\n\r\n /// for title outside grid\r\n// const [subtotals, setSubtotals] = useState<any>(null);\r\n\r\n// const calculateSubtotals = useCallback(() => {\r\n//   if (!gridRef.current) return;\r\n//   if (!subtotal_cols || subtotal_cols.length === 0) {\r\n//     setSubtotals(null);\r\n//     return;\r\n//   }\r\n//   const api = gridRef.current.api;\r\n//   let filteredRows: any[] = [];\r\n//   api.forEachNodeAfterFilterAndSort((node) => {\r\n//     if (node.data) filteredRows.push(node.data);\r\n//   });\r\n\r\n//   if (filteredRows.length === 0) {\r\n//     setSubtotals(null);\r\n//     return;\r\n//   }\r\n\r\n//   let subtotal: any = {};\r\n//   subtotal[total_col] = \"Subtotal\";\r\n//   subtotal_cols.forEach((col: string) => {\r\n//     subtotal[col] = filteredRows.reduce((sum, row) => sum + (Number(row[col]) || 0), 0);\r\n//   });\r\n\r\n//   setSubtotals(subtotal);\r\n// }, [subtotal_cols, total_col]);\r\n// const onFilterChanged = useCallback(() => {\r\n//   calculateSubtotals();\r\n// }, [calculateSubtotals]);\r\n\r\n// const [subtotalsRow, setSubtotalsRow] = useState<any[]>([]);\r\n\r\nconst calculateSubtotals = useCallback(() => {\r\n  if (!gridRef.current) return;\r\n  if (!subtotal_cols || subtotal_cols.length === 0) {\r\n    setSubtotalsRow([]);\r\n    return;\r\n  }\r\n  const api = gridRef.current.api;\r\n  let filteredRows: any[] = [];\r\n  api.forEachNodeAfterFilterAndSort((node) => {\r\n    if (node.data) filteredRows.push(node.data);\r\n  });\r\n\r\n  if (filteredRows.length === 0) {\r\n    setSubtotalsRow([]);\r\n    return;\r\n  }\r\n\r\nlet subtotal: any = {};\r\n// Ensure total_col is a valid string and exists in the columns\r\nlet allCols: string[] = [];\r\nif (grid_options && grid_options.columnDefs) {\r\n  allCols = grid_options.columnDefs.map((colDef: any) => colDef.field).filter(Boolean);\r\n} else if (filteredRows.length > 0) {\r\n  allCols = Object.keys(filteredRows[0]);\r\n}\r\n\r\n// Place \"subTotals\" label in the correct column\r\nif (typeof total_col === \"string\" && allCols.includes(total_col)) {\r\n  subtotal[total_col] = \"subTotals\";\r\n} else if (allCols.length > 0) {\r\n  subtotal[allCols[0]] = \"subTotals\"; // fallback to first column\r\n}\r\n\r\n\r\n\r\n// Add button columns if not already present\r\nif (Array.isArray(buttons)) {\r\n  buttons.forEach((btn: any) => {\r\n    if (btn.col_header && btn.cellStyle) {\r\n      subtotal[`${btn.col_header}_cellStyle`] = btn.cellStyle;\r\n    }\r\n  });\r\n}\r\n\r\nallCols.forEach((col: string) => {\r\n  if (subtotal_cols.includes(col)) {\r\n    // Try to split by $ and sum the numeric part if possible\r\n    const sum = filteredRows.reduce((sum, row) => {\r\n      let val = row[col];\r\n      if (typeof val === \"string\" && val.includes(\"$\")) {\r\n        // Try to extract number after $\r\n        const match = val.match(/\\$([\\d,.\\-]+)/);\r\n        if (match && match[1]) {\r\n          val = match[1].replace(/,/g, \"\");\r\n        }\r\n      }\r\n      const num = Number(val);\r\n      return sum + (isNaN(num) ? 0 : num);\r\n    }, 0);\r\n    subtotal[col] = isNaN(sum) ? \"\" : sum;\r\n  } else if (subtotal[total_col] !== \"subTotals\" || col !== total_col) {\r\n    subtotal[col] = \"\"; // or null, or a placeholder\r\n  }\r\n});\r\n\r\n  setSubtotalsRow([subtotal]);\r\n}, [subtotal_cols, total_col]);\r\nconst onFilterChanged = useCallback(() => {\r\n  calculateSubtotals();\r\n}, [calculateSubtotals]);\r\n\r\n  useEffect(() => {\r\n    if (refresh_sec && refresh_sec > 0) {\r\n      const interval = setInterval(fetchAndSetData, refresh_sec * 1000)\r\n      let timeout: NodeJS.Timeout\r\n      if (refresh_cutoff_sec > 0) {\r\n        console.log(refresh_cutoff_sec)\r\n        timeout = setTimeout(() => {\r\n          clearInterval(interval)\r\n          console.log(\"Fetching data ended, refresh rate:\", refresh_sec)\r\n        }, refresh_cutoff_sec * 1000)\r\n      }\r\n      console.error(\"rendered==========\", props)\r\n      return () => {\r\n        clearInterval(interval)\r\n        if (timeout) clearTimeout(timeout)\r\n      }\r\n    }\r\n  }, [props, viewId])\r\n\r\n\r\n\r\n\r\n  const autoSizeAll = useCallback((skipHeader: boolean) => {\r\n    const allColumnIds: string[] = [];\r\n    const columnApi = gridRef.current!.columnApi;\r\n    const gridColumnDefs = grid_options?.columnDefs || [];\r\n    columnApi.getColumns()!.forEach((column: any) => {\r\n      const colDef = gridColumnDefs.find((def: any) => def.field === column.getColDef().field);\r\n      if (!colDef || colDef.initialWidth === undefined) {\r\n        allColumnIds.push(column.getId());\r\n      }\r\n    });\r\n    columnApi.autoSizeColumns(allColumnIds, skipHeader);\r\n  }, []);\r\n\r\n  const sizeToFit = useCallback(() => {\r\n    gridRef.current!.api.sizeColumnsToFit({\r\n      defaultMinWidth: 100,\r\n    })\r\n  }, [])\r\n\r\n  const onGridReady = useCallback(async (params: GridReadyEvent) => {\r\n    setTimeout(async () => {\r\n      try {\r\n        console.log(\"ws api is\", api_ws, kwargs.api_ws);\r\n        const array = await fetchData();\r\n        if (array === false) return;\r\n        \r\n        setRowData(array);\r\n        g_rowdata = array;\r\n\r\n        if (subtotal_cols && subtotal_cols.length > 0) {\r\n          calculateSubtotals();\r\n        } else {\r\n          setSubtotalsRow([]);\r\n        }\r\n        // Autosize all columns after data is set\r\n        autoSizeAll(true);\r\n\r\n      // Store initial column state\r\n      if (params.columnApi) {\r\n        setInitialColumnState(params.columnApi.getColumnState());\r\n      }\r\n\r\n      } catch (error: any) {\r\n        toastr.error(`Error: ${error.message}`)\r\n      }\r\n    }, 100)\r\n  }, [])\r\n\r\n  const autoGroupColumnDef = useMemo<ColDef>(() => {\r\n    return {\r\n      minWidth: 200,\r\n    }\r\n  }, [])\r\n\r\n  const getRowId = useMemo<GetRowIdFunc>(() => {\r\n    return (params: GetRowIdParams) => {\r\n      return params.data[index]\r\n    }\r\n  }, [index])\r\n\r\n  const sideBar = useMemo<\r\n    SideBarDef | string | string[] | boolean | null\r\n  >(() => {\r\n    return {\r\n      toolPanels: [\r\n        {\r\n          id: \"columns\",\r\n          labelDefault: \"Columns\",\r\n          labelKey: \"columns\",\r\n          iconKey: \"columns\",\r\n          toolPanel: \"agColumnsToolPanel\",\r\n        },\r\n        {\r\n          id: \"filters\",\r\n          labelDefault: \"Filters\",\r\n          labelKey: \"filters\",\r\n          iconKey: \"filter\",\r\n          toolPanel: \"agFiltersToolPanel\",\r\n        },\r\n      ],\r\n      defaultToolPanel: \"customStats\",\r\n    }\r\n  }, [])\r\n\r\n  const onCellValueChanged = useCallback((event) => {\r\n    if (g_newRowData === null) g_newRowData = {}\r\n    g_newRowData[event.data[index]] = event.data\r\n    console.log(\"Data after change is\", g_newRowData)\r\n  }, [])\r\n\r\n\r\n  const [loading, setLoading] = useState(false);\r\n  const subtotalTimeout = useRef<NodeJS.Timeout | null>(null);\r\n\r\n  const onRefresh = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const success = await fetchAndSetData();\r\n      \r\n      refresh_success && success && toastr.success(\"Refresh success!\");\r\n    } catch (error: any) {\r\n      toastr.error(`Refresh Failed! ${error.message}`);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const onUpdate = async () => {\r\n    if (g_newRowData === null) {\r\n      toastr.warning(`No changes to update`)\r\n      return\r\n    }\r\n    try {\r\n      const res: any = await axios.post(api_update, {\r\n        username: username,\r\n        prod: prod,\r\n        new_data: g_newRowData,\r\n        ...kwargs,\r\n      })\r\n      g_newRowData = null\r\n      if (res.status) toastr.success(`Successfully Updated! `)\r\n      else toastr.error(`Failed! ${res.message}`)\r\n    } catch (error) {\r\n      toastr.error(`Failed! ${error}`)\r\n    }\r\n  }\r\n\r\n  const columnTypes = useMemo<any>(() => {\r\n    return {\r\n      dateColumnFilter: {\r\n        filter: \"agDateColumnFilter\",\r\n        filterParams: {\r\n          comparator: (filterValue: any, cellValue: string) =>\r\n            compareAsc(new Date(cellValue), filterValue),\r\n        },\r\n      },\r\n      numberColumnFilter: {\r\n        filter: \"agNumberColumnFilter\",\r\n      },\r\n      shortDateTimeFormat: {\r\n        valueFormatter: (params: any) =>\r\n          dateFormatter(params.value, \"dd/MM/yyyy HH:mm\"),\r\n      },\r\n      customDateTimeFormat: {\r\n        valueFormatter: (params: any) =>\r\n          dateFormatter(\r\n            params.value,\r\n            params.column.colDef.custom_format_string\r\n          ),\r\n      },\r\n      customNumericFormat: {\r\n        valueFormatter: (params: any) =>\r\n          numberFormatter(params.value, params.column.colDef.precision ?? 2),\r\n      },\r\n      customCurrencyFormat: {\r\n        valueFormatter: (params: any) =>\r\n          currencyFormatter(\r\n            params.value,\r\n            params.column.colDef.custom_currency_symbol\r\n          ),\r\n      },\r\n      timedeltaFormat: {\r\n        valueFormatter: (params: any) => duration(params.value).humanize(true),\r\n      },\r\n      customNumberFormat: {\r\n        valueFormatter: (params: any) =>\r\n          Number(params.value).toLocaleString(\"en-US\", {\r\n            minimumFractionDigits: 0,\r\n          }),\r\n      },\r\n      customHyperlinkRenderer: {\r\n        // valueGetter: (params: any) =>\r\n        //   params.column.colDef.baseURL + params.data.honey,\r\n        cellRenderer: HyperlinkRenderer,\r\n        cellRendererParams: {\r\n          baseURL: \"URLSearchParams.co\",\r\n        },\r\n      },\r\n    }\r\n  }, [])\r\n\r\n  const onClick = () => {\r\n    toastr.clear()\r\n    setTimeout(() => toastr.success(`Settings updated `), 300)\r\n  }\r\n\r\n  type RowStyle = {\r\n    background?: string;\r\n    color?: string;\r\n    fontWeight?: string;\r\n  };\r\n\r\n  function parseJsCodeFromPython(v: string) {\r\n    const JS_PLACEHOLDER = \"::JSCODE::\"\r\n    let funcReg = new RegExp(\r\n      `${JS_PLACEHOLDER}\\\\s*((function|class)\\\\s*.*)\\\\s*${JS_PLACEHOLDER}`\r\n    )\r\n  \r\n    let match = funcReg.exec(v)\r\n  \r\n    if (match) {\r\n  \r\n      const funcStr = match[1]\r\n      // eslint-disable-next-line\r\n      return new Function(\"return \" + funcStr)()\r\n    } else {\r\n      return v\r\n    }\r\n  }\r\n\r\n  const getRowStyle = (params: RowClassParams<any>): RowStyle | undefined => {\r\n        if (params.data && params.data[total_col] === \"subTotals\") {\r\n      return { fontWeight: \"bold\", background: \"#f8f8f8\" }; // Add background if you want\r\n    }\r\n    try {\r\n      const background = params.data[\"color_row\"] ?? undefined;\r\n      const color = params.data[\"color_row_text\"] ?? undefined;\r\n      return { background, color };\r\n    } catch (error) {\r\n      console.error(\"Error accessing row style:\", error);\r\n      return undefined; // Return undefined when an error occurs\r\n    }\r\n  };\r\n\r\n\r\n  const getButtonStyle = (length: number) => {\r\n    if (length < 3) {\r\n      return { padding: \"15px 18px\", fontSize: \"18px\" };\r\n    } else if (length < 8) {\r\n      return { padding: \"15px 18px\", fontSize: \"15px\" };\r\n    } else if (length < 15) {\r\n      return { padding: \"12px 13px\", fontSize: \"13px\" };\r\n    } else if (length < 35) {\r\n      return { padding: \"10px 12px\", fontSize: \"11px\" };\r\n    } else {\r\n      return { padding: \"3px 5px\", fontSize: \"10px\" };\r\n    }\r\n  };\r\n\r\n  const buttonStyle = getButtonStyle(toggle_views.length);\r\n\r\n  const button_color = \"#3498db\"; // Set your custom button color here\r\n\r\n  // let pinnedTopRowData: any[] = [];\r\n  // let filteredRowData = rowData;\r\n  \r\n  // console.log(\"total_col\", total_col)\r\n  // if (total_col) {\r\n  //   // Use total_col as the column to check for \"Total\" row\r\n  //   const totalRow = rowData.find(row => row[total_col] === \"Total\");\r\n  //   pinnedTopRowData = totalRow ? [totalRow] : [];\r\n  //   filteredRowData = rowData.filter(row => row[total_col] !== \"Total\");\r\n  // }\r\n\r\n\r\n  const getUniqueColumnValues = (column: string, rowData: any[]) => {\r\n    return Array.from(new Set(rowData.map(row => row[column]))).filter(\r\n      v => v !== undefined && v !== null\r\n    );\r\n  };\r\n// let filter_button = \"piece_name\";\r\n\r\nconst uniqueValues = useMemo(\r\n  () => getUniqueColumnValues(filter_button, rowData),\r\n  [rowData, filter_button]\r\n);\r\n\r\nconst handleButtonFilter = (value: string | null) => {\r\n  setActiveFilter(value);\r\n\r\n  if (gridRef.current && gridRef.current.api) {\r\n    const api = gridRef.current.api;\r\n    if (value) {\r\n      api.setFilterModel({\r\n        ...api.getFilterModel(),\r\n        [filter_button]: { filterType: \"set\", values: [value] }\r\n      });\r\n    } else {\r\n      const model = api.getFilterModel();\r\n      delete model[filter_button];\r\n      api.setFilterModel(model);\r\n    }\r\n  }\r\n};\r\n\r\n\r\n\r\n\r\n\r\n\r\n  return (\r\n    <>\r\n\r\n{kwargs.show_cell_content && selectedCellContent && (\r\n  <div\r\n    style={{\r\n      position: \"absolute\",\r\n      top: \"10px\",\r\n      right: \"10px\",\r\n      background: \"white\",\r\n      border: \"1px solid #ddd\",\r\n      borderRadius: \"8px\",\r\n      padding: \"10px\",\r\n      boxShadow: \"0 2px 6px rgba(0, 0, 0, 0.1)\",\r\n      zIndex: 1000,\r\n      maxWidth: \"300px\", // Limit the width\r\n      maxHeight: \"200px\", // Limit the height\r\n      overflow: \"auto\", // Add scrollbars for overflow\r\n      width: \"fit-content\",\r\n    }}\r\n  >\r\n    <p style={{ whiteSpace: \"pre-wrap\", wordBreak: \"break-word\" }}>\r\n      {selectedCellContent}\r\n    </p>\r\n    <button\r\n      onClick={() => setSelectedCellContent(null)}\r\n      style={{\r\n        background: \"#3498db\",\r\n        color: \"white\",\r\n        border: \"none\",\r\n        borderRadius: \"2px\",\r\n        padding: \"3px 5px\",\r\n        cursor: \"pointer\",\r\n      }}\r\n    >\r\n      <h5 style={{ fontSize: \"8px\", margin: \"0 0 6px 0\" }}>x</h5>\r\n    </button>\r\n  </div>\r\n)}\r\n\r\n{toggle_views && toggle_views.length > 0 && (\r\n  <>\r\n    <div\r\n      style={{\r\n        fontWeight: \"bold\",\r\n        color: \"#055A6E\",\r\n        marginBottom: \"4px\",\r\n        fontSize: \"15px\",\r\n      }}\r\n    >\r\n      {kwargs.toggle_header ? kwargs.toggle_header : \"\"}\r\n    </div>\r\n    {toggle_views.length < 20 ? (\r\n      // Render normal buttons if toggle_views is less than 20\r\n      <div\r\n        style={{\r\n          display: \"flex\",\r\n          flexWrap: \"wrap\",\r\n          gap: \"10px\",\r\n          padding: \"10px\",\r\n          marginBottom: \"10px\",\r\n        }}\r\n      >\r\n        {toggle_views.map((view: string, index: number) => (\r\n          <button\r\n            key={index}\r\n            className={`btn ${viewId === index ? \"btn-danger\" : \"btn-secondary\"}`}\r\n            style={{\r\n              ...buttonStyle,\r\n              borderRadius: \"8px\",\r\n              color: \"#055A6E\",\r\n              backgroundColor: \"#F3FAFD\",\r\n              fontWeight: \"bold\",\r\n            }}\r\n            onClick={() => {\r\n              setViewId(index);\r\n              setpreviousViewId(viewId);\r\n            }}\r\n            disabled={loading}\r\n          >\r\n            {view}\r\n            {loading && viewId === index ? (\r\n              <div\r\n                style={{\r\n                  width: \"14px\",\r\n                  height: \"14px\",\r\n                  border: \"2px solid black\",\r\n                  borderTop: \"2px solid transparent\",\r\n                  borderRadius: \"50%\",\r\n                  animation: \"spin 0.8s linear infinite\",\r\n                  marginLeft: \"8px\",\r\n                }}\r\n              />\r\n            ) : null}\r\n          </button>\r\n        ))}\r\n      </div>\r\n    ) : (\r\n      // Render overlap container if toggle_views is 20 or more\r\n      <div\r\n        className=\"toggle-view-container\"\r\n        style={{\r\n          display: \"grid\",\r\n          gridTemplateColumns: \"repeat(auto-fit, minmax(100px, 1fr))\",\r\n          gap: \"10px\",\r\n          overflowY: \"auto\",\r\n          maxHeight: \"200px\",\r\n          padding: \"10px\",\r\n          border: \"1px solid #ddd\",\r\n          borderRadius: \"8px\",\r\n          backgroundColor: \"#eef9f8\",\r\n          width: \"100%\",\r\n          marginBottom: \"10px\",\r\n        }}\r\n      >\r\n        {toggle_views.map((view: string, index: number) => (\r\n          <button\r\n            key={index}\r\n            className={`btn ${viewId === index ? \"btn-danger\" : \"btn-secondary\"}`}\r\n            style={{\r\n              ...buttonStyle,\r\n              borderRadius: \"8px\",\r\n              color: \"#055A6E\",\r\n              backgroundColor: \"#F3FAFD\",\r\n              fontWeight: \"bold\",\r\n            }}\r\n            onClick={() => {\r\n              setViewId(index);\r\n              setpreviousViewId(viewId);\r\n            }}\r\n            disabled={loading}\r\n          >\r\n            {view}\r\n            {loading && viewId === index ? (\r\n              <div\r\n                style={{\r\n                  width: \"14px\",\r\n                  height: \"14px\",\r\n                  border: \"2px solid black\",\r\n                  borderTop: \"2px solid transparent\",\r\n                  borderRadius: \"50%\",\r\n                  animation: \"spin 0.8s linear infinite\",\r\n                  marginLeft: \"8px\",\r\n                }}\r\n              />\r\n            ) : null}\r\n          </button>\r\n        ))}\r\n      </div>\r\n    )}\r\n  </>\r\n)}\r\n\r\n      <MyModal\r\n        isOpen={modalShow}\r\n        closeModal={() => setModalshow(false)}\r\n        modalData={modalData}\r\n        promptText={promptText}\r\n        setPromptText={setPromptText}\r\n        toastr={toastr}\r\n      />\r\n      <div\r\n        style={{ flexDirection: \"row\", height: \"100%\", width: \"100%\" }}\r\n        id=\"myGrid\"\r\n      >\r\n\r\n\r\n        <div className=\"d-flex justify-content-between align-items-center\">\r\n          {(refresh_sec == undefined || refresh_sec == 0) && (\r\n            <div style={{ display: \"flex\" }}>\r\n              <div style={{ margin: \"5px 5px 5px 2px\" }}>\r\n                <button\r\n                  className=\"btn\"\r\n                  style={{\r\n                    backgroundColor: button_color,\r\n                    color: \"white\",\r\n                    padding: \"2px 5px\", // Smaller padding\r\n                    // fontSize: \"12px\", // Smaller font size\r\n                    borderRadius: \"4px\",\r\n                    display: \"flex\",\r\n                    alignItems: \"center\",\r\n                    justifyContent: \"center\",\r\n                    minWidth: \"50px\", // Ensure width stays the same during loading\r\n                  }}\r\n                  onClick={onRefresh}\r\n                  title=\"Refresh\"\r\n                  disabled={loading} // Disable button while loading\r\n                >\r\n                  {loading ? (\r\n                    <div\r\n                      style={{\r\n                        width: \"12px\",\r\n                        height: \"12px\",\r\n                        border: \"2px solid white\",\r\n                        borderTop: \"2px solid transparent\",\r\n                        borderRadius: \"50%\",\r\n                        animation: \"spin 0.8s linear infinite\",\r\n                      }}\r\n                    />\r\n                  ) : (\r\n                    <span style={{ fontSize: \"25px\", lineHeight: \"1\" }}>⟳</span>\r\n                  )}\r\n                </button>\r\n\r\n                {/* Add CSS for spinner animation */}\r\n                <style>\r\n                  {`\r\n                    @keyframes spin {\r\n                      to {\r\n                        transform: rotate(360deg);\r\n                      }\r\n                    }\r\n                  `}\r\n                </style>\r\n              </div>\r\n                <div style={{ margin: \"5px 5px 5px 2px\" }}>\r\n                <button\r\n                  className=\"btn\"\r\n                  style={{\r\n                  backgroundColor: \"green\",\r\n                  color: \"white\",\r\n                  padding: \"5px 8px\",\r\n                  fontSize: \"12px\",\r\n                  borderRadius: \"4px\",\r\n                  display: \"flex\",\r\n                  alignItems: \"center\",\r\n                  gap: \"6px\",\r\n                  }}\r\n                  onClick={onUpdate}\r\n                  title=\"Update\"\r\n                >\r\n                  <span style={{ fontSize: \"18px\", lineHeight: \"1\" }}>↑</span>\r\n                  {/* <span>Update</span> */}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          )}\r\n          \r\n        </div>\r\n  \r\n        <div\r\n          className={grid_options.theme || \"ag-theme-alpine-dark\"}\r\n          style={{\r\n            width: \"100%\",\r\n            height: kwargs[\"grid_height\"] ? kwargs[\"grid_height\"] : \"100%\",\r\n          }}\r\n        >\r\n\r\n{kwargs.column_sets && (\r\n\r\n  <div style={{ marginBottom: 12, display: \"flex\", gap: \"8px\", alignItems: \"center\", flexWrap: \"wrap\" }}>\r\n\r\n<button\r\n  onClick={() => {\r\n    setSelectedColumnSetKeys([]);\r\n    setTimeout(() => {\r\n      const columnApi = gridRef.current?.columnApi;\r\n      if (columnApi && initialColumnState) {\r\n        columnApi.applyColumnState({\r\n          state: initialColumnState,\r\n          applyOrder: true,\r\n        });\r\n      }\r\n    }, 0);\r\n  }}\r\n    style={{\r\n      background: \"rgb(194, 194, 194)\",\r\n      color: \"white\",\r\n      border: \"1.5px solid rgb(213, 213, 213)\",\r\n      borderRadius: \"6px\",\r\n      fontWeight: \"bold\",\r\n      fontSize: \"12px\",\r\n      padding: \"5px 10px\",\r\n      margin: \"0 4px 4px 0\",\r\n      boxShadow: \"0 2px 6px rgb(216, 216, 216)\",\r\n      transition: \"all 0.15s\",\r\n      cursor: \"pointer\",\r\n    }}\r\n>\r\n  Reset Columns\r\n</button>\r\n\r\n    \r\n    {Object.keys(kwargs.column_sets).map(key => (\r\n      \r\n      \r\n      <button\r\n        key={key}\r\n        onClick={() => {\r\n          setSelectedColumnSetKeys(prev =>\r\n            prev.includes(key)\r\n              ? prev.filter(k => k !== key)\r\n              : [...prev, key]\r\n          );\r\n          setTimeout(() => {\r\n            const keys = selectedColumnSetKeys.includes(key)\r\n              ? selectedColumnSetKeys.filter(k => k !== key)\r\n              : [...selectedColumnSetKeys, key];\r\n            const columnsToShow = Array.from(\r\n              new Set(keys.flatMap(k => kwargs.column_sets[k]))\r\n            );\r\n            const columnApi = gridRef.current?.columnApi;\r\n            if (columnApi && Array.isArray(grid_options.columnDefs)) {\r\n              grid_options.columnDefs.forEach((col: any) => {\r\n                columnApi.setColumnVisible(\r\n                  col.field,\r\n                  columnsToShow.includes(col.field)\r\n                );\r\n              });\r\n              columnsToShow.forEach((field, idx) => {\r\n                columnApi.moveColumn(field, idx);\r\n              });\r\n            }\r\n          }, 0);\r\n        }}\r\n        style={{\r\n          background: selectedColumnSetKeys.includes(key) ? \"#3498db\" : \"#F3FAFD\",\r\n          color: selectedColumnSetKeys.includes(key) ? \"white\" : \"#055A6E\",\r\n          border: selectedColumnSetKeys.includes(key) ? \"2px solid #1abc9c\" : \"1px solid #ddd\",\r\n          borderRadius: \"6px\",\r\n          fontWeight: \"bold\",\r\n          fontSize: \"12px\",\r\n          padding: \"5px 10px\",\r\n          margin: \"0 4px 4px 0\",\r\n          boxShadow: selectedColumnSetKeys.includes(key) ? \"0 2px 6px rgba(52,152,219,0.10)\" : \"none\",\r\n          transition: \"all 0.15s\",\r\n          cursor: \"pointer\",\r\n        }}\r\n      >\r\n        {key}\r\n      </button>\r\n    ))}\r\n\r\n  </div>\r\n)}\r\n          {/* Streamer for streaming_list_text if present */}\r\n          {kwargs.streaming_list_text && Array.isArray(kwargs.streaming_list_text) && (\r\n            <div\r\n              style={{\r\n              width: \"100%\",\r\n              background: \"#F3FAFD\", // Match toggle_views button background\r\n              color: \"#055A6E\",      // Match toggle_views button text color\r\n              padding: \"4px 10px\",\r\n              fontSize: \"13px\",\r\n              borderBottom: \"1px solid #ddd\",\r\n              whiteSpace: \"nowrap\",\r\n              overflow: \"hidden\",\r\n              textOverflow: \"ellipsis\",\r\n              marginBottom: \"4px\",\r\n              fontWeight: \"bold\",    // Match bold style from buttons\r\n              }}\r\n            >\r\n              <div\r\n              style={{\r\n                display: \"block\",\r\n                width: \"100%\",\r\n                whiteSpace: \"nowrap\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n              }}\r\n              >\r\n              <div\r\n                style={{\r\n                display: \"inline-block\",\r\n                paddingLeft: \"100%\",\r\n                animation: \"scroll-left 40s linear infinite\",\r\n                }}\r\n              >\r\n                {kwargs.streaming_list_text.join(\"   |   \")}\r\n              </div>\r\n              <style>\r\n                {`\r\n                @keyframes scroll-left {\r\n                  0% {\r\n                  transform: translateX(0%);\r\n                  }\r\n                  100% {\r\n                  transform: translateX(-100%);\r\n                  }\r\n                }\r\n                `}\r\n              </style>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n{kwargs['filter_button'] && kwargs['filter_button'] !== '' && (\r\n  <div style={{ marginBottom: 8 }}>\r\n\r\n\r\n{kwargs['show_clear_all_filters'] && (\r\n  <button\r\n    onClick={() => {\r\n      if (gridRef.current && gridRef.current.api) {\r\n        gridRef.current.api.setFilterModel({});\r\n      }\r\n    }}\r\n    style={{\r\n      background: \"rgb(194, 194, 194)\",\r\n      color: \"white\",\r\n      border: \"1.5px solid rgb(213, 213, 213)\",\r\n      borderRadius: \"6px\",\r\n      fontWeight: \"bold\",\r\n      fontSize: \"12px\",\r\n      padding: \"5px 10px\",\r\n      margin: \"0 4px 4px 0\",\r\n      boxShadow: \"0 2px 6px rgb(216, 216, 216)\",\r\n      transition: \"all 0.15s\",\r\n      cursor: \"pointer\",\r\n    }}\r\n  >\r\n    Clear Filters\r\n  </button>\r\n)}\r\n\r\n    \r\n    {uniqueValues.map(val => (\r\n      <button\r\n        key={val}\r\n        onClick={() => handleButtonFilter(val)}\r\n        style={{\r\n          background: activeFilter === val ? \"#3498db\" : \"#F3FAFD\", // match main button color and toggle_views bg\r\n          color: activeFilter === val ? \"white\" : \"#055A6E\",        // match toggle_views text color\r\n          border: activeFilter === val ? \"2px solid #1abc9c\" : \"1px solid #ddd\",\r\n          borderRadius: \"6px\",\r\n          fontWeight: \"bold\",\r\n          fontSize: \"12px\",\r\n          padding: \"5px 10px\",\r\n          margin: \"0 4px 4px 0\",\r\n          boxShadow: activeFilter === val ? \"0 2px 6px rgba(52,152,219,0.10)\" : \"none\",\r\n          transition: \"all 0.15s\",\r\n          cursor: \"pointer\",\r\n        }}\r\n      >\r\n        {val}\r\n      </button>\r\n    ))}\r\n\r\n  </div>\r\n)}\r\n\r\n\r\n          <AgGridReact\r\n            ref={gridRef}\r\n            rowData={rowData}\r\n            pinnedBottomRowData={subtotalsRow}\r\n            onFilterChanged={onFilterChanged}\r\n            getRowStyle={getRowStyle}\r\n            // rowStyle={{ fontSize: kwargs.fontSize ? kwargs.fontSize : 12, padding: 0 }}\r\n            headerHeight={30}\r\n            rowHeight={30}\r\n            onGridReady={onGridReady}\r\n            autoGroupColumnDef={autoGroupColumnDef}\r\n            animateRows={true}\r\n            suppressAggFuncInHeader={true}\r\n            getRowId={getRowId}\r\n            gridOptions={getGridOptions()}\r\n            onCellValueChanged={onCellValueChanged}\r\n            columnTypes={columnTypes}\r\n            sideBar={grid_options.sideBar === false ? false : sideBar}\r\n            onCellClicked={onCellClicked} // Attach the handler here\r\n          />\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n\r\nexport default AgGrid\r\n","import React, { useEffect, useState } from 'react'\nimport {\n  ComponentProps,\n  Streamlit,\n  withStreamlitConnection,\n} from 'streamlit-component-lib'\nimport 'ag-grid-community/styles/ag-grid.css'\n// import 'ag-grid-community/styles/ag-theme-alpine.css';\nimport 'ag-grid-community/styles/ag-theme-balham.css'\nimport Aggrid from './Aggrid'\n\nconst Main = (props: ComponentProps) => {\n  const {\n    username,\n    api,\n    api_update,\n    refresh_sec,\n    refresh_cutoff_sec,\n    gridoption_build,\n    enable_JsCode,\n    prod,\n  } = props.args\n  const { grid_options, kwargs = {} } = props.args\n  const { index, theme } = grid_options\n  // console.log('GridOptions', grid_options)\n  return (\n    <div>\n      <Aggrid\n        username={username}\n        api={api}\n        api_update={api_update}\n        refresh_sec={refresh_sec}\n        refresh_cutoff_sec={refresh_cutoff_sec}\n        gridoption_build={gridoption_build}\n        prod={prod}\n        grid_options={grid_options}\n        index={index}\n        kwargs={kwargs} \n        enable_JsCode={enable_JsCode}      />\n    </div>\n  )\n}\n\nexport default withStreamlitConnection(Main)\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport Main from \"./Main\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <Main />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);"],"sourceRoot":""}