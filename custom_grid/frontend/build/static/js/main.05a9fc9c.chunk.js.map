{"version":3,"sources":["components/Modal.tsx","utils.js","Aggrid.tsx","Main.tsx","index.tsx"],"names":["formats","sliderRules","sliderRules_stars","sliderRules_stars_margin","map","rule","ReactModal","setAppElement","isExecuting","MyModal","_ref","isOpen","closeModal","modalData","promptText","setPromptText","toastr","loading","setLoading","React","useState","prompt_field","prompt_order_rules","selectedRow","selectedField","add_symbol_row_info","display_grid_column","showStarsSliders","setShowStarsSliders","showStarsMarginSliders","setShowStarsMarginSliders","showActiveOrders","setShowActiveOrders","showWaveData","setShowWaveData","showButtonColData","setShowButtonColData","sellQtys","setSellQtys","editableValues","setEditableValues","editableCols","ordersToRender","Array","isArray","dataCols","length","Object","keys","editableColHeaders","col","col_header","allCols","from","Set","ref","useRef","useEffect","setTimeout","_ref$current","current","focus","_gridRef$current","_orders$","console","log","gridRef","index","selectedRowFromModal","selectedRowId","_gridRef$current2","api","warn","hasGridRef","hasIndex","hasSelectedRow","freshNode","getRowNode","data","orders","hasOrders","hasEditableCols","displayColumn","rowId","orderCount","firstOrderTakeProfit","take_profit","allOrders","reset","forEach","_ref3","order","idx","_order$col_header","isValidDate","dateStr","some","format","moment","isValid","formatToLocalDatetime","date","toDate","timeZone","Intl","DateTimeFormat","resolvedOptions","zonedDate","utcToZonedTime","textFields","booleanFields","datetimeFields","arrayFields","filter","field","value","push","createElement","onRequestClose","ariaHideApp","className","style","position","prompt_message","onClick","right","border","borderRadius","padding","background","key","marginRight","minWidth","textAlign","fontSize","type","checked","onChange","e","target","width","height","marginTop","flex","marginBottom","undefined","paddingRight","Number","toLocaleString","maximumFractionDigits","String","gap","includes","isSliderRule","fontWeight","textTransform","replace","marginLeft","cursor","title","Fragment","min","max","step","item","i","prev","margin","textDecoration","color","getPinnedColumnLeftPosition","colIndex","leftOffset","editableCol","find","ec","pinned","dtype","getCellBackgroundColor","backgroundColor","conditionalColor","_editableValues$col$i","_editableValues$col","cond","cellValue","compareValue","compare_to","operator","trueColor","falseColor","toLowerCase","startsWith","maxHeight","overflowY","overflowX","colWidth","whiteSpace","wordWrap","top","left","zIndex","display","alignItems","justifyContent","display_name","info","_editableValues$col2","qty_available","placeholder","num","updatedOrders","ord","_editableValues$col3","sell_qty","active_orders_with_qty","_editableValues$col4","options","values","disabled","option","_editableValues$col5","_editableValues$col6","_editableValues$col7","_editableValues$col8","sum","reduce","acc","val","isNaN","hasNumeric","bottom","boxShadow","async","error","ordersWithEdits","edits","_ref2","_editableValues$col$c","_editableValues$col$c2","body","username","prod","selected_row","default_value","editable_orders","kwargs","res","axios","post","button_api","status","description","message_type","success","alert","close_modal","message","role","aria-hidden","mapObject","obj","fn","keysToIgnore","deepMap","arguments","deepMapper","g_rowdata","g_newRowData","dateFormatter","isoString","formaterString","Date","currencyFormatter","number","currencySymbol","n","parseFloat","toFixed","numberFormatter","precision","HyperlinkRenderer","props","linkField","column","colDef","baseURL","linkValue","href","rel","positionClass","hideDuration","timeOut","AgGrid","BtnCellRenderer","node","rowPinned","subtotalStyle","cellStyle","btnClickedHandler","clicked","id","buttonName","buildDetailGridOptions","detailGridOptions","level","masterDetail","getDetailRowData","params","nestedRows","successCallback","detailCellRendererParams","api_update","api_ws","refresh_sec","refresh_cutoff_sec","enable_JsCode","grid_options","parseJsCodeFromPython","buttons","toggle_views","api_key","api_lastmod_key","columnOrder","refresh_success","filter_button","rowData","setRowData","modalShow","setModalshow","setModalData","viewId","setViewId","lastModified","setLastModified","previousViewId","setpreviousViewId","activeFilter","setActiveFilter","selectedColumnSetKeys","setSelectedColumnSetKeys","initialColumnState","setInitialColumnState","selectedCellContent","setSelectedCellContent","reconnectTimeout","heartbeatInterval","ws","isIntentionallyClosed","reconnectAttempts","connectWebSocket","WebSocket","onopen","_ws","handshake","toggle_view_selection","send","JSON","stringify","startHeartbeat","onmessage","event","parse","rowsToUpdate","_gridRef$current3","row_id","updates","existingNode","updatedRow","applyTransaction","update","calculateAndUpdateSubtotals","onerror","stopHeartbeat","onclose","code","reason","wasClean","setInterval","readyState","OPEN","clearInterval","clearTimeout","close","_gridRef$current5","Streamlit","setFrameHeight","button","col_headername","col_width","button_name","border_color","otherKeys","filterParams","columnDefs","headerName","cellRenderer","cellRendererParams","borderColor","row_index","_gridRef$current4","str","rules_value","window","confirm","sort","a","b","indexOf","refreshHeader","fetchAndSetData","array","fetchData","onRefresh","toggle_view","currentViewId","checkViewIdChanged","_res$data","baseurl","split","slice","join","get","client_user","checkLastModified","interval","timeout","autoSizeAll","useCallback","skipHeader","_grid_options","allColumnIds","columnApi","gridColumnDefs","getColumns","def","getColDef","initialWidth","getId","autoSizeColumns","sizeColumnsToFit","defaultMinWidth","subtotal_cols","filteredRows","forEachNodeAfterFilterAndSort","subtotal","row","buttonMatch","match","isFinite","columnDef","getColumnDef","hasFormatter","valueFormatter","hasPinnedTop","pinnedTopRowData","pinnedBottomRowData","setPinnedTopRowData","setPinnedBottomRowData","onGridReady","getColumnState","autoGroupColumnDef","useMemo","getRowId","sideBar","toolPanels","labelDefault","labelKey","iconKey","toolPanel","defaultToolPanel","onCellValueChanged","autoUpdate","updated_row","columnTypes","dateColumnFilter","comparator","filterValue","compareAsc","numberColumnFilter","shortDateTimeFormat","customDateTimeFormat","custom_format_string","customNumericFormat","_params$column$colDef2","customCurrencyFormat","custom_currency_symbol","timedeltaFormat","duration","humanize","customNumberFormat","minimumFractionDigits","customHyperlinkRenderer","v","RegExp","exec","funcStr","Function","buttonStyle","uniqueValues","getUniqueColumnValues","show_cell_content","maxWidth","overflow","wordBreak","toggle_header","flexWrap","view","borderTop","animation","gridTemplateColumns","flexDirection","lineHeight","new_data","warning","theme","column_sets","_gridRef$current6","applyColumnState","state","applyOrder","transition","k","_gridRef$current7","columnsToShow","flatMap","setColumnVisible","moveColumn","streaming_list_text","borderBottom","textOverflow","paddingLeft","setFilterModel","getFilterModel","filterType","model","handleButtonFilter","AgGridReact","getRowStyle","_params$data$color_ro","_params$data$color_ro2","headerHeight","rowHeight","animateRows","suppressAggFuncInHeader","gridOptions","getGridOptions","nestedGridEnabled","onCellClicked","withStreamlitConnection","gridoption_build","args","Aggrid","ReactDOM","render","StrictMode","Main","document","getElementById"],"mappings":"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","file":"static/js/main.05a9fc9c.chunk.js","sourcesContent":["import React, { useEffect, useRef } from \"react\";\nimport ReactModal from \"react-modal\";\nimport \"./modal.css\";\nimport axios from \"axios\";\nimport { utcToZonedTime, format } from 'date-fns-tz';\nimport moment from \"moment\";\n\nconst formats = [\"YYYY-MM-DDTHH:mm\", \"MM/DD/YYYYTHH:mm\", \"MM/DD/YYYY HH:mm\", \"YYYY-MM-DD HH:mm\"];\nconst sliderRules = [\"buying_power\", \"borrow_power\"]\nconst sliderRules_stars = [\"Day\", \"Week\", \"Month\", \"Quarter\", \"Quarters\", \"Year\"];\nconst sliderRules_stars_margin = sliderRules_stars.map(rule => `${rule} Margin`);\n\n\n\n// const modalStyle = {\n//   content: {\n//     top: \"50%\",\n//     left: \"50%\",\n//     right: \"auto\",\n//     bottom: \"auto\",\n//     marginRight: \"-50%\",\n//     transform: \"translate(-50%, -50%)\",\n//     backgroundColor: \"yellow\",\n//     width: \"95vw\",           // Responsive width\n//     maxWidth: \"400px\",       // Limit max width for desktop\n//     minWidth: \"280px\",       // Minimum for mobile\n//     padding: \"16px\",\n//   },\n// };\n\nReactModal.setAppElement(\"#root\");\nlet isExecuting = false;\n\ninterface MyModalProps {\n  isOpen: boolean;\n  closeModal: () => void;\n  modalData: any;\n  promptText: any;\n  setPromptText: (value: any) => void;\n  toastr: any; // Define the toastr type if available\n}\n\nconst MyModal: React.FC<MyModalProps> = ({\n  isOpen,\n  closeModal,\n  modalData,\n  promptText,\n  setPromptText,\n  toastr,\n}) => {\n  const [loading, setLoading] = React.useState(false); // Add loading state\n  const { prompt_field, prompt_order_rules, selectedRow, selectedField, add_symbol_row_info, display_grid_column } = modalData;\n  // console.log(\"modalData :>> \", display_grid_column, prompt_field); // workerbee handle in agagrid display_grid_column add var from mount\n  const [showStarsSliders, setShowStarsSliders] = React.useState(false);\n  const [showStarsMarginSliders, setShowStarsMarginSliders] = React.useState(false);\n  const [showActiveOrders, setShowActiveOrders] = React.useState(false);\n  const [showWaveData, setShowWaveData] = React.useState(true);\n  const [showButtonColData, setShowButtonColData] = React.useState(true);\n  const [sellQtys, setSellQtys] = React.useState<{ [key: number]: string }>({});\n  const handleSellQtyChange = (idx: number, value: string) => {\n    setSellQtys((prev) => ({ ...prev, [idx]: value }));\n  };\n\n\n  const [editableValues, setEditableValues] = React.useState<{ [col: string]: { [idx: number]: any } }>({});\n  const editableCols = modalData.editableCols || [];\n  const ordersToRender = (selectedRow && display_grid_column && Array.isArray(selectedRow[display_grid_column]))\n    ? selectedRow[display_grid_column]\n    : [];\n  const dataCols = ordersToRender.length > 0 ? Object.keys(ordersToRender[0]) : [];\n  const editableColHeaders = editableCols.map((col: { col_header: string }) => col.col_header);\n  const allCols = Array.from(new Set([...editableColHeaders, ...dataCols]));\n\n  const ref = useRef<HTMLButtonElement>(null);\n  const selectRef = useRef<HTMLSelectElement>(null);\n\n\n\n  const handleOkSecond = async () => {\n    if (isExecuting) return;\n    if (loading) return; // Prevent multiple clicks\n    setLoading(true); // Show spinner\n    isExecuting = true;\n    try {\n      // Merge editable values into each order\n      const ordersToRender = display_grid_column && selectedRow && Array.isArray(selectedRow[display_grid_column])\n        ? selectedRow[display_grid_column]\n        : [];\n\n      if (!ordersToRender || !Array.isArray(ordersToRender)) {\n        toastr.error(\"No editable orders found for this action.\");\n        return;\n      }\n\n      const ordersWithEdits = ordersToRender.map((order: any, idx: number) => {\n        let edits: any = {};\n        editableCols.forEach((col: { col_header: string }) => {\n          edits[col.col_header] = editableValues[col.col_header]?.[idx] ?? order[col.col_header] ?? \"\"; // Use nullish coalescing\n        });\n        return { ...order, ...edits };\n      });\n\n\n      const body = {\n        username: modalData.username,\n        prod: modalData.prod,\n        selected_row: modalData.selectedRow,\n        default_value: promptText,\n        editable_orders: ordersWithEdits,\n        ...modalData.kwargs,\n      };\n      const { data: res } = await axios.post(modalData.button_api, body);\n      const { status, data, description } = res;\n      if (status === \"success\") {\n        if (data && data.message_type === \"fade\") {\n          toastr.success(description, \"Success\");\n        } else {\n          alert(\"Success!\\nDescription: \" + description);\n        }\n      } else {\n        if (data && data.message_type === \"fade\") {\n          toastr.error(description, \"Error\");\n        } else {\n          alert(\"Error!\\nDescription: \" + description);\n        }\n      }\n      if (data?.close_modal !== false) closeModal();\n    } catch (error: any) {\n      console.log(\"error :>> \", error);\n      toastr.error(error.message);\n    }\n    setLoading(false); // Hide spinner\n    isExecuting = false;\n  };\n\n\n  useEffect(() => {\n    if (isOpen) setTimeout(() => ref.current?.focus(), 100);\n  }, [isOpen]);\n\n  useEffect(() => {\n    setSellQtys({}); // Reset sellQtys to an empty object\n  }, [isOpen, selectedRow]);\n\n\n  useEffect(() => {\n    if (!isOpen) {\n      setEditableValues({});\n      return;\n    }\n\n    console.log(\"üîÑ Modal opening - fetching fresh data from grid\");\n\n    // ‚úÖ Get fresh data directly from AG Grid\n    const gridRef = modalData.gridRef;\n    const index = modalData.index;\n    const selectedRowFromModal = modalData.selectedRow; // ‚úÖ Use modalData.selectedRow, not props\n    const selectedRowId = selectedRowFromModal?.[index];\n\n    if (!gridRef?.current?.api || !selectedRowId) {\n      console.warn(\"‚ö†Ô∏è  Missing gridRef or selectedRowId\", {\n        hasGridRef: !!gridRef?.current?.api,\n        hasIndex: !!index,\n        hasSelectedRow: !!selectedRowFromModal,\n        selectedRowId\n      });\n      return;\n    }\n\n    // ‚úÖ ALWAYS get the latest data from grid when modal opens\n    const freshNode = gridRef.current.api.getRowNode(selectedRowId);\n\n    if (!freshNode || !freshNode.data) {\n      console.warn(\"‚ö†Ô∏è  Row not found in grid:\", selectedRowId);\n      return;\n    }\n\n    const freshData = freshNode.data;\n    const orders = freshData[display_grid_column];\n\n    if (!Array.isArray(orders) || !editableCols) {\n      console.warn(\"‚ö†Ô∏è  Invalid orders data\", {\n        hasOrders: !!orders,\n        isArray: Array.isArray(orders),\n        hasEditableCols: !!editableCols,\n        displayColumn: display_grid_column\n      });\n      setEditableValues({});\n      return;\n    }\n\n    console.log(\"‚úÖ Building editableValues from FRESH grid data:\", {\n      rowId: selectedRowId,\n      orderCount: orders.length,\n      firstOrderTakeProfit: orders[0]?.take_profit,\n      allOrders: orders\n    });\n\n    // ‚úÖ Build editableValues from fresh data\n    const reset: any = {};\n    editableCols.forEach(({ col_header }: { col_header: string }) => {\n      reset[col_header] = {};\n      orders.forEach((order: any, idx: number) => {\n        reset[col_header][idx] = order[col_header] ?? \"\";\n      });\n    });\n\n    console.log(\"‚úÖ Setting editableValues:\", reset);\n    setEditableValues(reset);\n\n    // ‚úÖ Only depend on isOpen - refresh EVERY time modal opens\n  }, [isOpen]);\n\n  const isValidDate = (dateStr: string) => {\n    return formats.some(format => moment(dateStr, format, true).isValid());\n  };\n\n  const formatToLocalDatetime = (dateStr: string) => {\n    const date = moment(dateStr, formats, true).toDate();\n    const timeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;\n    const zonedDate = utcToZonedTime(date, timeZone);\n    return format(zonedDate, 'yyyy-MM-dd\\'T\\'HH:mm');\n  };\n\n  // Categorize fields by type\n  const textFields = [];\n  const booleanFields = [];\n  const datetimeFields = [];\n  const arrayFields = [];\n\n  const filtered_prompt_order_rules = Array.isArray(prompt_order_rules) && promptText\n    ? prompt_order_rules.filter((field) => field && (field in promptText))\n    : [];\n\n  if (prompt_order_rules) {\n    for (const rule of prompt_order_rules) {\n      const value = promptText[rule];\n      if (Array.isArray(value)) {\n        arrayFields.push(rule);\n      } else if (typeof value === \"boolean\") {\n        booleanFields.push(rule);\n      } else if (isValidDate(value)) {\n        datetimeFields.push(rule);\n      } else {\n        textFields.push(rule);\n      }\n    }\n  }\n\n\n\n  return (\n    <ReactModal\n      isOpen={isOpen}\n      onRequestClose={closeModal}\n      // style={modalStyle}\n      ariaHideApp={false}\n    >\n      <div className=\"my-modal-content\">\n        {/* Modal Header */}\n        <div className=\"modal-header px-3 d-flex justify-content-center align-items-center\" style={{ position: \"relative\" }}>\n          <h4 className=\"text-center m-0\">{modalData.prompt_message}</h4>\n          <span className=\"close\" onClick={closeModal} style={{ position: \"absolute\", right: \"20px\" }}>\n            &times;\n          </span>\n\n        </div>\n\n        {/* Modal Body */}\n        <div className=\"modal-body p-3\">\n          <div className=\"d-flex flex-column\">\n            {/* Boolean Fields Top Row */}\n            {booleanFields.length > 0 && (\n              <div\n                className=\"d-flex flex-row justify-content-between mb-2\"\n                style={{\n                  border: \"1px solid #e0e0e0\", // Light gray outline\n                  borderRadius: \"8px\",\n                  padding: \"8px\",\n                  background: \"#fafcff\"\n                }}\n              >\n                {booleanFields.map((rule: any, index: number) => (\n                  <div className=\"d-flex flex-column align-items-center\" key={index} style={{ marginRight: \"8px\" }}>\n                    <label className=\"mb-0\" style={{ minWidth: \"100px\", textAlign: \"center\", fontSize: \"0.9rem\" }}>\n                      {rule}:\n                    </label>\n                    <input\n                      type=\"checkbox\"\n                      checked={promptText[rule]}\n                      onChange={(e) =>\n                        setPromptText({\n                          ...promptText,\n                          [rule]: e.target.checked,\n                        })\n                      }\n                      style={{ width: \"16px\", height: \"16px\", marginTop: \"4px\" }}\n                    />\n                  </div>\n                ))}\n              </div>\n            )}\n\n            {/* Add Symbol Row Info Column */}\n            {add_symbol_row_info && Array.isArray(add_symbol_row_info) && (\n              <div\n                className=\"d-flex flex-wrap\"\n                style={{\n                  flex: 1,\n                  border: \"1px solid #e0e0e0\",\n                  borderRadius: \"8px\",\n                  padding: \"8px\",\n                  background: \"#fafcff\",\n                  marginBottom: \"8px\"\n                }}\n              >\n                {add_symbol_row_info.map((col: string, idx: number) =>\n                  selectedRow && selectedRow[col] !== undefined && (\n                    <div\n                      key={col}\n                      style={{\n                        flex: \"1 1 30%\",\n                        minWidth: \"120px\",\n                        marginBottom: \"8px\",\n                        paddingRight: \"12px\"\n                      }}\n                    >\n                      <b>{col}: </b>\n                      {typeof selectedRow[col] === \"number\"\n                        ? Number(selectedRow[col]).toLocaleString(undefined, { maximumFractionDigits: 2 })\n                        : String(selectedRow[col])}\n                    </div>\n                  )\n                )}\n              </div>\n            )}\n\n            {/* Other Fields (Text, Datetime, Array Fields) */}\n            <div className=\"d-flex flex-wrap\" style={{ gap: \"16px\", marginBottom: \"16px\" }}>\n              {/* Text Fields */}\n              {textFields.length > 0 &&\n                textFields.map((rule: any, index: number) => {\n                  if (sliderRules_stars.includes(rule) || sliderRules_stars_margin.includes(rule)) return null;\n                  const isSliderRule = sliderRules.includes(rule);\n\n                  return (\n                    <div\n                      key={index}\n                      className=\"d-flex flex-column\"\n                      style={{\n                        flex: \"1 1 calc(50% - 16px)\", // Two columns per row\n                        minWidth: \"150px\",\n                      }}\n                    >\n                      <label\n                        className=\"mb-1\"\n                        style={{\n                          fontSize: \"0.85rem\",\n                          fontWeight: \"bold\",\n                          textTransform: \"capitalize\",\n                        }}\n                      >\n                        {rule.replace(/_/g, \" \")}:\n                        {rule === \"sell_amount\" && (\n                          <span\n                            style={{ marginLeft: \"4px\", cursor: \"pointer\" }}\n                            title=\"This amount will override sell_qty\"\n                          >\n                            ‚ùì\n                          </span>\n                        )}\n                      </label>\n\n                      {isSliderRule ? (\n                        <>\n                          <input\n                            type=\"range\"\n                            min=\"0\"\n                            max=\"1\"\n                            step=\".01\"\n                            value={promptText[rule] || 0}\n                            onChange={(e) =>\n                              setPromptText({\n                                ...promptText,\n                                [rule]: Number(e.target.value),\n                              })\n                            }\n                            style={{ width: \"100%\" }}\n                          />\n                          <span style={{ fontSize: \"0.85rem\", fontWeight: \"bold\", marginTop: \"4px\" }}>\n                            {promptText[rule] || 0}\n                          </span>\n                        </>\n                      ) : (\n                        <input\n                          type=\"text\"\n                          value={promptText[rule]}\n                          onChange={(e) =>\n                            setPromptText({\n                              ...promptText,\n                              [rule]: e.target.value,\n                            })\n                          }\n                          style={{\n                            width: \"100%\",\n                            padding: \"6px\",\n                            fontSize: \"0.85rem\",\n                            border: \"1px solid #ccc\",\n                            borderRadius: \"4px\",\n                          }}\n                        />\n                      )}\n                    </div>\n                  );\n                })}\n\n              {/* Array Fields */}\n              {arrayFields.length > 0 &&\n                arrayFields.map((rule: any, index: number) => (\n                  <div\n                    key={index}\n                    className=\"d-flex flex-column\"\n                    style={{\n                      flex: \"1 1 calc(50% - 16px)\", // Two columns per row\n                      minWidth: \"150px\",\n                    }}\n                  >\n                    <label\n                      className=\"mb-1\"\n                      style={{\n                        fontSize: \"0.85rem\",\n                        fontWeight: \"bold\",\n                        textTransform: \"capitalize\",\n                      }}\n                    >\n                      {rule.replace(/_/g, \" \")}:\n                    </label>\n                    <select\n                      value={promptText[rule][0]}\n                      onChange={(e) =>\n                        setPromptText({\n                          ...promptText,\n                          [rule]: [e.target.value],\n                        })\n                      }\n                      style={{\n                        width: \"100%\",\n                        padding: \"6px\",\n                        fontSize: \"0.85rem\",\n                        border: \"1px solid #ccc\",\n                        borderRadius: \"4px\",\n                      }}\n                    >\n                      {promptText[rule].map((item: any, i: number) => (\n                        <option key={i} value={item}>\n                          {item}\n                        </option>\n                      ))}\n                    </select>\n                  </div>\n                ))}\n\n              {/* Datetime Fields */}\n              {datetimeFields.length > 0 &&\n                datetimeFields.map((rule: any, index: number) => (\n                  <div\n                    key={index}\n                    className=\"d-flex flex-column\"\n                    style={{\n                      flex: \"1 1 calc(50% - 16px)\", // Two columns per row\n                      minWidth: \"150px\",\n                    }}\n                  >\n                    <label\n                      className=\"mb-1\"\n                      style={{\n                        fontSize: \"0.85rem\",\n                        fontWeight: \"bold\",\n                        textTransform: \"capitalize\",\n                      }}\n                    >\n                      {rule.replace(/_/g, \" \")}:\n                    </label>\n                    <input\n                      type=\"datetime-local\"\n                      value={promptText[rule] && formatToLocalDatetime(promptText[rule])}\n                      onChange={(e) =>\n                        setPromptText({\n                          ...promptText,\n                          [rule]: e.target.value,\n                        })\n                      }\n                      style={{\n                        width: \"100%\",\n                        padding: \"6px\",\n                        fontSize: \"0.85rem\",\n                        border: \"1px solid #ccc\",\n                        borderRadius: \"4px\",\n                      }}\n                    />\n                  </div>\n                ))}\n\n              {/* Expander for sliderRules_stars */}\n              {sliderRules_stars.some((rule: any) => prompt_order_rules?.includes(rule)) && (\n                <div style={{ flex: \"1 1 100%\", marginTop: \"16px\" }}>\n                  <div\n                    style={{ cursor: \"pointer\", fontWeight: \"bold\", marginBottom: \"4px\" }}\n                    onClick={() => setShowStarsSliders((prev) => !prev)}\n                  >\n                    {showStarsSliders ? \"‚ñº\" : \"‚ñ∫\"} Advanced Allocation Options\n                  </div>\n                  {showStarsSliders && (\n                    <div className=\"d-flex flex-wrap\" style={{ gap: \"16px\" }}>\n                      {sliderRules_stars.map((rule: any, index: number) =>\n                        prompt_order_rules?.includes(rule) && promptText[rule] !== undefined && (\n                          <div\n                            key={index}\n                            className=\"d-flex flex-column\"\n                            style={{\n                              flex: \"1 1 calc(50% - 16px)\", // Two columns per row\n                              minWidth: \"150px\",\n                            }}\n                          >\n                            <label\n                              className=\"mb-1\"\n                              style={{\n                                fontSize: \"0.85rem\",\n                                fontWeight: \"bold\",\n                                textTransform: \"capitalize\",\n                              }}\n                            >\n                              {rule.replace(/_/g, \" \")}:\n                            </label>\n                            <input\n                              type=\"range\"\n                              min=\"0\"\n                              max=\"1\"\n                              step=\".01\"\n                              value={promptText[rule] || 0}\n                              onChange={(e) =>\n                                setPromptText({\n                                  ...promptText,\n                                  [rule]: Number(e.target.value),\n                                })\n                              }\n                              style={{ width: \"100%\" }}\n                            />\n                            <span style={{ fontSize: \"0.85rem\", fontWeight: \"bold\", marginTop: \"4px\" }}>\n                              {promptText[rule] || 0}\n                            </span>\n                          </div>\n                        )\n                      )}\n                    </div>\n                  )}\n                </div>\n              )}\n\n              {/* Expander for sliderRules_stars_margin */}\n              {sliderRules_stars_margin.some((rule: any) => prompt_order_rules?.includes(rule)) && (\n                <div style={{ flex: \"1 1 100%\", marginTop: \"16px\" }}>\n                  <div\n                    style={{ cursor: \"pointer\", fontWeight: \"bold\", marginBottom: \"4px\" }}\n                    onClick={() => setShowStarsMarginSliders((prev) => !prev)}\n                  >\n                    {showStarsMarginSliders ? \"‚ñº\" : \"‚ñ∫\"} Advanced Margin Allocation Options\n                  </div>\n                  {showStarsMarginSliders && (\n                    <div className=\"d-flex flex-wrap\" style={{ gap: \"16px\" }}>\n                      {sliderRules_stars_margin.map((rule: any, index: number) =>\n                        prompt_order_rules?.includes(rule) && promptText[rule] !== undefined && (\n                          <div\n                            key={index}\n                            className=\"d-flex flex-column\"\n                            style={{\n                              flex: \"1 1 calc(50% - 16px)\", // Two columns per row\n                              minWidth: \"150px\",\n                            }}\n                          >\n                            <label\n                              className=\"mb-1\"\n                              style={{\n                                fontSize: \"0.85rem\",\n                                fontWeight: \"bold\",\n                                textTransform: \"capitalize\",\n                              }}\n                            >\n                              {rule.replace(/_/g, \" \")}:\n                            </label>\n                            <input\n                              type=\"range\"\n                              min=\"0\"\n                              max=\"1\"\n                              step=\".01\"\n                              value={promptText[rule] || 0}\n                              onChange={(e) =>\n                                setPromptText({\n                                  ...promptText,\n                                  [rule]: Number(e.target.value),\n                                })\n                              }\n                              style={{ width: \"100%\" }}\n                            />\n                            <span style={{ fontSize: \"0.85rem\", fontWeight: \"bold\", marginTop: \"4px\" }}>\n                              {promptText[rule] || 0}\n                            </span>\n                          </div>\n                        )\n                      )}\n                    </div>\n                  )}\n                </div>\n              )}\n            </div>\n\n            {/* Display Grid Column Table */}\n            {display_grid_column &&\n              selectedRow &&\n              Array.isArray(selectedRow[display_grid_column]) &&\n              selectedRow[display_grid_column].length > 0 && (\n                <div style={{ margin: \"16px 0\" }}>\n                  <div\n                    style={{ cursor: \"pointer\", fontWeight: \"bold\", marginBottom: \"4px\" }}\n                    onClick={() => setShowButtonColData((prev: boolean) => !prev)}\n                  >\n                    <span style={{ marginRight: \"8px\" }}>\n                      {showButtonColData ? \"‚ñº\" : \"‚ñ∫\"}\n                    </span>\n                    <button\n                      type=\"button\"\n                      className=\"btn btn-link p-0\"\n                      style={{ fontWeight: \"bold\", textDecoration: \"underline\", color: \"#007bff\", background: \"none\", border: \"none\", cursor: \"pointer\" }}\n                      onClick={() => setShowButtonColData((prev: boolean) => !prev)}\n                    >\n                      {display_grid_column}\n                    </button>\n                  </div>\n                  {showButtonColData && (() => {\n                    const ordersToRender = selectedRow[display_grid_column];\n\n                    // Helper function to calculate cumulative left position for pinned columns\n                    const getPinnedColumnLeftPosition = (colIndex: number): number => {\n                      let leftOffset = 0;\n                      for (let i = 0; i < colIndex; i++) {\n                        const col = allCols[i];\n                        const editableCol = editableCols.find((ec: { col_header: string }) => ec.col_header === col);\n                        if (editableCol?.pinned) {\n                          // Use the column's width or default based on input type\n                          const colWidth = editableCol.width || (editableCol.dtype === \"datetime\" ? 140 : 100);\n                          leftOffset += colWidth;\n                        }\n                      }\n                      return leftOffset;\n                    };\n\n                    // Helper function for conditional coloring\n                    const getCellBackgroundColor = (col: string, idx: number, order: any) => {\n                      const editableCol = editableCols.find((ec: { col_header: string }) => ec.col_header === col);\n                      if (!editableCol) return \"white\";\n\n                      if (editableCol.backgroundColor) {\n                        return editableCol.backgroundColor;\n                      }\n\n                      if (editableCol.conditionalColor) {\n                        const cond = editableCol.conditionalColor;\n                        const cellValue = editableValues[col]?.[idx] ?? order[col];\n                        const compareValue = cond.compare_to ? order[cond.compare_to] : cond.value;\n\n    // ‚úÖ Handle 'in' operator for checking if value is in a list\n    if (cond.operator === \"in\") {\n      const valueList = Array.isArray(compareValue) ? compareValue : [compareValue];\n      return valueList.includes(cellValue) ? cond.trueColor : cond.falseColor;\n    }\n    \n    // ‚úÖ Handle '!in' operator (not in list)\n    if (cond.operator === \"!in\") {\n      const valueList = Array.isArray(compareValue) ? compareValue : [compareValue];\n      return !valueList.includes(cellValue) ? cond.trueColor : cond.falseColor;\n    }\n\n    // Existing string operations\n    if (cond.operator === \"contains\") {\n      return String(cellValue).toLowerCase().includes(String(compareValue).toLowerCase()) \n        ? cond.trueColor : cond.falseColor;\n    }\n    \n\n                        if (cond.operator === \"contains\") {\n                          return String(cellValue).toLowerCase().includes(String(compareValue).toLowerCase())\n                            ? cond.trueColor : cond.falseColor;\n                        }\n                        if (cond.operator === \"!contains\") {\n                          return !String(cellValue).toLowerCase().includes(String(compareValue).toLowerCase())\n                            ? cond.trueColor : cond.falseColor;\n                        }\n                        if (cond.operator === \"startsWith\") {\n                          return String(cellValue).toLowerCase().startsWith(String(compareValue).toLowerCase())\n                            ? cond.trueColor : cond.falseColor;\n                        }\n\n                        // Existing numeric comparisons\n                        if (cond.operator === \">=\" && cellValue >= compareValue) return cond.trueColor;\n                        if (cond.operator === \">\" && cellValue > compareValue) return cond.trueColor;\n                        if (cond.operator === \"<\" && cellValue < compareValue) return cond.trueColor;\n                        if (cond.operator === \"<=\" && cellValue <= compareValue) return cond.trueColor;\n                        if (cond.operator === \"==\" && cellValue == compareValue) return cond.trueColor;\n                        return cond.falseColor;\n                      }\n\n                      return \"white\";\n                    };\n\n                    return (\n                      <div style={{\n                        maxHeight: \"400px\",      // ‚úÖ Set a max height\n                        overflowY: \"auto\",       // ‚úÖ Enable vertical scrolling\n                        overflowX: \"auto\",       // ‚úÖ Keep horizontal scrolling\n                        border: \"1px solid #ddd\" // Optional: visual boundary\n                      }}>\n                        <table className=\"table table-bordered table-sm\" style={{ fontSize: \"0.6rem\" }}>\n                          <thead>\n                            <tr>\n                              {allCols.map((col, colIndex) => {\n                                const editableCol = editableCols.find(\n                                  (ec: { col_header: string }) => ec.col_header === col\n                                );\n                                const colWidth = editableCol?.width || (editableCol?.dtype === \"datetime\" ? 140 : 100);\n\n                                return (\n                                  <th\n                                    key={col}\n                                    style={{\n                                      whiteSpace: \"normal\",\n                                      wordWrap: \"break-word\",\n                                      backgroundColor: editableCol?.backgroundColor || \"#fafcff\",\n                                      color: \"black\",\n                                      textAlign: \"center\",\n                                      position: \"sticky\",\n                                      top: 0,\n                                      left: editableCol?.pinned ? `${getPinnedColumnLeftPosition(colIndex)}px` : \"auto\",\n                                      zIndex: editableCol?.pinned ? 20 : 15,\n                                      minWidth: `${colWidth}px`,\n                                    }}\n                                  >\n                                    <div style={{ display: \"flex\", alignItems: \"center\", justifyContent: \"center\" }}>\n                                      {editableCol?.display_name || col.replace(/_/g, \" \")}\n                                      {editableCol?.info && (\n                                        <span\n                                          style={{\n                                            marginLeft: \"4px\",\n                                            cursor: \"pointer\",\n                                            color: \"#007bff\",\n                                            fontSize: \"0.8rem\",\n                                          }}\n                                          title={editableCol.info}\n                                        >\n                                          ‚ùì\n                                        </span>\n                                      )}\n                                    </div>\n                                  </th>\n                                );\n                              })}\n                            </tr>\n                          </thead>\n                          <tbody>\n                            {ordersToRender.map((order: any, idx: number) => (\n                              <tr key={idx}>\n                                {allCols.map((col, colIndex) => {\n                                  const editableCol = editableCols.find((ec: { col_header: string; }) => ec.col_header === col);\n                                  const colWidth = editableCol?.width || (editableCol?.dtype === \"datetime\" ? 140 : 100);\n\n                                  // WORKERBEE Create func to handle column logic / updates sell qty ex below\n                                  if (col === \"sell_qty\") {\n                                    return (\n                                      <td\n                                        key={col}\n                                        style={{\n                                          backgroundColor: getCellBackgroundColor(col, idx, order),\n                                          position: editableCol?.pinned ? \"sticky\" : \"relative\",\n                                          left: editableCol?.pinned ? `${getPinnedColumnLeftPosition(colIndex)}px` : \"auto\",\n                                          zIndex: editableCol?.pinned ? 5 : 1,\n                                          minWidth: `${colWidth}px`,\n                                        }}\n                                      >\n                                        <input\n                                          type=\"number\"\n                                          min={0}\n                                          max={order.qty_available}\n                                          value={editableValues[col]?.[idx] || \"\"}\n                                          placeholder={order.qty_available ? `${order.qty_available} available` : \"\"}\n                                          onChange={(e) => {\n                                            let value = e.target.value;\n                                            if (value === \"\") {\n                                              setEditableValues((prev) => ({\n                                                ...prev,\n                                                [col]: { ...prev[col], [idx]: \"\" },\n                                              }));\n                                              return;\n                                            }\n                                            let num = Number(value);\n                                            if (num < 0) num = 0;\n                                            if (order.qty_available !== undefined && num > order.qty_available)\n                                              num = order.qty_available;\n\n                                            setEditableValues((prev) => ({\n                                              ...prev,\n                                              [col]: { ...prev[col], [idx]: num },\n                                            }));\n\n                                            const updatedOrders = ordersToRender.map(\n                                              (ord: any, i: number) => ({\n                                                ...ord,\n                                                sell_qty: i === idx ? String(num) : editableValues[col]?.[i] || \"\",\n                                              })\n                                            );\n                                            setPromptText({\n                                              ...promptText,\n                                              active_orders_with_qty: updatedOrders,\n                                            });\n                                          }}\n                                          style={{ width: \"100%\", fontSize: \"0.8rem\" }}\n                                        />\n                                      </td>\n                                    );\n                                  } else if (editableCol) {\n                                    if (editableCol.dtype === \"list\") {\n                                      const options = editableCol.values || [];\n                                      return (\n                                        <td\n                                          key={col}\n                                          style={{\n                                            backgroundColor: getCellBackgroundColor(col, idx, order),\n                                            position: editableCol.pinned ? \"sticky\" : \"relative\",\n                                            left: editableCol.pinned ? `${getPinnedColumnLeftPosition(colIndex)}px` : \"auto\",\n                                            zIndex: editableCol.pinned ? 5 : 1,\n                                            minWidth: `${colWidth}px`,\n                                          }}\n                                        >\n                                          <select\n                                            value={editableValues[col]?.[idx] || \"\"}\n                                            onChange={(e) => {\n                                              const value = e.target.value;\n                                              setEditableValues((prev) => ({\n                                                ...prev,\n                                                [col]: { ...prev[col], [idx]: value },\n                                              }));\n                                            }}\n                                            style={{ width: \"100%\", fontSize: \"0.8rem\", padding: \"4px\" }}\n                                          >\n                                            <option value=\"\" disabled>Select...</option>\n                                            {options.map((option: string, i: number) => (\n                                              <option key={i} value={option}>{option}</option>\n                                            ))}\n                                          </select>\n                                        </td>\n                                      );\n                                    } else if (editableCol.dtype === \"checkbox\") {\n                                      return (\n                                        <td\n                                          key={col}\n                                          style={{\n                                            backgroundColor: getCellBackgroundColor(col, idx, order),\n                                            position: editableCol.pinned ? \"sticky\" : \"relative\",\n                                            left: editableCol.pinned ? `${getPinnedColumnLeftPosition(colIndex)}px` : \"auto\",\n                                            zIndex: editableCol.pinned ? 5 : 1,\n                                            minWidth: `${colWidth}px`,\n                                          }}\n                                        >\n                                          <input\n                                            type=\"checkbox\"\n                                            checked={!!editableValues[col]?.[idx]}\n                                            onChange={e => {\n                                              const value = e.target.checked;\n                                              setEditableValues(prev => ({\n                                                ...prev,\n                                                [col]: { ...prev[col], [idx]: value }\n                                              }));\n                                            }}\n                                          />\n                                        </td>\n                                      );\n                                    } else if (editableCol.dtype === \"number\" || editableCol.dtype === \"float\" || editableCol.dtype === \"int\") {\n                                      return (\n                                        <td\n                                          key={col}\n                                          style={{\n                                            backgroundColor: getCellBackgroundColor(col, idx, order),\n                                            position: editableCol.pinned ? \"sticky\" : \"relative\",\n                                            left: editableCol.pinned ? `${getPinnedColumnLeftPosition(colIndex)}px` : \"auto\",\n                                            zIndex: editableCol.pinned ? 5 : 1,\n                                            minWidth: `${colWidth}px`,\n                                          }}\n                                        >\n                                          <input\n                                            type=\"number\"\n                                            value={editableValues[col]?.[idx] || \"\"}\n                                            onChange={e => {\n                                              const value = e.target.value;\n                                              setEditableValues(prev => ({\n                                                ...prev,\n                                                [col]: { ...prev[col], [idx]: value }\n                                              }));\n                                            }}\n                                            style={{ width: \"100%\", fontSize: \"0.8rem\" }}\n                                          />\n                                        </td>\n                                      );\n                                    } else if (editableCol.dtype === \"datetime\") {\n                                      return (\n                                        <td\n                                          key={col}\n                                          style={{\n                                            backgroundColor: getCellBackgroundColor(col, idx, order),\n                                            position: editableCol.pinned ? \"sticky\" : \"relative\",\n                                            left: editableCol.pinned ? `${getPinnedColumnLeftPosition(colIndex)}px` : \"auto\",\n                                            zIndex: editableCol.pinned ? 5 : 1,\n                                            minWidth: `${colWidth}px`,\n                                          }}\n                                        >\n                                          <input\n                                            type=\"datetime-local\"\n                                            value={editableValues[col]?.[idx] || \"\"}\n                                            onChange={e => {\n                                              const value = e.target.value;\n                                              setEditableValues(prev => ({\n                                                ...prev,\n                                                [col]: { ...prev[col], [idx]: value }\n                                              }));\n                                            }}\n                                            style={{ width: \"100%\", fontSize: \"0.8rem\" }}\n                                          />\n                                        </td>\n                                      );\n                                    } else {\n                                      // text or str\n                                      return (\n                                        <td\n                                          key={col}\n                                          style={{\n                                            backgroundColor: getCellBackgroundColor(col, idx, order),\n                                            position: editableCol.pinned ? \"sticky\" : \"relative\",\n                                            left: editableCol.pinned ? `${getPinnedColumnLeftPosition(colIndex)}px` : \"auto\",\n                                            zIndex: editableCol.pinned ? 5 : 1,\n                                            minWidth: `${colWidth}px`,\n                                          }}\n                                        >\n                                          <input\n                                            type=\"text\"\n                                            value={editableValues[col]?.[idx] || \"\"}\n                                            onChange={e => {\n                                              const value = e.target.value;\n                                              setEditableValues(prev => ({\n                                                ...prev,\n                                                [col]: { ...prev[col], [idx]: value }\n                                              }));\n                                            }}\n                                            style={{ width: \"100%\", fontSize: \"0.8rem\" }}\n                                          />\n                                        </td>\n                                      );\n                                    }\n                                  } else {\n                                    // Render plain text for non-editable columns\n                                    return (\n                                      <td key={col} style={{ minWidth: `${colWidth}px` }}>\n                                        {order && order[col] !== undefined\n                                          ? typeof order[col] === \"number\"\n                                            ? Number(order[col]).toLocaleString(undefined, { maximumFractionDigits: 2 })\n                                            : String(order[col])\n                                          : \"\"}\n                                      </td>\n                                    );\n                                  }\n                                })}\n                              </tr>\n                            ))}\n                          </tbody>\n                          <tfoot>\n                            <tr>\n                              {allCols.map((col) => {\n                                try {\n                                  const sum = ordersToRender.reduce((acc: number, order: any) => {\n                                    const val = order[col];\n                                    return typeof val === \"number\" && !isNaN(val) ? acc + val : acc;\n                                  }, 0);\n                                  const hasNumeric = ordersToRender.some((order: any) => typeof order[col] === \"number\" && !isNaN(order[col]));\n                                  return (\n                                    <td key={col} style={{ fontWeight: \"bold\", background: \"#f7f7f7\" }}>\n                                      {hasNumeric ? sum.toLocaleString(undefined, { maximumFractionDigits: 2 }) : \"\"}\n                                    </td>\n                                  );\n                                } catch (e) {\n                                  return <td key={col}></td>;\n                                }\n                              })}\n                            </tr>\n                          </tfoot>\n                        </table>\n                      </div>\n                    );\n                  })()}\n\n\n                </div>\n              )}\n          </div>\n        </div>\n\n\n        {/* Modal Footer */}\n        <div className=\"modal-footer d-flex justify-content-center\" style={{\n          position: \"sticky\",\n          bottom: 0,\n          backgroundColor: \"#fff\", // ‚úÖ Add solid background\n          zIndex: 20, // ‚úÖ Higher than table content\n          boxShadow: \"0 -2px 10px rgba(0,0,0,0.1)\", // ‚úÖ Optional: adds subtle shadow above\n          padding: \"12px\" // ‚úÖ Ensure padding\n        }}>\n          <button type=\"button\" className=\"btn btn-primary mx-2\"\n            onClick={handleOkSecond}\n            ref={ref}>\n            {loading ? (\n              <span className=\"spinner-border spinner-border-sm\" role=\"status\" aria-hidden=\"true\"></span>\n            ) : (\n              \"Ok\"\n            )}\n          </button>\n          <button type=\"button\" className=\"btn btn-secondary mx-2\" onClick={closeModal}>\n            Cancel\n          </button>\n        </div>\n\n      </div>\n    </ReactModal>\n  );\n\n};\n\nexport default MyModal;\n","// stole from https://github.com/andfanilo/streamlit-echarts/blob/master/streamlit_echarts/frontend/src/utils.js Thanks andfanilo\nfunction mapObject(obj, fn, keysToIgnore) {\n    let keysToMap = Object.keys(obj)\n    return keysToMap.reduce((res, key) => {\n        if (!keysToIgnore.includes(key)) {\n            res[key] = fn(obj[key]);\n            return res\n        }\n        res[key] = obj[key];\n        return res\n\n    }, {})\n}\n\nfunction deepMap(obj, fn, keysToIgnore = []) {\n    const deepMapper = (val) =>\n        val !== null && typeof val === \"object\" ? deepMap(val, fn) : fn(val)\n    if (Array.isArray(obj)) {\n        return obj.map(deepMapper)\n    }\n    if (typeof obj === \"object\") {\n        return mapObject(obj, deepMapper, keysToIgnore)\n    }\n    return obj\n}\n\nexport { deepMap }\n","import Select from \"react-select\";\r\nimport React, {\r\n  useState,\r\n  useEffect,\r\n  useMemo,\r\n  useRef,\r\n  useCallback\r\n} from \"react\"\r\nimport { AgGridReact } from \"ag-grid-react\"\r\nimport { RowClassParams } from 'ag-grid-community';\r\n\r\nimport toastr from \"toastr\"\r\nimport \"toastr/build/toastr.min.css\"\r\nimport \"ag-grid-community/styles/ag-grid.css\"\r\nimport \"ag-grid-community/styles/ag-theme-alpine.css\"\r\nimport \"ag-grid-community/styles/ag-theme-balham.css\"\r\nimport \"ag-grid-community/styles/ag-theme-material.css\"\r\nimport MyModal from './components/Modal'\r\nimport \"ag-grid-enterprise\"\r\nimport { parseISO, compareAsc, set, sub } from \"date-fns\"\r\nimport { format } from \"date-fns-tz\"\r\nimport { duration } from \"moment\"\r\nimport \"./styles.css\"\r\nimport axios from \"axios\"\r\n// import { io } from \"socket.io-client\";\r\n\r\nimport {\r\n  ComponentProps,\r\n  Streamlit,\r\n  withStreamlitConnection,\r\n} from \"streamlit-component-lib\"\r\nimport {\r\n  ColDef,\r\n  ColGroupDef,\r\n  ColumnResizedEvent,\r\n  GetRowIdFunc,\r\n  GetRowIdParams,\r\n  Grid,\r\n  GridOptions,\r\n  GridReadyEvent,\r\n  SideBarDef,\r\n  ValueParserParams,\r\n} from \"ag-grid-community\"\r\nimport { deepMap } from \"./utils\"\r\n\r\nconst isDev = process.env.NODE_ENV === 'development';\r\nconst log = isDev ? console.log : () => { };\r\nconst warn = isDev ? console.warn : () => { };\r\nconst error = console.error; // Always log errors\r\n\r\ntype Props = {\r\n  username: string\r\n  api: string\r\n  api_update: string\r\n  api_ws?: string\r\n  refresh_sec?: number\r\n  refresh_cutoff_sec?: number\r\n  gridoption_build?: any\r\n  prod?: boolean\r\n  grid_options?: any\r\n  index: string\r\n  enable_JsCode: boolean\r\n  kwargs: any,\r\n  autoUpdate?: boolean;\r\n}\r\n\r\nlet g_rowdata: any[] = []\r\nlet g_newRowData: any = null\r\n\r\n\r\n\r\nfunction dateFormatter(isoString: string, formaterString: string): String {\r\n  try {\r\n    let date = new Date(isoString)\r\n    return format(date, formaterString)\r\n  } catch {\r\n    return isoString\r\n  } finally {\r\n  }\r\n}\r\n\r\nfunction currencyFormatter(number: any, currencySymbol: string): String {\r\n  let n = Number.parseFloat(number)\r\n  if (!Number.isNaN(n)) {\r\n    return currencySymbol + n.toFixed(2)\r\n  } else {\r\n    return number\r\n  }\r\n}\r\n\r\nfunction numberFormatter(number: any, precision: number): String {\r\n  let n = Number.parseFloat(number)\r\n  if (!Number.isNaN(n)) {\r\n    return n.toFixed(precision)\r\n  } else {\r\n    return number\r\n  }\r\n}\r\n\r\nconst columnFormaters = {\r\n  columnTypes: {\r\n    dateColumnFilter: {\r\n      filter: \"agDateColumnFilter\",\r\n      filterParams: {\r\n        comparator: (filterValue: any, cellValue: string) =>\r\n          compareAsc(parseISO(cellValue), filterValue),\r\n      },\r\n    },\r\n    numberColumnFilter: {\r\n      filter: \"agNumberColumnFilter\",\r\n    },\r\n    shortDateTimeFormat: {\r\n      valueFormatter: (params: any) =>\r\n        dateFormatter(params.value, \"dd/MM/yyyy HH:mm\"),\r\n    },\r\n    customDateTimeFormat: {\r\n      valueFormatter: (params: any) =>\r\n        dateFormatter(params.value, params.column.colDef.custom_format_string),\r\n    },\r\n    customNumericFormat: {\r\n      valueFormatter: (params: any) =>\r\n        numberFormatter(params.value, params.column.colDef.precision ?? 2),\r\n    },\r\n    customCurrencyFormat: {\r\n      valueFormatter: (params: any) =>\r\n        currencyFormatter(\r\n          params.value,\r\n          params.column.colDef.custom_currency_symbol\r\n        ),\r\n    },\r\n    timedeltaFormat: {\r\n      valueFormatter: (params: any) => duration(params.value).humanize(true),\r\n    },\r\n  },\r\n}\r\n\r\n\r\nconst HyperlinkRenderer = (props: any) => {\r\n  const linkField = props.column.colDef[\"linkField\"];\r\n  const baseURL = props.column.colDef.baseURL;\r\n  const linkValue = props.data && linkField ? props.data[linkField] : null;\r\n\r\n  // Only render a link for real data rows\r\n  if (linkValue && baseURL) {\r\n    return (\r\n      <a href={`${baseURL}/${linkValue}`} target=\"_blank\" rel=\"noopener noreferrer\">\r\n        {props.value}\r\n      </a>\r\n    );\r\n  }\r\n  // For pivot/group/total rows, just render the value\r\n  return <span>{props.value}</span>;\r\n};\r\n\r\n\r\ntoastr.options = {\r\n  positionClass: \"toast-top-full-width\",\r\n  hideDuration: 300,\r\n  timeOut: 3000,\r\n}\r\n\r\n\r\n\r\n\r\nconst AgGrid = (props: Props) => {\r\n  const BtnCellRenderer = (props: any) => {\r\n    const btnClickedHandler = () => {\r\n      props.clicked(props.node.id)\r\n    };\r\n    if (!props || !props.node) return null;\r\n    if (props.node.rowPinned === 'bottom') {\r\n      return <span>{props.value}</span>;\r\n    }\r\n    // Use subtotal row style if present\r\n    const subtotalStyle =\r\n      props.data && props.col_header && props.data[`${props.col_header}_cellStyle`]\r\n        ? props.data[`${props.col_header}_cellStyle`]\r\n        : props.cellStyle;\r\n\r\n    return (\r\n      <button\r\n        onClick={btnClickedHandler}\r\n        style={{\r\n          background: \"transparent\",\r\n          border: subtotalStyle?.border || \"none\",\r\n          width: props.width ? props.width : \"100%\",\r\n          color: subtotalStyle?.color || \"inherit\",\r\n          ...subtotalStyle,\r\n        }}\r\n      >\r\n        {props.col_header ? props.value : props.buttonName}\r\n      </button>\r\n    );\r\n  };\r\n  function buildDetailGridOptions(detailGridOptions: any, level: number): any {\r\n    const options = { ...detailGridOptions, masterDetail: true };\r\n\r\n    options.getDetailRowData = (params: any) => {\r\n      let nestedRows = [];\r\n      if (Array.isArray(params.data.nestedRows)) {\r\n        nestedRows = params.data.nestedRows;\r\n      } else if (params.data.nestedRows) {\r\n        nestedRows = [params.data.nestedRows];\r\n      }\r\n      params.successCallback(nestedRows.length ? nestedRows : []);\r\n    };\r\n\r\n    if (\r\n      options.detailCellRendererParams &&\r\n      options.detailCellRendererParams.detailGridOptions\r\n    ) {\r\n      options.detailCellRendererParams.detailGridOptions = buildDetailGridOptions(\r\n        options.detailCellRendererParams.detailGridOptions,\r\n        level + 1\r\n      );\r\n    }\r\n\r\n    return options;\r\n  }\r\n\r\n  const getGridOptions = () => {\r\n    let options = { ...grid_options };\r\n    if (kwargs.nestedGridEnabled && kwargs.detailGridOptions) {\r\n      options.masterDetail = true;\r\n      options.detailCellRendererParams = {\r\n        detailGridOptions: buildDetailGridOptions(kwargs.detailGridOptions, 1),\r\n        getDetailRowData: (params: any) => {\r\n          let nestedRows = [];\r\n          if (Array.isArray(params.data.nestedRows)) {\r\n            nestedRows = params.data.nestedRows;\r\n          } else if (params.data.nestedRows) {\r\n            nestedRows = [params.data.nestedRows];\r\n          }\r\n          params.successCallback(nestedRows.length ? nestedRows : []);\r\n        },\r\n      };\r\n    } else {\r\n      options.masterDetail = false;\r\n      options.detailCellRendererParams = undefined;\r\n    }\r\n    return options;\r\n  };\r\n\r\n\r\n  const gridRef = useRef<AgGridReact>(null)\r\n  const {\r\n    username,\r\n    api,\r\n    api_update,\r\n    api_ws = undefined,\r\n    refresh_sec = undefined,\r\n    refresh_cutoff_sec = 0,\r\n    prod = true,\r\n    index,\r\n    enable_JsCode,\r\n    kwargs,\r\n  } = props\r\n  let { grid_options = {} } = props\r\n\r\n\r\n  //parsing must be done here. For some unknow reason if its moved after the\r\n  //button mapping, deepMap gets lots of React objects (api, symbolRefs, etc.)\r\n  //this impacts performance and crashes the grid.\r\n  if (enable_JsCode) {\r\n    grid_options = deepMap(grid_options, parseJsCodeFromPython, [\"rowData\"])\r\n  }\r\n\r\n  let { buttons, toggle_views, api_key, api_lastmod_key = null, columnOrder = [],\r\n    refresh_success = null, filter_button = '' } = kwargs\r\n  const [rowData, setRowData] = useState<any[]>([])\r\n  const [modalShow, setModalshow] = useState(false)\r\n  const [modalData, setModalData] = useState({})\r\n  const [promptText, setPromptText] = useState(\"\")\r\n  const [viewId, setViewId] = useState(0)\r\n  const [lastModified, setLastModified] = useState<string | null>(null);\r\n  const [previousViewId, setpreviousViewId] = useState(89)\r\n  const [activeFilter, setActiveFilter] = useState<string | null>(null);\r\n  const [selectedColumnSetKeys, setSelectedColumnSetKeys] = useState<string[]>([]);\r\n  const [initialColumnState, setInitialColumnState] = useState<any>(null);\r\n\r\n  const [selectedCellContent, setSelectedCellContent] = useState<string | null>(null);\r\n  const onCellClicked = (event: any) => {\r\n    if (event.value) {\r\n      setSelectedCellContent(event.value); // Set the clicked cell's value\r\n    }\r\n  };\r\n\r\n\r\n  useEffect(() => {\r\n    if (!kwargs.api_ws) {\r\n      log(\"‚ö†Ô∏è  api_ws is undefined, WebSocket not started.\");\r\n      return;\r\n    }\r\n\r\n    log(\"üîå Attempting WebSocket connection to:\", kwargs.api_ws);\r\n\r\n    let ws: WebSocket | null = null;\r\n    let reconnectTimeout: NodeJS.Timeout;\r\n    let heartbeatInterval: NodeJS.Timeout;\r\n    let isIntentionallyClosed = false;\r\n    let reconnectAttempts = 0;\r\n    const MAX_RECONNECT_ATTEMPTS = 10;\r\n    const HEARTBEAT_INTERVAL = 300000; // 5 minutes\r\n    const RECONNECT_DELAY = 3000; // 3 seconds\r\n\r\n    const connectWebSocket = () => {\r\n      try {\r\n        ws = new WebSocket(kwargs.api_ws);\r\n\r\n        ws.onopen = () => {\r\n          log(\"‚úÖ WebSocket connected!\");\r\n          reconnectAttempts = 0;\r\n\r\n          const handshake = {\r\n            username: username,\r\n            toggle_view_selection: toggle_views ? toggle_views[viewId] : 'queen',\r\n            api_key: api_key,\r\n            prod: prod,\r\n          };\r\n\r\n          log(\"üì§ Sending handshake:\", handshake);\r\n          ws?.send(JSON.stringify(handshake));\r\n\r\n          // // ‚úÖ Start heartbeat\r\n          startHeartbeat();\r\n        };\r\n\r\n        ws.onmessage = (event) => {\r\n          log(\"üì• WebSocket message received\");\r\n          try {\r\n            const data = JSON.parse(event.data);\r\n\r\n            // Handle pong response\r\n            if (data.type === 'pong') {\r\n              log(\"üíì Heartbeat acknowledged\");\r\n              return;\r\n            }\r\n\r\n            // Handle connection confirmation\r\n            if (data.type === 'connection_established') {\r\n              log(\"Handshake confirmed:\", data.message, prod);\r\n              return;\r\n            }\r\n\r\n            // Handle array of updates (batch)\r\n            if (Array.isArray(data) && data.length > 0) {\r\n              // log(`üì• Received ${data.length} row updates`);\r\n              // log(\"üì¶ First update sample:\", JSON.stringify(data[0], null, 2));\r\n\r\n              const rowsToUpdate: any[] = [];\r\n\r\n              data.forEach(({ row_id, updates }) => {\r\n                const existingNode = gridRef.current?.api.getRowNode(row_id);\r\n                if (existingNode && existingNode.data) {\r\n                  // log(`üîç Existing data for ${row_id}:`, existingNode.data);\r\n                  // log(`üì® Updates for ${row_id}:`, updates);\r\n\r\n                  // Start with existing data to preserve everything\r\n                  const updatedRow = { ...existingNode.data };\r\n\r\n                  // Apply only the updates from WebSocket\r\n                  Object.keys(updates).forEach(key => {\r\n                    updatedRow[key] = updates[key];\r\n                  });\r\n\r\n                  // Ensure index is preserved\r\n                  updatedRow[index] = row_id;\r\n\r\n                  rowsToUpdate.push(updatedRow);\r\n                } else {\r\n                  log(\"‚ö†Ô∏è  Row not found for update:\", row_id);\r\n                }\r\n              });\r\n\r\n              // Apply all updates in ONE transaction\r\n              if (rowsToUpdate.length > 0) {\r\n                gridRef.current?.api.applyTransaction({\r\n                  update: rowsToUpdate\r\n                });\r\n                log(`‚úÖ Updated ${rowsToUpdate.length} rows`);\r\n\r\n                // ‚úÖ Recalculate and update pinned bottom row\r\n                if (gridRef.current?.api) {\r\n                  calculateAndUpdateSubtotals(gridRef.current.api);\r\n                }\r\n              }\r\n            }\r\n          } catch (error) {\r\n            console.error(\"‚ùå Error processing WebSocket message:\", error);\r\n          }\r\n        };\r\n\r\n        ws.onerror = (error) => {\r\n          console.error(\"‚ùå WebSocket error:\", error);\r\n          stopHeartbeat();\r\n        };\r\n\r\n        ws.onclose = (event) => {\r\n          log(\"üîå WebSocket closed:\", {\r\n            code: event.code,\r\n            reason: event.reason,\r\n            wasClean: event.wasClean\r\n          });\r\n\r\n          stopHeartbeat();\r\n\r\n          // ‚úÖ Auto-reconnect\r\n          if (!isIntentionallyClosed) {\r\n            if (reconnectAttempts < MAX_RECONNECT_ATTEMPTS) {\r\n              reconnectAttempts++;\r\n              log(`üîÑ Reconnect attempt ${reconnectAttempts}/${MAX_RECONNECT_ATTEMPTS} in ${RECONNECT_DELAY / 1000}s...`);\r\n\r\n              reconnectTimeout = setTimeout(() => {\r\n                log(\"üîÑ Reconnecting WebSocket...\");\r\n                connectWebSocket();\r\n              }, RECONNECT_DELAY);\r\n            } else {\r\n              console.error(\"‚ùå Max reconnection attempts reached. Please refresh the page.\");\r\n              toastr.error(\"WebSocket connection lost. Please refresh the page.\");\r\n            }\r\n          }\r\n        };\r\n      } catch (error) {\r\n        console.error(\"‚ùå Error creating WebSocket:\", error);\r\n        stopHeartbeat();\r\n      }\r\n    };\r\n\r\n    // ‚úÖ Heartbeat to keep connection alive\r\n    const startHeartbeat = () => {\r\n      stopHeartbeat();\r\n\r\n      heartbeatInterval = setInterval(() => {\r\n        if (ws && ws.readyState === WebSocket.OPEN) {\r\n          log(\"üíì Sending heartbeat ping...\");\r\n          try {\r\n            ws.send(JSON.stringify({ type: 'ping' }));\r\n          } catch (error) {\r\n            console.error(\"‚ùå Failed to send heartbeat:\", error);\r\n            stopHeartbeat();\r\n          }\r\n        } else {\r\n          console.warn(\"‚ö†Ô∏è  WebSocket not open during heartbeat\");\r\n          stopHeartbeat();\r\n\r\n          if (!isIntentionallyClosed && reconnectAttempts < MAX_RECONNECT_ATTEMPTS) {\r\n            log(\"üîÑ Connection lost, attempting to reconnect...\");\r\n            connectWebSocket();\r\n          }\r\n        }\r\n      }, HEARTBEAT_INTERVAL);\r\n    };\r\n\r\n    const stopHeartbeat = () => {\r\n      if (heartbeatInterval) {\r\n        clearInterval(heartbeatInterval);\r\n        heartbeatInterval = undefined as any;\r\n      }\r\n    };\r\n\r\n    // Initial connection\r\n    connectWebSocket();\r\n\r\n    // Cleanup\r\n    return () => {\r\n      log(\"üßπ Cleaning up WebSocket connection\");\r\n      isIntentionallyClosed = true;\r\n      stopHeartbeat();\r\n      clearTimeout(reconnectTimeout);\r\n      if (ws && ws.readyState === WebSocket.OPEN) {\r\n        ws.close();\r\n      }\r\n    };\r\n  }, [kwargs.api_ws, index, viewId, username, api_key]);\r\n\r\n  const checkLastModified = async (): Promise<boolean> => {\r\n    try {\r\n      if (api_lastmod_key === null) {\r\n        log(\"api key is null, returning false\");\r\n        return true;\r\n      }\r\n      if (api_lastmod_key !== null && api_lastmod_key !== undefined) {\r\n        const baseurl = api.split('/').slice(0, -1).join('/');\r\n        const res = await axios.get(`${baseurl}/lastmod_key`, {\r\n          params: {\r\n            api_key: api_key,\r\n            client_user: username,\r\n            prod: prod,\r\n            api_lastmod_key: api_lastmod_key,\r\n          },\r\n        });\r\n        if (res.data?.lastModified !== lastModified) {\r\n          setLastModified(res.data.lastModified);\r\n          return true;\r\n        } else {\r\n          return false;\r\n        }\r\n      }\r\n      return false;\r\n    } catch (error: any) {\r\n      toastr.error(`Failed to check last modified: ${error.message}`);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const checkViewIdChanged = async (currentViewId: number, previousViewId: number): Promise<boolean> => {\r\n    if (currentViewId !== previousViewId) {\r\n      setpreviousViewId(currentViewId);\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  };\r\n\r\n  // BUTTONS, MOVE OUT OF USEEFFECT\r\n  useEffect(() => {\r\n    Streamlit.setFrameHeight();\r\n\r\n    if (buttons.length) {\r\n      buttons = deepMap(buttons, parseJsCodeFromPython, [\"rowData\"]); // process JsCode from buttons props\r\n\r\n      buttons.forEach((button: any) => {\r\n\r\n        const {\r\n          prompt_field,\r\n          prompt_message,\r\n          button_api,\r\n          prompt_order_rules,\r\n          col_header,\r\n          col_headername,\r\n          col_width,\r\n          pinned,\r\n          button_name,\r\n          border_color,\r\n          border,\r\n          add_symbol_row_info,\r\n          display_grid_column,\r\n          editableCols,\r\n          ...otherKeys\r\n        } = button;\r\n\r\n        let filterParams = button.filterParams || {};\r\n        if (kwargs['filter_apply']) {\r\n          filterParams = { ...filterParams, buttons: ['apply', 'reset'] };\r\n        }\r\n\r\n        grid_options.columnDefs!.push({\r\n          ...otherKeys,\r\n          field: col_header || index,\r\n          headerName: col_headername,\r\n          width: col_width,\r\n          pinned: pinned,\r\n          cellRenderer: BtnCellRenderer,\r\n          // valueFormatter: otherKeys.valueFormatter ? otherKeys.valueFormatter : undefined,\r\n          filterParams,\r\n          cellRendererParams: {\r\n            col_header,\r\n            buttonName: button_name,\r\n            borderColor: border_color,\r\n            border: border,\r\n            filterParams,\r\n            cellStyle: button.cellStyle,\r\n            // valueFormatter: button.valueFormatter,\r\n            ...(button.cellRendererParams || {}),\r\n            clicked: async function (row_index: any) {\r\n              try {\r\n                // const selectedRow = g_rowdata.find((row) => row[index] === row_index);\r\n                const freshNode = gridRef.current?.api.getRowNode(row_index);\r\n                if (!freshNode?.data) {\r\n                  console.error(\"‚ùå Could not find fresh row data for:\", row_index);\r\n                  toastr.error(\"Could not load row data\");\r\n                  return;\r\n                }\r\n                const selectedRow = freshNode.data;\r\n                if (prompt_order_rules) {\r\n                  const str = selectedRow[prompt_field];\r\n                  const selectedField =\r\n                    typeof str === \"string\"\r\n                      ? JSON.parse(\r\n                        selectedRow[prompt_field]\r\n                          .replace(/'/g, '\"')\r\n                          .replace(/\\n/g, \"\")\r\n                          .replace(/\\s/g, \"\")\r\n                          .replace(/False/g, \"false\")\r\n                          .replace(/True/g, \"true\")\r\n                      )\r\n                      : str;\r\n\r\n                  setModalshow(true);\r\n                  setModalData({\r\n                    gridRef: gridRef,           // ‚úÖ Pass grid reference\r\n                    index: index,               // ‚úÖ Pass index\r\n                    prompt_message,\r\n                    button_api: button_api,\r\n                    username: username,\r\n                    prod: prod,\r\n                    selectedRow: selectedRow,   // ‚úÖ Fresh data from grid\r\n                    kwargs: kwargs,\r\n                    prompt_field,\r\n                    prompt_order_rules,\r\n                    selectedField,\r\n                    add_symbol_row_info,\r\n                    display_grid_column,\r\n                    editableCols,\r\n                  });\r\n\r\n                  const rules_value: any = {};\r\n                  prompt_order_rules.forEach((rule: string) => {\r\n                    rules_value[rule] = selectedField[rule];\r\n                  });\r\n\r\n                  setPromptText(rules_value);\r\n                } else if (prompt_field && prompt_message) {\r\n                  setModalshow(true);\r\n                  setModalData({\r\n                    gridRef: gridRef,           // Pass grid reference\r\n                    index: index,               // Pass index\r\n                    prompt_message,\r\n                    button_api: button_api,\r\n                    username: username,\r\n                    prod: prod,\r\n                    selectedRow: selectedRow,   // Fresh data from grid\r\n                    kwargs: kwargs,\r\n                  });\r\n                  setPromptText(selectedRow[prompt_field]);\r\n                  setModalshow(true)\r\n                } else {\r\n                  if (window.confirm(prompt_message)) {\r\n                    await axios.post(button_api, {\r\n                      username: username,\r\n                      prod: prod,\r\n                      selected_row: selectedRow,\r\n                      ...kwargs,\r\n                    });\r\n                  }\r\n                  toastr.success(\"Success!\");\r\n                }\r\n              } catch (error) {\r\n                alert(`${error}`);\r\n              }\r\n            },\r\n          },\r\n        });\r\n      });\r\n    }\r\n\r\n    // Reorder columns based on a predefined list\r\n    // const columnOrder = [\"sector\", \"broker_qty_available\", \"queens_suggested_sell\"]; // Replace with your desired column order\r\n\r\n    if (columnOrder.length > 0 && grid_options.columnDefs) {\r\n      grid_options.columnDefs.sort((a: any, b: any) => {\r\n        // If both columns are in the columnOrder array, maintain their order\r\n        if (columnOrder.indexOf(a.field) !== -1 && columnOrder.indexOf(b.field) !== -1) {\r\n          return columnOrder.indexOf(a.field) - columnOrder.indexOf(b.field);\r\n        }\r\n\r\n        // If one of the columns isn't in columnOrder, keep its original position\r\n        if (columnOrder.indexOf(a.field) === -1) return 1;\r\n        if (columnOrder.indexOf(b.field) === -1) return -1;\r\n\r\n        return 0;\r\n      });\r\n    }\r\n\r\n\r\n    // Optional: Refresh header if necessary (if needed)\r\n    if (gridRef.current?.api) {\r\n      gridRef.current.api.refreshHeader();\r\n    }\r\n  }, [buttons, grid_options.columnDefs]);\r\n\r\n  const fetchAndSetData = async () => {\r\n    const array = await fetchData();\r\n    if (array === false) return false;\r\n    setRowData(array);\r\n    g_rowdata = array;\r\n    return true;\r\n  };\r\n\r\n  useEffect(() => {\r\n    onRefresh()\r\n  }, [viewId])\r\n\r\n\r\n  const fetchData = async () => {\r\n    try {\r\n      let toggle_view = toggle_views ? toggle_views[viewId] : \"none\";\r\n      const hasViewChanged = await checkViewIdChanged(viewId, previousViewId);\r\n\r\n      // If view has changed, skip checkLastModified\r\n      if (!hasViewChanged && refresh_sec && refresh_sec > 0) {\r\n        const isLastModified = await checkLastModified();\r\n        if (!isLastModified) {\r\n          return false;\r\n        }\r\n      }\r\n\r\n      log(\"fetching data...\", api);\r\n      const res = await axios.post(api, {\r\n        username: username,\r\n        prod: prod,\r\n        ...kwargs,\r\n        toggle_view_selection: toggle_view\r\n      });\r\n      const array = JSON.parse(res.data);\r\n\r\n\r\n      return array;\r\n    }\r\n    catch (error: any) {\r\n      toastr.error(`Fetch Error: ${error.message}`);\r\n      return false;\r\n    }\r\n  };\r\n\r\n\r\n  useEffect(() => {\r\n    // ‚úÖ Only poll if WebSocket is NOT available\r\n    if (!api_ws && refresh_sec && refresh_sec > 0) {\r\n      log(\"üì° Starting polling (no WebSocket available)\");\r\n      const interval = setInterval(fetchAndSetData, refresh_sec * 1000)\r\n      let timeout: NodeJS.Timeout\r\n      if (refresh_cutoff_sec > 0) {\r\n        timeout = setTimeout(() => {\r\n          clearInterval(interval)\r\n          log(\"‚èπÔ∏è Polling stopped (cutoff reached)\")\r\n        }, refresh_cutoff_sec * 1000)\r\n      }\r\n      return () => {\r\n        clearInterval(interval)\r\n        if (timeout) clearTimeout(timeout)\r\n      }\r\n    } else if (api_ws) {\r\n      log(\"üîå WebSocket active, polling disabled\");\r\n    }\r\n  }, [api_ws, refresh_sec, refresh_cutoff_sec, props, viewId])\r\n\r\n\r\n\r\n\r\n  const autoSizeAll = useCallback((skipHeader: boolean) => {\r\n    const allColumnIds: string[] = [];\r\n    const columnApi = gridRef.current!.columnApi;\r\n    const gridColumnDefs = grid_options?.columnDefs || [];\r\n    columnApi.getColumns()!.forEach((column: any) => {\r\n      const colDef = gridColumnDefs.find((def: any) => def.field === column.getColDef().field);\r\n      if (!colDef || colDef.initialWidth === undefined) {\r\n        allColumnIds.push(column.getId());\r\n      }\r\n    });\r\n    columnApi.autoSizeColumns(allColumnIds, skipHeader);\r\n  }, []);\r\n\r\n  const sizeToFit = useCallback(() => {\r\n    gridRef.current!.api.sizeColumnsToFit({\r\n      defaultMinWidth: 100,\r\n    })\r\n  }, [])\r\n\r\n\r\n  // Reusable function to calculate and update subtotals\r\n  const calculateAndUpdateSubtotals = useCallback((api: any) => {\r\n    if (!kwargs.subtotal_cols || kwargs.subtotal_cols.length === 0 || !api) return;\r\n\r\n    let filteredRows: any[] = [];\r\n    api.forEachNodeAfterFilterAndSort((node: any) => {\r\n      if (node.data && !node.rowPinned) filteredRows.push(node.data);\r\n    });\r\n\r\n    let subtotal: any = { [index]: \"Totals\" };\r\n\r\n    kwargs.subtotal_cols.forEach((col: string) => {\r\n      const sum = filteredRows.reduce((sum, row) => {\r\n        let val = row[col];\r\n        const originalVal = val\r\n\r\n        // Skip undefined, null, or empty string\r\n        if (val === undefined || val === null || val === \"\") {\r\n          return sum;\r\n        }\r\n\r\n        // Handle string values with special formatting\r\n        if (typeof val === \"string\") {\r\n          // ‚úÖ Detect button format: \"buy(4) $19,690\" or \"sell(3) $5,000\"\r\n          const buttonMatch = val.match(/(buy|sell)\\(\\d+\\)\\s*\\$([0-9,.\\-]+)/i);\r\n\r\n          if (buttonMatch && buttonMatch[2]) {\r\n            // Extract ONLY the dollar amount from button format\r\n            val = buttonMatch[2].replace(/,/g, \"\");\r\n          } else {\r\n            // Standard currency/number formatting\r\n            val = val.replace(/[$,]/g, \"\");\r\n\r\n            // Handle percentage values\r\n            if (val.includes(\"%\")) {\r\n              val = val.replace(/%/g, \"\");\r\n            }\r\n\r\n            // Remove any other non-numeric characters except decimal point and minus\r\n            val = val.replace(/[^0-9.\\-]/g, \"\");\r\n          }\r\n        }\r\n\r\n        const num = Number(val);\r\n        return sum + (isNaN(num) ? 0 : num);\r\n      }, 0);\r\n\r\n      // Check if invalid\r\n      if (isNaN(sum) || !isFinite(sum)) {\r\n        subtotal[col] = \"\";\r\n        return;\r\n      }\r\n\r\n      // ‚úÖ Check if column has a valueFormatter - if yes, store raw number, otherwise format\r\n      const columnDef = api.getColumnDef(col);\r\n      const hasFormatter = columnDef && (columnDef.valueFormatter || columnDef.type);\r\n\r\n      if (hasFormatter) {\r\n        // Store raw number - let column's valueFormatter handle formatting\r\n        subtotal[col] = sum;\r\n      } else {\r\n        // No formatter - format with commas ourselves\r\n        subtotal[col] = sum.toLocaleString('en-US');\r\n      }\r\n    });\r\n\r\n    // ‚úÖ Determine pin location from grid_options\r\n    const hasPinnedTop = grid_options.pinnedTopRowData && grid_options.pinnedTopRowData.length > 0;\r\n    const hasPinnedBottom = grid_options.pinnedBottomRowData && grid_options.pinnedBottomRowData.length > 0;\r\n\r\n    // Update the pinned row at the correct location\r\n    if (hasPinnedTop) {\r\n      api.setPinnedTopRowData([subtotal]);\r\n    } else if (hasPinnedBottom) {\r\n      api.setPinnedBottomRowData([subtotal]);\r\n    } else {\r\n      // Default to bottom if not specified\r\n      api.setPinnedBottomRowData([subtotal]);\r\n    }\r\n  }, [kwargs.subtotal_cols, index, grid_options]);\r\n\r\n  const onGridReady = useCallback(async (params: GridReadyEvent) => {\r\n    setTimeout(async () => {\r\n      try {\r\n        log(\"websocket api is\", api_ws, kwargs.api_ws);\r\n        const array = await fetchData();\r\n        if (array === false) return;\r\n\r\n        setRowData(array);\r\n        g_rowdata = array;\r\n\r\n        // ‚úÖ Calculate subtotals if subtotal_cols is provided\r\n        if (kwargs.subtotal_cols && kwargs.subtotal_cols.length > 0) {\r\n          calculateAndUpdateSubtotals(params.api);\r\n        }\r\n\r\n        // Autosize all columns after data is set\r\n        autoSizeAll(true);\r\n\r\n        // Store initial column state\r\n        if (params.columnApi) {\r\n          setInitialColumnState(params.columnApi.getColumnState());\r\n        }\r\n\r\n      } catch (error: any) {\r\n        toastr.error(`Error: ${error.message}`)\r\n      }\r\n    }, 100)\r\n  }, [])\r\n\r\n  const autoGroupColumnDef = useMemo<ColDef>(() => {\r\n    return {\r\n      minWidth: 200,\r\n    }\r\n  }, [])\r\n\r\n  const getRowId = useMemo<GetRowIdFunc>(() => {\r\n    return (params: GetRowIdParams) => {\r\n      // ‚úÖ Always return a string\r\n      return String(params.data[index]);\r\n    }\r\n  }, [index])\r\n\r\n  const sideBar = useMemo<\r\n    SideBarDef | string | string[] | boolean | null\r\n  >(() => {\r\n    return {\r\n      toolPanels: [\r\n        {\r\n          id: \"columns\",\r\n          labelDefault: \"Columns\",\r\n          labelKey: \"columns\",\r\n          iconKey: \"columns\",\r\n          toolPanel: \"agColumnsToolPanel\",\r\n        },\r\n        {\r\n          id: \"filters\",\r\n          labelDefault: \"Filters\",\r\n          labelKey: \"filters\",\r\n          iconKey: \"filter\",\r\n          toolPanel: \"agFiltersToolPanel\",\r\n        },\r\n      ],\r\n      defaultToolPanel: \"customStats\",\r\n    }\r\n  }, [])\r\n\r\n  const onCellValueChanged = useCallback(\r\n    async (event: any) => {\r\n      if (props.autoUpdate) {\r\n        try {\r\n          const updatedRow = event.data; // The updated row data\r\n          log(\"Auto-updating row:\", updatedRow);\r\n\r\n          // Send the updated row to the API\r\n          const response = await axios.post(api_update, {\r\n            username: username,\r\n            prod: prod,\r\n            updated_row: updatedRow, // Send the updated row\r\n            ...kwargs, // Include any additional parameters\r\n          });\r\n\r\n          if (response.status === 200) {\r\n            toastr.success(\"Row updated successfully!\");\r\n          } else {\r\n            toastr.error(\"Failed to update row.\");\r\n          }\r\n        } catch (error) {\r\n          if (error && typeof error === \"object\" && \"message\" in error) {\r\n            toastr.error(`Error updating row: ${(error as any).message}`);\r\n          } else {\r\n            toastr.error(`Error updating row: ${String(error)}`);\r\n          }\r\n        }\r\n      } else {\r\n        // Store changes for manual update\r\n        if (g_newRowData === null) g_newRowData = {};\r\n        g_newRowData[event.data[index]] = event.data;\r\n        log(\"Data after change is\", g_newRowData);\r\n      }\r\n    },\r\n    [props.autoUpdate, api_update, username, prod, kwargs, index]\r\n  );\r\n\r\n\r\n  const [loading, setLoading] = useState(false);\r\n  const subtotalTimeout = useRef<NodeJS.Timeout | null>(null);\r\n\r\n  const onRefresh = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const success = await fetchAndSetData();\r\n\r\n      refresh_success && success && toastr.success(\"Refresh success!\");\r\n    } catch (error: any) {\r\n      toastr.error(`Refresh Failed! ${error.message}`);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const onUpdate = async () => {\r\n    if (g_newRowData === null) {\r\n      toastr.warning(`No changes to update`)\r\n      return\r\n    }\r\n    try {\r\n      const res: any = await axios.post(api_update, {\r\n        username: username,\r\n        prod: prod,\r\n        new_data: g_newRowData,\r\n        ...kwargs,\r\n      })\r\n      g_newRowData = null\r\n      if (res.status) toastr.success(`Successfully Updated! `)\r\n      else toastr.error(`Failed! ${res.message}`)\r\n    } catch (error) {\r\n      toastr.error(`Failed! ${error}`)\r\n    }\r\n  }\r\n\r\n  const columnTypes = useMemo<any>(() => {\r\n    return {\r\n      dateColumnFilter: {\r\n        filter: \"agDateColumnFilter\",\r\n        filterParams: {\r\n          comparator: (filterValue: any, cellValue: string) =>\r\n            compareAsc(new Date(cellValue), filterValue),\r\n        },\r\n      },\r\n      numberColumnFilter: {\r\n        filter: \"agNumberColumnFilter\",\r\n      },\r\n      shortDateTimeFormat: {\r\n        valueFormatter: (params: any) =>\r\n          dateFormatter(params.value, \"dd/MM/yyyy HH:mm\"),\r\n      },\r\n      customDateTimeFormat: {\r\n        valueFormatter: (params: any) =>\r\n          dateFormatter(\r\n            params.value,\r\n            params.column.colDef.custom_format_string\r\n          ),\r\n      },\r\n      customNumericFormat: {\r\n        valueFormatter: (params: any) =>\r\n          numberFormatter(params.value, params.column.colDef.precision ?? 2),\r\n      },\r\n      customCurrencyFormat: {\r\n        valueFormatter: (params: any) =>\r\n          currencyFormatter(\r\n            params.value,\r\n            params.column.colDef.custom_currency_symbol\r\n          ),\r\n      },\r\n      timedeltaFormat: {\r\n        valueFormatter: (params: any) => duration(params.value).humanize(true),\r\n      },\r\n      customNumberFormat: {\r\n        valueFormatter: (params: any) =>\r\n          Number(params.value).toLocaleString(\"en-US\", {\r\n            minimumFractionDigits: 0,\r\n          }),\r\n      },\r\n      customHyperlinkRenderer: {\r\n        // valueGetter: (params: any) =>\r\n        //   params.column.colDef.baseURL + params.data.honey,\r\n        cellRenderer: HyperlinkRenderer,\r\n        cellRendererParams: {\r\n          baseURL: \"URLSearchParams.co\",\r\n        },\r\n      },\r\n    }\r\n  }, [])\r\n\r\n  const onClick = () => {\r\n    toastr.clear()\r\n    setTimeout(() => toastr.success(`Settings updated `), 300)\r\n  }\r\n\r\n  type RowStyle = {\r\n    background?: string;\r\n    color?: string;\r\n    fontWeight?: string;\r\n  };\r\n\r\n  function parseJsCodeFromPython(v: string) {\r\n    const JS_PLACEHOLDER = \"::JSCODE::\"\r\n    let funcReg = new RegExp(\r\n      `${JS_PLACEHOLDER}\\\\s*((function|class)\\\\s*.*)\\\\s*${JS_PLACEHOLDER}`\r\n    )\r\n\r\n    let match = funcReg.exec(v)\r\n\r\n    if (match) {\r\n\r\n      const funcStr = match[1]\r\n      // eslint-disable-next-line\r\n      return new Function(\"return \" + funcStr)()\r\n    } else {\r\n      return v\r\n    }\r\n  }\r\n\r\n  const getRowStyle = (params: RowClassParams<any>): RowStyle | undefined => {\r\n\r\n    try {\r\n      const background = params.data[\"color_row\"] ?? undefined;\r\n      const color = params.data[\"color_row_text\"] ?? undefined;\r\n      return { background, color };\r\n    } catch (error) {\r\n      console.error(\"Error accessing row style:\", error);\r\n      return undefined; // Return undefined when an error occurs\r\n    }\r\n  };\r\n\r\n\r\n  const getButtonStyle = (length: number) => {\r\n    if (length < 3) {\r\n      return { padding: \"15px 18px\", fontSize: \"18px\" };\r\n    } else if (length < 8) {\r\n      return { padding: \"15px 18px\", fontSize: \"15px\" };\r\n    } else if (length < 15) {\r\n      return { padding: \"12px 13px\", fontSize: \"13px\" };\r\n    } else if (length < 35) {\r\n      return { padding: \"10px 12px\", fontSize: \"11px\" };\r\n    } else {\r\n      return { padding: \"3px 5px\", fontSize: \"10px\" };\r\n    }\r\n  };\r\n\r\n  const buttonStyle = getButtonStyle(toggle_views.length);\r\n\r\n  const button_color = \"#3498db\"; // Set your custom button color here\r\n\r\n  const getUniqueColumnValues = (column: string, rowData: any[]) => {\r\n    return Array.from(new Set(rowData.map(row => row[column]))).filter(\r\n      v => v !== undefined && v !== null\r\n    );\r\n  };\r\n  // let filter_button = \"piece_name\";\r\n\r\n  const uniqueValues = useMemo(\r\n    () => getUniqueColumnValues(filter_button, rowData),\r\n    [rowData, filter_button]\r\n  );\r\n\r\n  const handleButtonFilter = (value: string | null) => {\r\n    setActiveFilter(value);\r\n\r\n    if (gridRef.current && gridRef.current.api) {\r\n      const api = gridRef.current.api;\r\n      if (value) {\r\n        api.setFilterModel({\r\n          ...api.getFilterModel(),\r\n          [filter_button]: { filterType: \"set\", values: [value] }\r\n        });\r\n      } else {\r\n        const model = api.getFilterModel();\r\n        delete model[filter_button];\r\n        api.setFilterModel(model);\r\n      }\r\n    }\r\n  };\r\n\r\n\r\n\r\n\r\n\r\n\r\n  return (\r\n    <>\r\n\r\n      {kwargs.show_cell_content && selectedCellContent && (\r\n        <div\r\n          style={{\r\n            position: \"absolute\",\r\n            top: \"10px\",\r\n            right: \"10px\",\r\n            background: \"white\",\r\n            border: \"1px solid #ddd\",\r\n            borderRadius: \"8px\",\r\n            padding: \"10px\",\r\n            boxShadow: \"0 2px 6px rgba(0, 0, 0, 0.1)\",\r\n            zIndex: 1000,\r\n            maxWidth: \"300px\", // Limit the width\r\n            maxHeight: \"200px\", // Limit the height\r\n            overflow: \"auto\", // Add scrollbars for overflow\r\n            width: \"fit-content\",\r\n          }}\r\n        >\r\n          <p style={{ whiteSpace: \"pre-wrap\", wordBreak: \"break-word\" }}>\r\n            {selectedCellContent}\r\n          </p>\r\n          <button\r\n            onClick={() => setSelectedCellContent(null)}\r\n            style={{\r\n              background: \"#3498db\",\r\n              color: \"white\",\r\n              border: \"none\",\r\n              borderRadius: \"2px\",\r\n              padding: \"3px 5px\",\r\n              cursor: \"pointer\",\r\n            }}\r\n          >\r\n            <h5 style={{ fontSize: \"8px\", margin: \"0 0 6px 0\" }}>x</h5>\r\n          </button>\r\n        </div>\r\n      )}\r\n\r\n      {toggle_views && toggle_views.length > 0 && (\r\n        <>\r\n          <div\r\n            style={{\r\n              fontWeight: \"bold\",\r\n              color: \"#055A6E\",\r\n              marginBottom: \"4px\",\r\n              fontSize: \"15px\",\r\n            }}\r\n          >\r\n            {kwargs.toggle_header ? kwargs.toggle_header : \"\"}\r\n          </div>\r\n          {toggle_views.length < 20 ? (\r\n            // Render normal buttons if toggle_views is less than 20\r\n            <div\r\n              style={{\r\n                display: \"flex\",\r\n                flexWrap: \"wrap\",\r\n                gap: \"10px\",\r\n                padding: \"10px\",\r\n                marginBottom: \"10px\",\r\n              }}\r\n            >\r\n              {toggle_views.map((view: string, index: number) => (\r\n                <button\r\n                  key={index}\r\n                  className={`btn ${viewId === index ? \"btn-danger\" : \"btn-secondary\"}`}\r\n                  style={{\r\n                    ...buttonStyle,\r\n                    borderRadius: \"8px\",\r\n                    color: \"#055A6E\",\r\n                    backgroundColor: \"#F3FAFD\",\r\n                    fontWeight: \"bold\",\r\n                  }}\r\n                  onClick={() => {\r\n                    setViewId(index);\r\n                    setpreviousViewId(viewId);\r\n                  }}\r\n                  disabled={loading}\r\n                >\r\n                  {view}\r\n                  {loading && viewId === index ? (\r\n                    <div\r\n                      style={{\r\n                        width: \"14px\",\r\n                        height: \"14px\",\r\n                        border: \"2px solid black\",\r\n                        borderTop: \"2px solid transparent\",\r\n                        borderRadius: \"50%\",\r\n                        animation: \"spin 0.8s linear infinite\",\r\n                        marginLeft: \"8px\",\r\n                      }}\r\n                    />\r\n                  ) : null}\r\n                </button>\r\n              ))}\r\n            </div>\r\n          ) : (\r\n            // Render overlap container if toggle_views is 20 or more\r\n            <div\r\n              className=\"toggle-view-container\"\r\n              style={{\r\n                display: \"grid\",\r\n                gridTemplateColumns: \"repeat(auto-fit, minmax(100px, 1fr))\",\r\n                gap: \"10px\",\r\n                overflowY: \"auto\",\r\n                maxHeight: \"200px\",\r\n                padding: \"10px\",\r\n                border: \"1px solid #ddd\",\r\n                borderRadius: \"8px\",\r\n                backgroundColor: \"#eef9f8\",\r\n                width: \"100%\",\r\n                marginBottom: \"10px\",\r\n              }}\r\n            >\r\n              {toggle_views.map((view: string, index: number) => (\r\n                <button\r\n                  key={index}\r\n                  className={`btn ${viewId === index ? \"btn-danger\" : \"btn-secondary\"}`}\r\n                  style={{\r\n                    ...buttonStyle,\r\n                    borderRadius: \"8px\",\r\n                    color: \"#055A6E\",\r\n                    backgroundColor: \"#F3FAFD\",\r\n                    fontWeight: \"bold\",\r\n                  }}\r\n                  onClick={() => {\r\n                    setViewId(index);\r\n                    setpreviousViewId(viewId);\r\n                  }}\r\n                  disabled={loading}\r\n                >\r\n                  {view}\r\n                  {loading && viewId === index ? (\r\n                    <div\r\n                      style={{\r\n                        width: \"14px\",\r\n                        height: \"14px\",\r\n                        border: \"2px solid black\",\r\n                        borderTop: \"2px solid transparent\",\r\n                        borderRadius: \"50%\",\r\n                        animation: \"spin 0.8s linear infinite\",\r\n                        marginLeft: \"8px\",\r\n                      }}\r\n                    />\r\n                  ) : null}\r\n                </button>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </>\r\n      )}\r\n\r\n      <MyModal\r\n        isOpen={modalShow}\r\n        closeModal={() => setModalshow(false)}\r\n        modalData={{\r\n          ...modalData,\r\n          index: index,        // ‚úÖ Pass index\r\n          gridRef: gridRef     // ‚úÖ Pass grid reference\r\n        }}\r\n        promptText={promptText}\r\n        setPromptText={setPromptText}\r\n        toastr={toastr}\r\n      />\r\n      <div\r\n        style={{ flexDirection: \"row\", height: \"100%\", width: \"100%\" }}\r\n        id=\"myGrid\"\r\n      >\r\n\r\n\r\n        <div className=\"d-flex justify-content-between align-items-center\">\r\n          {!kwargs['api_ws'] && (refresh_sec == undefined || refresh_sec == 0) && (\r\n            <div style={{ display: \"flex\" }}>\r\n              <div style={{ margin: \"5px 5px 5px 2px\" }}>\r\n                <button\r\n                  className=\"btn\"\r\n                  style={{\r\n                    backgroundColor: button_color,\r\n                    color: \"white\",\r\n                    padding: \"2px 5px\", // Smaller padding\r\n                    // fontSize: \"12px\", // Smaller font size\r\n                    borderRadius: \"4px\",\r\n                    display: \"flex\",\r\n                    alignItems: \"center\",\r\n                    justifyContent: \"center\",\r\n                    minWidth: \"50px\", // Ensure width stays the same during loading\r\n                  }}\r\n                  onClick={onRefresh}\r\n                  title=\"Refresh\"\r\n                  disabled={loading} // Disable button while loading\r\n                >\r\n                  {loading ? (\r\n                    <div\r\n                      style={{\r\n                        width: \"12px\",\r\n                        height: \"12px\",\r\n                        border: \"2px solid white\",\r\n                        borderTop: \"2px solid transparent\",\r\n                        borderRadius: \"50%\",\r\n                        animation: \"spin 0.8s linear infinite\",\r\n                      }}\r\n                    />\r\n                  ) : (\r\n                    <span style={{ fontSize: \"25px\", lineHeight: \"1\" }}>‚ü≥</span>\r\n                  )}\r\n                </button>\r\n\r\n                {/* Add CSS for spinner animation */}\r\n                <style>\r\n                  {`\r\n                    @keyframes spin {\r\n                      to {\r\n                        transform: rotate(360deg);\r\n                      }\r\n                    }\r\n                  `}\r\n                </style>\r\n              </div>\r\n              {!props.autoUpdate && (\r\n                <div style={{ margin: \"5px 5px 5px 2px\" }}>\r\n                  <button\r\n                    className=\"btn\"\r\n                    style={{\r\n                      backgroundColor: \"green\",\r\n                      color: \"white\",\r\n                      padding: \"5px 8px\",\r\n                      fontSize: \"12px\",\r\n                      borderRadius: \"4px\",\r\n                      display: \"flex\",\r\n                      alignItems: \"center\",\r\n                      gap: \"6px\",\r\n                    }}\r\n                    onClick={onUpdate}\r\n                    title=\"Update\"\r\n                  >\r\n                    <span style={{ fontSize: \"18px\", lineHeight: \"1\" }}>‚Üë</span>\r\n                  </button>\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n        </div>\r\n\r\n        <div\r\n          className={grid_options.theme || \"ag-theme-alpine-dark\"}\r\n          style={{\r\n            width: \"100%\",\r\n            height: kwargs[\"grid_height\"] ? kwargs[\"grid_height\"] : \"100%\",\r\n          }}\r\n        >\r\n\r\n          {kwargs.column_sets && (\r\n\r\n            <div style={{ marginBottom: 12, display: \"flex\", gap: \"8px\", alignItems: \"center\", flexWrap: \"wrap\" }}>\r\n\r\n              <button\r\n                onClick={() => {\r\n                  setSelectedColumnSetKeys([]);\r\n                  setTimeout(() => {\r\n                    const columnApi = gridRef.current?.columnApi;\r\n                    if (columnApi && initialColumnState) {\r\n                      columnApi.applyColumnState({\r\n                        state: initialColumnState,\r\n                        applyOrder: true,\r\n                      });\r\n                    }\r\n                  }, 0);\r\n                }}\r\n                style={{\r\n                  background: \"rgb(194, 194, 194)\",\r\n                  color: \"white\",\r\n                  border: \"1.5px solid rgb(213, 213, 213)\",\r\n                  borderRadius: \"6px\",\r\n                  fontWeight: \"bold\",\r\n                  fontSize: \"12px\",\r\n                  padding: \"5px 10px\",\r\n                  margin: \"0 4px 4px 0\",\r\n                  boxShadow: \"0 2px 6px rgb(216, 216, 216)\",\r\n                  transition: \"all 0.15s\",\r\n                  cursor: \"pointer\",\r\n                }}\r\n              >\r\n                Reset Columns\r\n              </button>\r\n\r\n\r\n              {Object.keys(kwargs.column_sets).map(key => (\r\n\r\n\r\n                <button\r\n                  key={key}\r\n                  onClick={() => {\r\n                    setSelectedColumnSetKeys(prev =>\r\n                      prev.includes(key)\r\n                        ? prev.filter(k => k !== key)\r\n                        : [...prev, key]\r\n                    );\r\n                    setTimeout(() => {\r\n                      const keys = selectedColumnSetKeys.includes(key)\r\n                        ? selectedColumnSetKeys.filter(k => k !== key)\r\n                        : [...selectedColumnSetKeys, key];\r\n                      const columnsToShow = Array.from(\r\n                        new Set(keys.flatMap(k => kwargs.column_sets[k]))\r\n                      );\r\n                      const columnApi = gridRef.current?.columnApi;\r\n                      if (columnApi && Array.isArray(grid_options.columnDefs)) {\r\n                        grid_options.columnDefs.forEach((col: any) => {\r\n                          columnApi.setColumnVisible(\r\n                            col.field,\r\n                            columnsToShow.includes(col.field)\r\n                          );\r\n                        });\r\n                        columnsToShow.forEach((field, idx) => {\r\n                          columnApi.moveColumn(field, idx);\r\n                        });\r\n                      }\r\n                    }, 0);\r\n                  }}\r\n                  style={{\r\n                    background: selectedColumnSetKeys.includes(key) ? \"#3498db\" : \"#F3FAFD\",\r\n                    color: selectedColumnSetKeys.includes(key) ? \"white\" : \"#055A6E\",\r\n                    border: selectedColumnSetKeys.includes(key) ? \"2px solid #1abc9c\" : \"1px solid #ddd\",\r\n                    borderRadius: \"6px\",\r\n                    fontWeight: \"bold\",\r\n                    fontSize: \"12px\",\r\n                    padding: \"5px 10px\",\r\n                    margin: \"0 4px 4px 0\",\r\n                    boxShadow: selectedColumnSetKeys.includes(key) ? \"0 2px 6px rgba(52,152,219,0.10)\" : \"none\",\r\n                    transition: \"all 0.15s\",\r\n                    cursor: \"pointer\",\r\n                  }}\r\n                >\r\n                  {key}\r\n                </button>\r\n              ))}\r\n\r\n            </div>\r\n          )}\r\n          {/* Streamer for streaming_list_text if present */}\r\n          {kwargs.streaming_list_text && Array.isArray(kwargs.streaming_list_text) && (\r\n            <div\r\n              style={{\r\n                width: \"100%\",\r\n                background: \"#F3FAFD\", // Match toggle_views button background\r\n                color: \"#055A6E\",      // Match toggle_views button text color\r\n                padding: \"4px 10px\",\r\n                fontSize: \"13px\",\r\n                borderBottom: \"1px solid #ddd\",\r\n                whiteSpace: \"nowrap\",\r\n                overflow: \"hidden\",\r\n                textOverflow: \"ellipsis\",\r\n                marginBottom: \"4px\",\r\n                fontWeight: \"bold\",    // Match bold style from buttons\r\n              }}\r\n            >\r\n              <div\r\n                style={{\r\n                  display: \"block\",\r\n                  width: \"100%\",\r\n                  whiteSpace: \"nowrap\",\r\n                  overflow: \"hidden\",\r\n                  position: \"relative\",\r\n                }}\r\n              >\r\n                <div\r\n                  style={{\r\n                    display: \"inline-block\",\r\n                    paddingLeft: \"100%\",\r\n                    animation: \"scroll-left 40s linear infinite\",\r\n                  }}\r\n                >\r\n                  {kwargs.streaming_list_text.join(\"   |   \")}\r\n                </div>\r\n                <style>\r\n                  {`\r\n                @keyframes scroll-left {\r\n                  0% {\r\n                  transform: translateX(0%);\r\n                  }\r\n                  100% {\r\n                  transform: translateX(-100%);\r\n                  }\r\n                }\r\n                `}\r\n                </style>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {kwargs['filter_button'] && kwargs['filter_button'] !== '' && (\r\n            <div style={{ marginBottom: 8 }}>\r\n\r\n\r\n              {kwargs['show_clear_all_filters'] && (\r\n                <button\r\n                  onClick={() => {\r\n                    if (gridRef.current && gridRef.current.api) {\r\n                      gridRef.current.api.setFilterModel({});\r\n                    }\r\n                    setActiveFilter(null);\r\n                  }}\r\n                  style={{\r\n                    background: \"rgb(194, 194, 194)\",\r\n                    color: \"white\",\r\n                    border: \"1.5px solid rgb(213, 213, 213)\",\r\n                    borderRadius: \"6px\",\r\n                    fontWeight: \"bold\",\r\n                    fontSize: \"12px\",\r\n                    padding: \"5px 10px\",\r\n                    margin: \"0 4px 4px 0\",\r\n                    boxShadow: \"0 2px 6px rgb(216, 216, 216)\",\r\n                    transition: \"all 0.15s\",\r\n                    cursor: \"pointer\",\r\n                  }}\r\n                >\r\n                  Clear Filters\r\n                </button>\r\n              )}\r\n\r\n\r\n              {uniqueValues.map(val => (\r\n                <button\r\n                  key={val}\r\n                  onClick={() => handleButtonFilter(val)}\r\n                  style={{\r\n                    background: activeFilter === val ? \"#3498db\" : \"#F3FAFD\", // match main button color and toggle_views bg\r\n                    color: activeFilter === val ? \"white\" : \"#055A6E\",        // match toggle_views text color\r\n                    border: activeFilter === val ? \"2px solid #1abc9c\" : \"1px solid #ddd\",\r\n                    borderRadius: \"6px\",\r\n                    fontWeight: \"bold\",\r\n                    fontSize: \"12px\",\r\n                    padding: \"5px 10px\",\r\n                    margin: \"0 4px 4px 0\",\r\n                    boxShadow: activeFilter === val ? \"0 2px 6px rgba(52,152,219,0.10)\" : \"none\",\r\n                    transition: \"all 0.15s\",\r\n                    cursor: \"pointer\",\r\n                  }}\r\n                >\r\n                  {val}\r\n                </button>\r\n              ))}\r\n\r\n            </div>\r\n          )}\r\n\r\n\r\n          <AgGridReact\r\n            ref={gridRef}\r\n            rowData={rowData}\r\n            getRowStyle={getRowStyle}\r\n            headerHeight={30}\r\n            rowHeight={30}\r\n            onGridReady={onGridReady}\r\n            autoGroupColumnDef={autoGroupColumnDef}\r\n            animateRows={true}\r\n            suppressAggFuncInHeader={true}\r\n            getRowId={getRowId}\r\n            gridOptions={getGridOptions()}\r\n            onCellValueChanged={onCellValueChanged}\r\n            columnTypes={columnTypes}\r\n            sideBar={grid_options.sideBar === false ? false : sideBar}\r\n            onCellClicked={onCellClicked} // Attach the handler here\r\n          />\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n\r\nexport default AgGrid\r\n","import React, { useEffect, useState } from 'react'\nimport {\n  ComponentProps,\n  Streamlit,\n  withStreamlitConnection,\n} from 'streamlit-component-lib'\nimport 'ag-grid-community/styles/ag-grid.css'\n// import 'ag-grid-community/styles/ag-theme-alpine.css';\nimport 'ag-grid-community/styles/ag-theme-balham.css'\nimport Aggrid from './Aggrid'\n\nconst Main = (props: ComponentProps) => {\n  const {\n    username,\n    api,\n    api_update,\n    refresh_sec,\n    refresh_cutoff_sec,\n    gridoption_build,\n    enable_JsCode,\n    prod,\n    autoUpdate = false,\n  } = props.args\n  const { grid_options, kwargs = {} } = props.args\n  const { index, theme } = grid_options\n  // console.log('GridOptions', grid_options)\n  return (\n    <div>\n      <Aggrid\n        username={username}\n        api={api}\n        api_update={api_update}\n        refresh_sec={refresh_sec}\n        refresh_cutoff_sec={refresh_cutoff_sec}\n        gridoption_build={gridoption_build}\n        prod={prod}\n        grid_options={grid_options}\n        index={index}\n        kwargs={kwargs} \n        enable_JsCode={enable_JsCode}      \n        autoUpdate={autoUpdate}\n      />\n    </div>\n  )\n}\n\nexport default withStreamlitConnection(Main)\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport Main from \"./Main\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <Main />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);"],"sourceRoot":""}