(this.webpackJsonpstreamlit_custom_slider=this.webpackJsonpstreamlit_custom_slider||[]).push([[0],{100:function(e,t,a){},133:function(e,t,a){},134:function(e,t,a){"use strict";a.r(t);var r=a(1),o=a.n(r),n=a(13),l=a.n(n),i=a(23),s=(a(32),a(33),a(49)),d=a(5),c=a.n(d),p=(a(88),a(89),a(90),a(31)),u=a.n(p),m=(a(100),a(136)),f=a(18),g=a(16),b=a.n(g);const y=["YYYY-MM-DDTHH:mm","MM/DD/YYYYTHH:mm","MM/DD/YYYY HH:mm","YYYY-MM-DD HH:mm"],x=["buying_power","borrow_power"],v=["Day","Week","Month","Quarter","Quarters","Year"],h=v.map(e=>e+" Margin");u.a.setAppElement("#root");let w=!1;var _=e=>{let{isOpen:t,closeModal:a,modalData:n,promptText:l,setPromptText:i,toastr:s}=e;const[d,c]=o.a.useState(!1),{prompt_field:p,prompt_order_rules:g,selectedRow:_,selectedField:E,add_symbol_row_info:k,display_grid_column:S}=n,[C,R]=o.a.useState(!1),[N,O]=o.a.useState(!1),[F,A]=o.a.useState(!1),[D,W]=o.a.useState(!0),[j,z]=o.a.useState(!0),[T,M]=o.a.useState({}),[P,I]=o.a.useState({}),H=n.editableCols||[],B=_&&S&&Array.isArray(_[S])?_[S]:[],L=B.length>0?Object.keys(B[0]):[],Y=H.map(e=>e.col_header),U=Array.from(new Set([...Y,...L])),q=Object(r.useRef)(null);Object(r.useRef)(null);Object(r.useEffect)(()=>{t&&setTimeout(()=>{var e;return null===(e=q.current)||void 0===e?void 0:e.focus()},100)},[t]),Object(r.useEffect)(()=>{M({})},[t,_]),Object(r.useEffect)(()=>{var e,a;if(!t)return void I({});console.log("\ud83d\udd04 Modal opening - fetching fresh data from grid");const r=n.gridRef,o=n.index,l=n.selectedRow,i=null===l||void 0===l?void 0:l[o];var s;if(!(null===r||void 0===r||null===(e=r.current)||void 0===e?void 0:e.api)||!i)return void console.warn("\u26a0\ufe0f  Missing gridRef or selectedRowId",{hasGridRef:!!(null===r||void 0===r||null===(s=r.current)||void 0===s?void 0:s.api),hasIndex:!!o,hasSelectedRow:!!l,selectedRowId:i});const d=r.current.api.getRowNode(i);if(!d||!d.data)return void console.warn("\u26a0\ufe0f  Row not found in grid:",i);const c=d.data[S];if(!Array.isArray(c)||!H)return console.warn("\u26a0\ufe0f  Invalid orders data",{hasOrders:!!c,isArray:Array.isArray(c),hasEditableCols:!!H,displayColumn:S}),void I({});console.log("\u2705 Building editableValues from FRESH grid data:",{rowId:i,orderCount:c.length,firstOrderTakeProfit:null===(a=c[0])||void 0===a?void 0:a.take_profit,allOrders:c});const p={};H.forEach(e=>{let{col_header:t}=e;p[t]={},c.forEach((e,a)=>{var r;p[t][a]=null!==(r=e[t])&&void 0!==r?r:""})}),console.log("\u2705 Setting editableValues:",p),I(p)},[t]);const G=e=>y.some(t=>b()(e,t,!0).isValid()),J=e=>{const t=b()(e,y,!0).toDate(),a=Intl.DateTimeFormat().resolvedOptions().timeZone,r=Object(f.b)(t,a);return Object(f.a)(r,"yyyy-MM-dd'T'HH:mm")},$=[],V=[],K=[],X=[];Array.isArray(g)&&l&&g.filter(e=>e&&e in l);if(g)for(const r of g){const e=l[r];Array.isArray(e)?X.push(r):"boolean"===typeof e?V.push(r):G(e)?K.push(r):$.push(r)}return o.a.createElement(u.a,{isOpen:t,onRequestClose:a,ariaHideApp:!1},o.a.createElement("div",{className:"my-modal-content"},o.a.createElement("div",{className:"modal-header px-3 d-flex justify-content-center align-items-center",style:{position:"relative"}},o.a.createElement("h4",{className:"text-center m-0"},n.prompt_message),o.a.createElement("span",{className:"close",onClick:a,style:{position:"absolute",right:"20px"}},"\xd7")),o.a.createElement("div",{className:"modal-body p-3"},o.a.createElement("div",{className:"d-flex flex-column"},V.length>0&&o.a.createElement("div",{className:"d-flex flex-row justify-content-between mb-2",style:{border:"1px solid #e0e0e0",borderRadius:"8px",padding:"8px",background:"#fafcff"}},V.map((e,t)=>o.a.createElement("div",{className:"d-flex flex-column align-items-center",key:t,style:{marginRight:"8px"}},o.a.createElement("label",{className:"mb-0",style:{minWidth:"100px",textAlign:"center",fontSize:"0.9rem"}},e,":"),o.a.createElement("input",{type:"checkbox",checked:l[e],onChange:t=>i({...l,[e]:t.target.checked}),style:{width:"16px",height:"16px",marginTop:"4px"}})))),k&&Array.isArray(k)&&o.a.createElement("div",{className:"d-flex flex-wrap",style:{flex:1,border:"1px solid #e0e0e0",borderRadius:"8px",padding:"8px",background:"#fafcff",marginBottom:"8px"}},k.map((e,t)=>_&&void 0!==_[e]&&o.a.createElement("div",{key:e,style:{flex:"1 1 30%",minWidth:"120px",marginBottom:"8px",paddingRight:"12px"}},o.a.createElement("b",null,e,": "),"number"===typeof _[e]?Number(_[e]).toLocaleString(void 0,{maximumFractionDigits:2}):String(_[e])))),o.a.createElement("div",{className:"d-flex flex-wrap",style:{gap:"16px",marginBottom:"16px"}},$.length>0&&$.map((e,t)=>{if(v.includes(e)||h.includes(e))return null;const a=x.includes(e);return o.a.createElement("div",{key:t,className:"d-flex flex-column",style:{flex:"1 1 calc(50% - 16px)",minWidth:"150px"}},o.a.createElement("label",{className:"mb-1",style:{fontSize:"0.85rem",fontWeight:"bold",textTransform:"capitalize"}},e.replace(/_/g," "),":","sell_amount"===e&&o.a.createElement("span",{style:{marginLeft:"4px",cursor:"pointer"},title:"This amount will override sell_qty"},"\u2753")),a?o.a.createElement(o.a.Fragment,null,o.a.createElement("input",{type:"range",min:"0",max:"1",step:".01",value:l[e]||0,onChange:t=>i({...l,[e]:Number(t.target.value)}),style:{width:"100%"}}),o.a.createElement("span",{style:{fontSize:"0.85rem",fontWeight:"bold",marginTop:"4px"}},l[e]||0)):o.a.createElement("input",{type:"text",value:l[e],onChange:t=>i({...l,[e]:t.target.value}),style:{width:"100%",padding:"6px",fontSize:"0.85rem",border:"1px solid #ccc",borderRadius:"4px"}}))}),X.length>0&&X.map((e,t)=>o.a.createElement("div",{key:t,className:"d-flex flex-column",style:{flex:"1 1 calc(50% - 16px)",minWidth:"150px"}},o.a.createElement("label",{className:"mb-1",style:{fontSize:"0.85rem",fontWeight:"bold",textTransform:"capitalize"}},e.replace(/_/g," "),":"),o.a.createElement("select",{value:l[e][0],onChange:t=>i({...l,[e]:[t.target.value]}),style:{width:"100%",padding:"6px",fontSize:"0.85rem",border:"1px solid #ccc",borderRadius:"4px"}},l[e].map((e,t)=>o.a.createElement("option",{key:t,value:e},e))))),K.length>0&&K.map((e,t)=>o.a.createElement("div",{key:t,className:"d-flex flex-column",style:{flex:"1 1 calc(50% - 16px)",minWidth:"150px"}},o.a.createElement("label",{className:"mb-1",style:{fontSize:"0.85rem",fontWeight:"bold",textTransform:"capitalize"}},e.replace(/_/g," "),":"),o.a.createElement("input",{type:"datetime-local",value:l[e]&&J(l[e]),onChange:t=>i({...l,[e]:t.target.value}),style:{width:"100%",padding:"6px",fontSize:"0.85rem",border:"1px solid #ccc",borderRadius:"4px"}}))),v.some(e=>null===g||void 0===g?void 0:g.includes(e))&&o.a.createElement("div",{style:{flex:"1 1 100%",marginTop:"16px"}},o.a.createElement("div",{style:{cursor:"pointer",fontWeight:"bold",marginBottom:"4px"},onClick:()=>R(e=>!e)},C?"\u25bc":"\u25ba"," Advanced Allocation Options"),C&&o.a.createElement("div",{className:"d-flex flex-wrap",style:{gap:"16px"}},v.map((e,t)=>(null===g||void 0===g?void 0:g.includes(e))&&void 0!==l[e]&&o.a.createElement("div",{key:t,className:"d-flex flex-column",style:{flex:"1 1 calc(50% - 16px)",minWidth:"150px"}},o.a.createElement("label",{className:"mb-1",style:{fontSize:"0.85rem",fontWeight:"bold",textTransform:"capitalize"}},e.replace(/_/g," "),":"),o.a.createElement("input",{type:"range",min:"0",max:"1",step:".01",value:l[e]||0,onChange:t=>i({...l,[e]:Number(t.target.value)}),style:{width:"100%"}}),o.a.createElement("span",{style:{fontSize:"0.85rem",fontWeight:"bold",marginTop:"4px"}},l[e]||0))))),h.some(e=>null===g||void 0===g?void 0:g.includes(e))&&o.a.createElement("div",{style:{flex:"1 1 100%",marginTop:"16px"}},o.a.createElement("div",{style:{cursor:"pointer",fontWeight:"bold",marginBottom:"4px"},onClick:()=>O(e=>!e)},N?"\u25bc":"\u25ba"," Advanced Margin Allocation Options"),N&&o.a.createElement("div",{className:"d-flex flex-wrap",style:{gap:"16px"}},h.map((e,t)=>(null===g||void 0===g?void 0:g.includes(e))&&void 0!==l[e]&&o.a.createElement("div",{key:t,className:"d-flex flex-column",style:{flex:"1 1 calc(50% - 16px)",minWidth:"150px"}},o.a.createElement("label",{className:"mb-1",style:{fontSize:"0.85rem",fontWeight:"bold",textTransform:"capitalize"}},e.replace(/_/g," "),":"),o.a.createElement("input",{type:"range",min:"0",max:"1",step:".01",value:l[e]||0,onChange:t=>i({...l,[e]:Number(t.target.value)}),style:{width:"100%"}}),o.a.createElement("span",{style:{fontSize:"0.85rem",fontWeight:"bold",marginTop:"4px"}},l[e]||0)))))),S&&_&&Array.isArray(_[S])&&_[S].length>0&&o.a.createElement("div",{style:{margin:"16px 0"}},o.a.createElement("div",{style:{cursor:"pointer",fontWeight:"bold",marginBottom:"4px"},onClick:()=>z(e=>!e)},o.a.createElement("span",{style:{marginRight:"8px"}},j?"\u25bc":"\u25ba"),o.a.createElement("button",{type:"button",className:"btn btn-link p-0",style:{fontWeight:"bold",textDecoration:"underline",color:"#007bff",background:"none",border:"none",cursor:"pointer"},onClick:()=>z(e=>!e)},S)),j&&(()=>{const e=_[S],t=e=>{let t=0;for(let a=0;a<e;a++){const e=U[a],r=H.find(t=>t.col_header===e);if(null===r||void 0===r?void 0:r.pinned){t+=r.width||("datetime"===r.dtype?140:100)}}return t},a=(e,t,a)=>{const r=H.find(t=>t.col_header===e);if(!r)return"white";if(r.backgroundColor)return r.backgroundColor;if(r.conditionalColor){var o,n;const l=r.conditionalColor,i=null!==(o=null===(n=P[e])||void 0===n?void 0:n[t])&&void 0!==o?o:a[e],s=l.compare_to?a[l.compare_to]:l.value;if("in"===l.operator){return(Array.isArray(s)?s:[s]).includes(i)?l.trueColor:l.falseColor}if("!in"===l.operator){return(Array.isArray(s)?s:[s]).includes(i)?l.falseColor:l.trueColor}return"contains"===l.operator||"contains"===l.operator?String(i).toLowerCase().includes(String(s).toLowerCase())?l.trueColor:l.falseColor:"!contains"===l.operator?String(i).toLowerCase().includes(String(s).toLowerCase())?l.falseColor:l.trueColor:"startsWith"===l.operator?String(i).toLowerCase().startsWith(String(s).toLowerCase())?l.trueColor:l.falseColor:">="===l.operator&&i>=s||">"===l.operator&&i>s||"<"===l.operator&&i<s||"<="===l.operator&&i<=s||"=="===l.operator&&i==s?l.trueColor:l.falseColor}return"white"};return o.a.createElement("div",{style:{maxHeight:"400px",overflowY:"auto",overflowX:"auto",border:"1px solid #ddd"}},o.a.createElement("table",{className:"table table-bordered table-sm",style:{fontSize:"0.6rem"}},o.a.createElement("thead",null,o.a.createElement("tr",null,U.map((e,a)=>{const r=H.find(t=>t.col_header===e),n=(null===r||void 0===r?void 0:r.width)||("datetime"===(null===r||void 0===r?void 0:r.dtype)?140:100);return o.a.createElement("th",{key:e,style:{whiteSpace:"normal",wordWrap:"break-word",backgroundColor:(null===r||void 0===r?void 0:r.backgroundColor)||"#fafcff",color:"black",textAlign:"center",position:"sticky",top:0,left:(null===r||void 0===r?void 0:r.pinned)?t(a)+"px":"auto",zIndex:(null===r||void 0===r?void 0:r.pinned)?20:15,minWidth:n+"px"}},o.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"}},(null===r||void 0===r?void 0:r.display_name)||e.replace(/_/g," "),(null===r||void 0===r?void 0:r.info)&&o.a.createElement("span",{style:{marginLeft:"4px",cursor:"pointer",color:"#007bff",fontSize:"0.8rem"},title:r.info},"\u2753")))}))),o.a.createElement("tbody",null,e.map((r,n)=>o.a.createElement("tr",{key:n},U.map((s,d)=>{const c=H.find(e=>e.col_header===s),p=(null===c||void 0===c?void 0:c.width)||("datetime"===(null===c||void 0===c?void 0:c.dtype)?140:100);var u;if("sell_qty"===s)return o.a.createElement("td",{key:s,style:{backgroundColor:a(s,n,r),position:(null===c||void 0===c?void 0:c.pinned)?"sticky":"relative",left:(null===c||void 0===c?void 0:c.pinned)?t(d)+"px":"auto",zIndex:(null===c||void 0===c?void 0:c.pinned)?5:1,minWidth:p+"px"}},o.a.createElement("input",{type:"number",min:0,max:r.qty_available,value:(null===(u=P[s])||void 0===u?void 0:u[n])||"",placeholder:r.qty_available?r.qty_available+" available":"",onChange:t=>{let a=t.target.value;if(""===a)return void I(e=>({...e,[s]:{...e[s],[n]:""}}));let o=Number(a);o<0&&(o=0),void 0!==r.qty_available&&o>r.qty_available&&(o=r.qty_available),I(e=>({...e,[s]:{...e[s],[n]:o}}));const d=e.map((e,t)=>{var a;return{...e,sell_qty:t===n?String(o):(null===(a=P[s])||void 0===a?void 0:a[t])||""}});i({...l,active_orders_with_qty:d})},style:{width:"100%",fontSize:"0.8rem"}}));if(c){if("list"===c.dtype){var m;const e=c.values||[];return o.a.createElement("td",{key:s,style:{backgroundColor:a(s,n,r),position:c.pinned?"sticky":"relative",left:c.pinned?t(d)+"px":"auto",zIndex:c.pinned?5:1,minWidth:p+"px"}},o.a.createElement("select",{value:(null===(m=P[s])||void 0===m?void 0:m[n])||"",onChange:e=>{const t=e.target.value;I(e=>({...e,[s]:{...e[s],[n]:t}}))},style:{width:"100%",fontSize:"0.8rem",padding:"4px"}},o.a.createElement("option",{value:"",disabled:!0},"Select..."),e.map((e,t)=>o.a.createElement("option",{key:t,value:e},e))))}var f,g,b,y;return"checkbox"===c.dtype?o.a.createElement("td",{key:s,style:{backgroundColor:a(s,n,r),position:c.pinned?"sticky":"relative",left:c.pinned?t(d)+"px":"auto",zIndex:c.pinned?5:1,minWidth:p+"px"}},o.a.createElement("input",{type:"checkbox",checked:!!(null===(f=P[s])||void 0===f?void 0:f[n]),onChange:e=>{const t=e.target.checked;I(e=>({...e,[s]:{...e[s],[n]:t}}))}})):"number"===c.dtype||"float"===c.dtype||"int"===c.dtype?o.a.createElement("td",{key:s,style:{backgroundColor:a(s,n,r),position:c.pinned?"sticky":"relative",left:c.pinned?t(d)+"px":"auto",zIndex:c.pinned?5:1,minWidth:p+"px"}},o.a.createElement("input",{type:"number",value:(null===(g=P[s])||void 0===g?void 0:g[n])||"",onChange:e=>{const t=e.target.value;I(e=>({...e,[s]:{...e[s],[n]:t}}))},style:{width:"100%",fontSize:"0.8rem"}})):"datetime"===c.dtype?o.a.createElement("td",{key:s,style:{backgroundColor:a(s,n,r),position:c.pinned?"sticky":"relative",left:c.pinned?t(d)+"px":"auto",zIndex:c.pinned?5:1,minWidth:p+"px"}},o.a.createElement("input",{type:"datetime-local",value:(null===(b=P[s])||void 0===b?void 0:b[n])||"",onChange:e=>{const t=e.target.value;I(e=>({...e,[s]:{...e[s],[n]:t}}))},style:{width:"100%",fontSize:"0.8rem"}})):o.a.createElement("td",{key:s,style:{backgroundColor:a(s,n,r),position:c.pinned?"sticky":"relative",left:c.pinned?t(d)+"px":"auto",zIndex:c.pinned?5:1,minWidth:p+"px"}},o.a.createElement("input",{type:"text",value:(null===(y=P[s])||void 0===y?void 0:y[n])||"",onChange:e=>{const t=e.target.value;I(e=>({...e,[s]:{...e[s],[n]:t}}))},style:{width:"100%",fontSize:"0.8rem"}}))}return o.a.createElement("td",{key:s,style:{minWidth:p+"px"}},r&&void 0!==r[s]?"number"===typeof r[s]?Number(r[s]).toLocaleString(void 0,{maximumFractionDigits:2}):String(r[s]):"")})))),o.a.createElement("tfoot",null,o.a.createElement("tr",null,U.map(t=>{try{const a=e.reduce((e,a)=>{const r=a[t];return"number"!==typeof r||isNaN(r)?e:e+r},0),r=e.some(e=>"number"===typeof e[t]&&!isNaN(e[t]));return o.a.createElement("td",{key:t,style:{fontWeight:"bold",background:"#f7f7f7"}},r?a.toLocaleString(void 0,{maximumFractionDigits:2}):"")}catch(a){return o.a.createElement("td",{key:t})}})))))})()))),o.a.createElement("div",{className:"modal-footer d-flex justify-content-center",style:{position:"sticky",bottom:0,backgroundColor:"#fff",zIndex:20,boxShadow:"0 -2px 10px rgba(0,0,0,0.1)",padding:"12px"}},o.a.createElement("button",{type:"button",className:"btn btn-primary mx-2",onClick:async()=>{if(!w&&!d){c(!0),w=!0;try{const e=S&&_&&Array.isArray(_[S])?_[S]:[];if(!e||!Array.isArray(e))return void s.error("No editable orders found for this action.");const t=e.map((e,t)=>{let a={};return H.forEach(r=>{var o,n,l;a[r.col_header]=null!==(o=null!==(n=null===(l=P[r.col_header])||void 0===l?void 0:l[t])&&void 0!==n?n:e[r.col_header])&&void 0!==o?o:""}),{...e,...a}}),r={username:n.username,prod:n.prod,selected_row:n.selectedRow,default_value:l,editable_orders:t,...n.kwargs},{data:o}=await m.a.post(n.button_api,r),{status:i,data:d,description:c}=o;"success"===i?d&&"fade"===d.message_type?s.success(c,"Success"):alert("Success!\nDescription: "+c):d&&"fade"===d.message_type?s.error(c,"Error"):alert("Error!\nDescription: "+c),!1!==(null===d||void 0===d?void 0:d.close_modal)&&a()}catch(e){console.log("error :>> ",e),s.error(e.message)}c(!1),w=!1}},ref:q},d?o.a.createElement("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"}):"Ok"),o.a.createElement("button",{type:"button",className:"btn btn-secondary mx-2",onClick:a},"Cancel"))))},E=(a(132),a(138));a(137),a(133);function k(e,t,a){return Object.keys(e).reduce((r,o)=>a.includes(o)?(r[o]=e[o],r):(r[o]=t(e[o]),r),{})}function S(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const r=e=>null!==e&&"object"===typeof e?S(e,t):t(e);return Array.isArray(e)?e.map(r):"object"===typeof e?k(e,r,a):e}const C=()=>{};console.error;let R=[],N=null;function O(e,t){try{let a=new Date(e);return Object(f.a)(a,t)}catch{return e}}function F(e,t){let a=Number.parseFloat(e);return Number.isNaN(a)?e:t+a.toFixed(2)}function A(e,t){let a=Number.parseFloat(e);return Number.isNaN(a)?e:a.toFixed(t)}const D=e=>{const t=e.column.colDef.linkField,a=e.column.colDef.baseURL,r=e.data&&t?e.data[t]:null;return r&&a?o.a.createElement("a",{href:`${a}/${r}`,target:"_blank",rel:"noopener noreferrer"},e.value):o.a.createElement("span",null,e.value)};c.a.options={positionClass:"toast-top-full-width",hideDuration:300,timeOut:3e3};var W=e=>{const t=e=>{if(!e||!e.node)return null;if("bottom"===e.node.rowPinned)return o.a.createElement("span",null,e.value);const t=e.data&&e.col_header&&e.data[e.col_header+"_cellStyle"]?e.data[e.col_header+"_cellStyle"]:e.cellStyle;return o.a.createElement("button",{onClick:()=>{e.clicked(e.node.id)},style:{background:"transparent",border:(null===t||void 0===t?void 0:t.border)||"none",width:e.width?e.width:"100%",color:(null===t||void 0===t?void 0:t.color)||"inherit",...t}},e.col_header?e.value:e.buttonName)};function a(e,t){const r={...e,masterDetail:!0};return r.getDetailRowData=e=>{let t=[];Array.isArray(e.data.nestedRows)?t=e.data.nestedRows:e.data.nestedRows&&(t=[e.data.nestedRows]),e.successCallback(t.length?t:[])},r.detailCellRendererParams&&r.detailCellRendererParams.detailGridOptions&&(r.detailCellRendererParams.detailGridOptions=a(r.detailCellRendererParams.detailGridOptions,t+1)),r}const n=Object(r.useRef)(null),{username:l,api:d,api_update:p,api_ws:u,refresh_sec:f,refresh_cutoff_sec:b=0,prod:y=!0,index:x,enable_JsCode:v,kwargs:h}=e;let{grid_options:w={}}=e;v&&(w=S(w,he,["rowData"]));let{buttons:k,toggle_views:W,api_key:j,api_lastmod_key:z=null,columnOrder:T=[],refresh_success:M=null,filter_button:P=""}=h;const[I,H]=Object(r.useState)([]),[B,L]=Object(r.useState)(!1),[Y,U]=Object(r.useState)({}),[q,G]=Object(r.useState)(""),[J,$]=Object(r.useState)(0),[V,K]=Object(r.useState)(null),[X,Q]=Object(r.useState)(89),[Z,ee]=Object(r.useState)(null),[te,ae]=Object(r.useState)([]),[re,oe]=Object(r.useState)(null),[ne,le]=Object(r.useState)(null);Object(r.useEffect)(()=>{if(!h.api_ws)return void C("\u26a0\ufe0f  api_ws is undefined, WebSocket not started.");C("\ud83d\udd0c Attempting WebSocket connection to:",h.api_ws);let e,t,a=null,r=!1,o=0;const i=()=>{try{a=new WebSocket(h.api_ws),a.onopen=()=>{var e;C("\u2705 WebSocket connected!"),o=0;const t={username:l,toggle_view_selection:W?W[J]:"queen",api_key:j,prod:y};C("\ud83d\udce4 Sending handshake:",t),null===(e=a)||void 0===e||e.send(JSON.stringify(t)),s()},a.onmessage=e=>{C("\ud83d\udce5 WebSocket message received");try{const r=JSON.parse(e.data);if("pong"===r.type)return void C("\ud83d\udc93 Heartbeat acknowledged");if("connection_established"===r.type)return void C("Handshake confirmed:",r.message,y);if(Array.isArray(r)&&r.length>0){const e=[];var t,a;if(r.forEach(t=>{var a;let{row_id:r,updates:o}=t;const l=null===(a=n.current)||void 0===a?void 0:a.api.getRowNode(r);if(l&&l.data){const t={...l.data};Object.keys(o).forEach(e=>{t[e]=o[e]}),t[x]=r,e.push(t)}else C("\u26a0\ufe0f  Row not found for update:",r)}),e.length>0)null===(t=n.current)||void 0===t||t.api.applyTransaction({update:e}),C(`\u2705 Updated ${e.length} rows`),(null===(a=n.current)||void 0===a?void 0:a.api)&&ce(n.current.api)}}catch(r){console.error("\u274c Error processing WebSocket message:",r)}},a.onerror=e=>{console.error("\u274c WebSocket error:",e),d()},a.onclose=t=>{C("\ud83d\udd0c WebSocket closed:",{code:t.code,reason:t.reason,wasClean:t.wasClean}),d(),r||(o<10?(o++,C(`\ud83d\udd04 Reconnect attempt ${o}/10 in 3s...`),e=setTimeout(()=>{C("\ud83d\udd04 Reconnecting WebSocket..."),i()},3e3)):(console.error("\u274c Max reconnection attempts reached. Please refresh the page."),c.a.error("WebSocket connection lost. Please refresh the page.")))}}catch(t){console.error("\u274c Error creating WebSocket:",t),d()}},s=()=>{d(),t=setInterval(()=>{if(a&&a.readyState===WebSocket.OPEN){C("\ud83d\udc93 Sending heartbeat ping...");try{a.send(JSON.stringify({type:"ping"}))}catch(e){console.error("\u274c Failed to send heartbeat:",e),d()}}else console.warn("\u26a0\ufe0f  WebSocket not open during heartbeat"),d(),!r&&o<10&&(C("\ud83d\udd04 Connection lost, attempting to reconnect..."),i())},3e5)},d=()=>{t&&(clearInterval(t),t=void 0)};return i(),()=>{C("\ud83e\uddf9 Cleaning up WebSocket connection"),r=!0,d(),clearTimeout(e),a&&a.readyState===WebSocket.OPEN&&a.close()}},[h.api_ws,x,J,l,j]);Object(r.useEffect)(()=>{var e;i.a.setFrameHeight(),k.length&&(k=S(k,he,["rowData"]),k.forEach(e=>{const{prompt_field:a,prompt_message:r,button_api:o,prompt_order_rules:i,col_header:s,col_headername:d,col_width:p,pinned:u,button_name:f,border_color:g,border:b,add_symbol_row_info:v,display_grid_column:_,editableCols:E,...k}=e;let S=e.filterParams||{};h.filter_apply&&(S={...S,buttons:["apply","reset"]}),w.columnDefs.push({...k,field:s||x,headerName:d,width:p,pinned:u,cellRenderer:t,filterParams:S,cellRendererParams:{col_header:s,buttonName:f,borderColor:g,border:b,filterParams:S,cellStyle:e.cellStyle,...e.cellRendererParams||{},clicked:async function(e){try{var t;const s=null===(t=n.current)||void 0===t?void 0:t.api.getRowNode(e);if(!(null===s||void 0===s?void 0:s.data))return console.error("\u274c Could not find fresh row data for:",e),void c.a.error("Could not load row data");const d=s.data;if(i){const e=d[a],t="string"===typeof e?JSON.parse(d[a].replace(/'/g,'"').replace(/\n/g,"").replace(/\s/g,"").replace(/False/g,"false").replace(/True/g,"true")):e;L(!0),U({gridRef:n,index:x,prompt_message:r,button_api:o,username:l,prod:y,selectedRow:d,kwargs:h,prompt_field:a,prompt_order_rules:i,selectedField:t,add_symbol_row_info:v,display_grid_column:_,editableCols:E});const s={};i.forEach(e=>{s[e]=t[e]}),G(s)}else a&&r?(L(!0),U({gridRef:n,index:x,prompt_message:r,button_api:o,username:l,prod:y,selectedRow:d,kwargs:h}),G(d[a]),L(!0)):(window.confirm(r)&&await m.a.post(o,{username:l,prod:y,selected_row:d,...h}),c.a.success("Success!"))}catch(s){alert(""+s)}}}})})),T.length>0&&w.columnDefs&&w.columnDefs.sort((e,t)=>-1!==T.indexOf(e.field)&&-1!==T.indexOf(t.field)?T.indexOf(e.field)-T.indexOf(t.field):-1===T.indexOf(e.field)?1:-1===T.indexOf(t.field)?-1:0),(null===(e=n.current)||void 0===e?void 0:e.api)&&n.current.api.refreshHeader()},[k,w.columnDefs]);const ie=async()=>{const e=await se();return!1!==e&&(H(e),R=e,!0)};Object(r.useEffect)(()=>{xe()},[J]);const se=async()=>{try{let e=W?W[J]:"none";if(!await(async(e,t)=>e!==t&&(Q(e),!0))(J,X)&&f&&f>0){if(!await(async()=>{try{if(null===z)return C("api key is null, returning false"),!0;if(null!==z&&void 0!==z){var e;const t=d.split("/").slice(0,-1).join("/"),a=await m.a.get(t+"/lastmod_key",{params:{api_key:j,client_user:l,prod:y,api_lastmod_key:z}});return(null===(e=a.data)||void 0===e?void 0:e.lastModified)!==V&&(K(a.data.lastModified),!0)}return!1}catch(t){return c.a.error("Failed to check last modified: "+t.message),!1}})())return!1}C("fetching data...",d);const t=await m.a.post(d,{username:l,prod:y,...h,toggle_view_selection:e});return JSON.parse(t.data)}catch(e){return c.a.error("Fetch Error: "+e.message),!1}};Object(r.useEffect)(()=>{if(!u&&f&&f>0){C("\ud83d\udce1 Starting polling (no WebSocket available)");const e=setInterval(ie,1e3*f);let t;return b>0&&(t=setTimeout(()=>{clearInterval(e),C("\u23f9\ufe0f Polling stopped (cutoff reached)")},1e3*b)),()=>{clearInterval(e),t&&clearTimeout(t)}}u&&C("\ud83d\udd0c WebSocket active, polling disabled")},[u,f,b,e,J]);const de=Object(r.useCallback)(e=>{var t;const a=[],r=n.current.columnApi,o=(null===(t=w)||void 0===t?void 0:t.columnDefs)||[];r.getColumns().forEach(e=>{const t=o.find(t=>t.field===e.getColDef().field);t&&void 0!==t.initialWidth||a.push(e.getId())}),r.autoSizeColumns(a,e)},[]),ce=(Object(r.useCallback)(()=>{n.current.api.sizeColumnsToFit({defaultMinWidth:100})},[]),Object(r.useCallback)(e=>{if(!h.subtotal_cols||0===h.subtotal_cols.length||!e)return;let t=[];e.forEachNodeAfterFilterAndSort(e=>{e.data&&!e.rowPinned&&t.push(e.data)});let a={[x]:"Totals"};h.subtotal_cols.forEach(r=>{const o=t.reduce((e,t)=>{let a=t[r];if(void 0===a||null===a||""===a)return e;if("string"===typeof a){const e=a.match(/(buy|sell)\(\d+\)\s*\$([0-9,.\-]+)/i);e&&e[2]?a=e[2].replace(/,/g,""):(a=a.replace(/[$,]/g,""),a.includes("%")&&(a=a.replace(/%/g,"")),a=a.replace(/[^0-9.\-]/g,""))}const o=Number(a);return e+(isNaN(o)?0:o)},0);if(isNaN(o)||!isFinite(o))return void(a[r]="");const n=e.getColumnDef(r),l=n&&(n.valueFormatter||n.type);a[r]=l?o:o.toLocaleString("en-US")});const r=w.pinnedTopRowData&&w.pinnedTopRowData.length>0;w.pinnedBottomRowData&&w.pinnedBottomRowData.length;r?e.setPinnedTopRowData([a]):e.setPinnedBottomRowData([a])},[h.subtotal_cols,x,w])),pe=Object(r.useCallback)(async e=>{setTimeout(async()=>{try{C("websocket api is",u,h.api_ws);const t=await se();if(!1===t)return;H(t),R=t,h.subtotal_cols&&h.subtotal_cols.length>0&&ce(e.api),de(!0),e.columnApi&&oe(e.columnApi.getColumnState())}catch(t){c.a.error("Error: "+t.message)}},100)},[]),ue=Object(r.useMemo)(()=>({minWidth:200}),[]),me=Object(r.useMemo)(()=>e=>String(e.data[x]),[x]),fe=Object(r.useMemo)(()=>({toolPanels:[{id:"columns",labelDefault:"Columns",labelKey:"columns",iconKey:"columns",toolPanel:"agColumnsToolPanel"},{id:"filters",labelDefault:"Filters",labelKey:"filters",iconKey:"filter",toolPanel:"agFiltersToolPanel"}],defaultToolPanel:"customStats"}),[]),ge=Object(r.useCallback)(async t=>{if(e.autoUpdate)try{const e=t.data;C("Auto-updating row:",e);200===(await m.a.post(p,{username:l,prod:y,updated_row:e,...h})).status?c.a.success("Row updated successfully!"):c.a.error("Failed to update row.")}catch(a){a&&"object"===typeof a&&"message"in a?c.a.error("Error updating row: "+a.message):c.a.error("Error updating row: "+String(a))}else null===N&&(N={}),N[t.data[x]]=t.data,C("Data after change is",N)},[e.autoUpdate,p,l,y,h,x]),[be,ye]=Object(r.useState)(!1),xe=(Object(r.useRef)(null),async()=>{ye(!0);try{const e=await ie();M&&e&&c.a.success("Refresh success!")}catch(e){c.a.error("Refresh Failed! "+e.message)}finally{ye(!1)}}),ve=Object(r.useMemo)(()=>({dateColumnFilter:{filter:"agDateColumnFilter",filterParams:{comparator:(e,t)=>Object(E.a)(new Date(t),e)}},numberColumnFilter:{filter:"agNumberColumnFilter"},shortDateTimeFormat:{valueFormatter:e=>O(e.value,"dd/MM/yyyy HH:mm")},customDateTimeFormat:{valueFormatter:e=>O(e.value,e.column.colDef.custom_format_string)},customNumericFormat:{valueFormatter:e=>{var t;return A(e.value,null!==(t=e.column.colDef.precision)&&void 0!==t?t:2)}},customCurrencyFormat:{valueFormatter:e=>F(e.value,e.column.colDef.custom_currency_symbol)},timedeltaFormat:{valueFormatter:e=>Object(g.duration)(e.value).humanize(!0)},customNumberFormat:{valueFormatter:e=>Number(e.value).toLocaleString("en-US",{minimumFractionDigits:0})},customHyperlinkRenderer:{cellRenderer:D,cellRendererParams:{baseURL:"URLSearchParams.co"}}}),[]);function he(e){let t=new RegExp("::JSCODE::\\s*((function|class)\\s*.*)\\s*::JSCODE::").exec(e);if(t){const e=t[1];return new Function("return "+e)()}return e}const we=(_e=W.length)<3?{padding:"15px 18px",fontSize:"18px"}:_e<8?{padding:"15px 18px",fontSize:"15px"}:_e<15?{padding:"12px 13px",fontSize:"13px"}:_e<35?{padding:"10px 12px",fontSize:"11px"}:{padding:"3px 5px",fontSize:"10px"};var _e;const Ee=Object(r.useMemo)(()=>((e,t)=>Array.from(new Set(t.map(t=>t[e]))).filter(e=>void 0!==e&&null!==e))(P,I),[I,P]);return o.a.createElement(o.a.Fragment,null,h.show_cell_content&&ne&&o.a.createElement("div",{style:{position:"absolute",top:"10px",right:"10px",background:"white",border:"1px solid #ddd",borderRadius:"8px",padding:"10px",boxShadow:"0 2px 6px rgba(0, 0, 0, 0.1)",zIndex:1e3,maxWidth:"300px",maxHeight:"200px",overflow:"auto",width:"fit-content"}},o.a.createElement("p",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word"}},ne),o.a.createElement("button",{onClick:()=>le(null),style:{background:"#3498db",color:"white",border:"none",borderRadius:"2px",padding:"3px 5px",cursor:"pointer"}},o.a.createElement("h5",{style:{fontSize:"8px",margin:"0 0 6px 0"}},"x"))),W&&W.length>0&&o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{style:{fontWeight:"bold",color:"#055A6E",marginBottom:"4px",fontSize:"15px"}},h.toggle_header?h.toggle_header:""),W.length<20?o.a.createElement("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px",padding:"10px",marginBottom:"10px"}},W.map((e,t)=>o.a.createElement("button",{key:t,className:"btn "+(J===t?"btn-danger":"btn-secondary"),style:{...we,borderRadius:"8px",color:"#055A6E",backgroundColor:"#F3FAFD",fontWeight:"bold"},onClick:()=>{$(t),Q(J)},disabled:be},e,be&&J===t?o.a.createElement("div",{style:{width:"14px",height:"14px",border:"2px solid black",borderTop:"2px solid transparent",borderRadius:"50%",animation:"spin 0.8s linear infinite",marginLeft:"8px"}}):null))):o.a.createElement("div",{className:"toggle-view-container",style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(100px, 1fr))",gap:"10px",overflowY:"auto",maxHeight:"200px",padding:"10px",border:"1px solid #ddd",borderRadius:"8px",backgroundColor:"#eef9f8",width:"100%",marginBottom:"10px"}},W.map((e,t)=>o.a.createElement("button",{key:t,className:"btn "+(J===t?"btn-danger":"btn-secondary"),style:{...we,borderRadius:"8px",color:"#055A6E",backgroundColor:"#F3FAFD",fontWeight:"bold"},onClick:()=>{$(t),Q(J)},disabled:be},e,be&&J===t?o.a.createElement("div",{style:{width:"14px",height:"14px",border:"2px solid black",borderTop:"2px solid transparent",borderRadius:"50%",animation:"spin 0.8s linear infinite",marginLeft:"8px"}}):null)))),o.a.createElement(_,{isOpen:B,closeModal:()=>L(!1),modalData:{...Y,index:x,gridRef:n},promptText:q,setPromptText:G,toastr:c.a}),o.a.createElement("div",{style:{flexDirection:"row",height:"100%",width:"100%"},id:"myGrid"},o.a.createElement("div",{className:"d-flex justify-content-between align-items-center"},!h.api_ws&&(void 0==f||0==f)&&o.a.createElement("div",{style:{display:"flex"}},o.a.createElement("div",{style:{margin:"5px 5px 5px 2px"}},o.a.createElement("button",{className:"btn",style:{backgroundColor:"#3498db",color:"white",padding:"2px 5px",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"50px"},onClick:xe,title:"Refresh",disabled:be},be?o.a.createElement("div",{style:{width:"12px",height:"12px",border:"2px solid white",borderTop:"2px solid transparent",borderRadius:"50%",animation:"spin 0.8s linear infinite"}}):o.a.createElement("span",{style:{fontSize:"25px",lineHeight:"1"}},"\u27f3")),o.a.createElement("style",null,"\n                    @keyframes spin {\n                      to {\n                        transform: rotate(360deg);\n                      }\n                    }\n                  ")),!e.autoUpdate&&o.a.createElement("div",{style:{margin:"5px 5px 5px 2px"}},o.a.createElement("button",{className:"btn",style:{backgroundColor:"green",color:"white",padding:"5px 8px",fontSize:"12px",borderRadius:"4px",display:"flex",alignItems:"center",gap:"6px"},onClick:async()=>{if(null!==N)try{const e=await m.a.post(p,{username:l,prod:y,new_data:N,...h});N=null,e.status?c.a.success("Successfully Updated! "):c.a.error("Failed! "+e.message)}catch(e){c.a.error("Failed! "+e)}else c.a.warning("No changes to update")},title:"Update"},o.a.createElement("span",{style:{fontSize:"18px",lineHeight:"1"}},"\u2191"))))),o.a.createElement("div",{className:w.theme||"ag-theme-alpine-dark",style:{width:"100%",height:h.grid_height?h.grid_height:"100%"}},h.column_sets&&o.a.createElement("div",{style:{marginBottom:12,display:"flex",gap:"8px",alignItems:"center",flexWrap:"wrap"}},o.a.createElement("button",{onClick:()=>{ae([]),setTimeout(()=>{var e;const t=null===(e=n.current)||void 0===e?void 0:e.columnApi;t&&re&&t.applyColumnState({state:re,applyOrder:!0})},0)},style:{background:"rgb(194, 194, 194)",color:"white",border:"1.5px solid rgb(213, 213, 213)",borderRadius:"6px",fontWeight:"bold",fontSize:"12px",padding:"5px 10px",margin:"0 4px 4px 0",boxShadow:"0 2px 6px rgb(216, 216, 216)",transition:"all 0.15s",cursor:"pointer"}},"Reset Columns"),Object.keys(h.column_sets).map(e=>o.a.createElement("button",{key:e,onClick:()=>{ae(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e]),setTimeout(()=>{var t;const a=te.includes(e)?te.filter(t=>t!==e):[...te,e],r=Array.from(new Set(a.flatMap(e=>h.column_sets[e]))),o=null===(t=n.current)||void 0===t?void 0:t.columnApi;o&&Array.isArray(w.columnDefs)&&(w.columnDefs.forEach(e=>{o.setColumnVisible(e.field,r.includes(e.field))}),r.forEach((e,t)=>{o.moveColumn(e,t)}))},0)},style:{background:te.includes(e)?"#3498db":"#F3FAFD",color:te.includes(e)?"white":"#055A6E",border:te.includes(e)?"2px solid #1abc9c":"1px solid #ddd",borderRadius:"6px",fontWeight:"bold",fontSize:"12px",padding:"5px 10px",margin:"0 4px 4px 0",boxShadow:te.includes(e)?"0 2px 6px rgba(52,152,219,0.10)":"none",transition:"all 0.15s",cursor:"pointer"}},e))),h.streaming_list_text&&Array.isArray(h.streaming_list_text)&&o.a.createElement("div",{style:{width:"100%",background:"#F3FAFD",color:"#055A6E",padding:"4px 10px",fontSize:"13px",borderBottom:"1px solid #ddd",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",marginBottom:"4px",fontWeight:"bold"}},o.a.createElement("div",{style:{display:"block",width:"100%",whiteSpace:"nowrap",overflow:"hidden",position:"relative"}},o.a.createElement("div",{style:{display:"inline-block",paddingLeft:"100%",animation:"scroll-left 40s linear infinite"}},h.streaming_list_text.join("   |   ")),o.a.createElement("style",null,"\n                @keyframes scroll-left {\n                  0% {\n                  transform: translateX(0%);\n                  }\n                  100% {\n                  transform: translateX(-100%);\n                  }\n                }\n                "))),h.filter_button&&""!==h.filter_button&&o.a.createElement("div",{style:{marginBottom:8}},h.show_clear_all_filters&&o.a.createElement("button",{onClick:()=>{n.current&&n.current.api&&n.current.api.setFilterModel({}),ee(null)},style:{background:"rgb(194, 194, 194)",color:"white",border:"1.5px solid rgb(213, 213, 213)",borderRadius:"6px",fontWeight:"bold",fontSize:"12px",padding:"5px 10px",margin:"0 4px 4px 0",boxShadow:"0 2px 6px rgb(216, 216, 216)",transition:"all 0.15s",cursor:"pointer"}},"Clear Filters"),Ee.map(e=>o.a.createElement("button",{key:e,onClick:()=>(e=>{if(ee(e),n.current&&n.current.api){const t=n.current.api;if(e)t.setFilterModel({...t.getFilterModel(),[P]:{filterType:"set",values:[e]}});else{const e=t.getFilterModel();delete e[P],t.setFilterModel(e)}}})(e),style:{background:Z===e?"#3498db":"#F3FAFD",color:Z===e?"white":"#055A6E",border:Z===e?"2px solid #1abc9c":"1px solid #ddd",borderRadius:"6px",fontWeight:"bold",fontSize:"12px",padding:"5px 10px",margin:"0 4px 4px 0",boxShadow:Z===e?"0 2px 6px rgba(52,152,219,0.10)":"none",transition:"all 0.15s",cursor:"pointer"}},e))),o.a.createElement(s.AgGridReact,{ref:n,rowData:I,getRowStyle:e=>{try{var t,a;const r=null!==(t=e.data.color_row)&&void 0!==t?t:void 0;return{background:r,color:null!==(a=e.data.color_row_text)&&void 0!==a?a:void 0}}catch(r){return void console.error("Error accessing row style:",r)}},headerHeight:30,rowHeight:30,onGridReady:pe,autoGroupColumnDef:ue,animateRows:!0,suppressAggFuncInHeader:!0,getRowId:me,gridOptions:(()=>{let e={...w};return h.nestedGridEnabled&&h.detailGridOptions?(e.masterDetail=!0,e.detailCellRendererParams={detailGridOptions:a(h.detailGridOptions,1),getDetailRowData:e=>{let t=[];Array.isArray(e.data.nestedRows)?t=e.data.nestedRows:e.data.nestedRows&&(t=[e.data.nestedRows]),e.successCallback(t.length?t:[])}}):(e.masterDetail=!1,e.detailCellRendererParams=void 0),e})(),onCellValueChanged:ge,columnTypes:ve,sideBar:!1!==w.sideBar&&fe,onCellClicked:e=>{e.value&&le(e.value)}}))))};var j=Object(i.b)(e=>{const{username:t,api:a,api_update:r,refresh_sec:n,refresh_cutoff_sec:l,gridoption_build:i,enable_JsCode:s,prod:d,autoUpdate:c=!1}=e.args,{grid_options:p,kwargs:u={}}=e.args,{index:m,theme:f}=p;return o.a.createElement("div",null,o.a.createElement(W,{username:t,api:a,api_update:r,refresh_sec:n,refresh_cutoff_sec:l,gridoption_build:i,prod:d,grid_options:p,index:m,kwargs:u,enable_JsCode:s,autoUpdate:c}))});l.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(j,null)),document.getElementById("root"))},56:function(e,t,a){e.exports=a(134)}},[[56,1,2]]]);
//# sourceMappingURL=main.05a9fc9c.chunk.js.map