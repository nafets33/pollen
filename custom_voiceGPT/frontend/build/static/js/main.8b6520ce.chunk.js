(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{21:function(e,t,n){e.exports=n(41)},33:function(e,t,n){},41:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),l=n(17),i=n.n(l),o=n(10),s=n(53),c=n(5),d=n.n(c);var p=e=>{let{commands:t,myFunc:n,listenAfterReply:l=!1,no_response_time:i=3,apiInProgress:o=!1,listenButton:s=!1,session_listen:d=!1}=e;const{finalTranscript:p,interimTranscript:g,resetTranscript:u,listening:m,browserSupportsSpeechRecognition:b,isMicrophoneAvailable:h}=Object(c.useSpeechRecognition)(),[x,f]=Object(a.useState)(""),[y,E]=Object(a.useState)(!0),v=Object(a.useRef)(null),w=Object(a.useRef)(null);Object(a.useEffect)(()=>{(()=>{if(""!==p){if(s)return n(p,{api_body:{}},5),f(e=>`${e} ${p}`.trim()),void f("");if(d){let e=!1;for(let a=0;a<t.length;a++){const{keywords:r,api_body:l}=t[a];for(let i=0;i<r.length;i++){const l=new RegExp(r[i],"i");if(-1!==p.search(l)&&!o)return console.log(`Keyword found: ${r[i]}`),n(p,t[a],1),u(),f(""),void(e=!0)}}e||(f(e=>`${e} ${p}`.trim()),u())}else v.current&&(w.current=v.current.selectionStart),console.log("Recording speech-to-text without keyword triggers"),f(e=>`${e} ${p}`.trim()),u()}})()},[p]);return Object(a.useEffect)(()=>{v.current&&null!==w.current&&(v.current.selectionStart=w.current,v.current.selectionEnd=w.current,w.current=null)},[x]),b?h?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{display:"flex",gap:"10px",marginBottom:"10px"}},r.a.createElement("button",{onClick:()=>{n(x,{api_body:{}},5),u(),f("")},style:{backgroundColor:"rgb(196, 230, 252)",color:"black",border:"none",padding:"10px 20px",borderRadius:"5px",cursor:"pointer"}},"Send Transcript"),r.a.createElement("button",{onClick:()=>E(e=>!e),style:{backgroundColor:"white",color:"grey",border:"none",padding:"10px 20px",borderRadius:"5px",cursor:"pointer"}},y?"Hide Transcript":"Show Transcript"),r.a.createElement("button",{onClick:()=>{u(),f("")},style:{backgroundColor:"white",color:"grey",border:"none",padding:"10px 20px",borderRadius:"5px",cursor:"pointer"}},"Clear Transcript")),y&&r.a.createElement("div",{style:{display:"flex",flexDirection:"column",maxHeight:"800px",height:"550px",overflowY:"auto",border:"1px solid #ccc",padding:"10px"}},r.a.createElement("span",null,r.a.createElement("strong",null,"Listening:")," ",m?"on":"off"),r.a.createElement("span",null,r.a.createElement("strong",null,"Transcript:")),g&&r.a.createElement("div",{style:{color:"#888",fontStyle:"italic",marginBottom:"8px"}},g),r.a.createElement("textarea",{ref:v,value:x,onChange:e=>{f(e.target.value)},style:{backgroundColor:"rgb(238, 242, 245)",color:"black",width:"100%",height:"550px",border:"1px solid #ccc",padding:"5px",resize:"none"}}))):r.a.createElement("span",null,"Please allow access to the microphone"):r.a.createElement("span",null,"No browser support")};var g=e=>{let{showImage:t,imageSrc:n,largeHeight:a=100,largeWidth:l=100,smallHeight:i=40,smallWidth:o=40}=e;const s=t?a:i,c=t?l:o;return r.a.createElement("div",{className:"p-2",style:{display:"flex",flexDirection:"column",alignItems:"center"}},r.a.createElement("div",{style:{display:"flex",justifyContent:"center",width:"100%"}},n&&(n.toLowerCase().endsWith(".mp4")?r.a.createElement("video",{style:{maxWidth:"100%",borderRadius:"8px",objectFit:"cover"},height:s,width:c,controls:t,autoPlay:!0,loop:!1,muted:!0},r.a.createElement("source",{src:n,type:"video/mp4"}),"Your browser does not support the video tag."):r.a.createElement("img",{src:n,height:s,width:c,style:{maxWidth:"100%",borderRadius:"8px",objectFit:"cover"},alt:"Media Preview"}))))};n(33);let u=[];var m=e=>{var t;const{api:n,kwargs:l={}}=e,{commands:i,height:o,width:c,show_video:m,input_text:b,no_response_time:h,face_recon:x,api_key:f,refresh_ask:y,self_image:E,api_audio:v,client_user:w,force_db_root:k,before_trigger:S,agent_actions:_}=l,[j,O]=Object(a.useState)(l.self_image),[C,R]=Object(a.useState)(l.self_image),[A,I]=Object(a.useState)(""),[L,T]=Object(a.useState)([]),[W,z]=Object(a.useState)(!1),[H,N]=Object(a.useState)(!1),[$,B]=Object(a.useState)(!1),[F,D]=Object(a.useState)(""),[P,Y]=Object(a.useState)(!1),[M,U]=Object(a.useState)(!1),[J,K]=Object(a.useState)(!1),[G,q]=Object(a.useState)(!0),[Q,V]=Object(a.useState)(!1),[X,Z]=Object(a.useState)(!1),[ee,te]=Object(a.useState)(!1),[ne,ae]=Object(a.useState)(l.before_trigger),re=Object(a.useRef)([]),le=(Object(a.useRef)(!1),Object(a.useRef)(),Object(a.useRef)(),Object(a.useRef)(null)),[ie,oe]=Object(a.useState)(!1),[se,ce]=Object(a.useState)("Click and Ask"),[de,pe]=Object(a.useState)("Listening"),[ge,ue]=Object(a.useState)(!1),[me,be]=Object(a.useState)([]),[he,xe]=Object(a.useState)(l.datatree||{}),[fe,ye]=Object(a.useState)(l.datatree_title||""),[Ee,ve]=Object(a.useState)([]),[we,ke]=Object(a.useState)(0),Se=()=>{"undefined"!==typeof window&&ke(window.innerWidth)};Object(a.useEffect)(()=>{Se()},[]),Object(a.useEffect)(()=>{E&&_e(E)},[E]);const _e=async e=>{try{const n=await s.a.get(`${v}${e}`,{responseType:"blob"}),a=URL.createObjectURL(n.data);O(a),R(e)}catch(t){console.error("Error fetching image data:",t)}},je=()=>{K(!1),d.a.stopListening(),console.log("Stopping Listening, isListening=",J)},Oe=()=>{K(!0),d.a.startListening({continuous:!0,language:"en-GB"})};Object(a.useEffect)(()=>{J?console.log("Listening has started"):console.log("Listening has stopped")},[J]);const Ce=async(e,t,a)=>{I(` (${t.api_body.keyword}) ${e},`);const r=[...u,{user:e}];T([...r]);try{console.log("api call on listen...",t),console.log("selected_nodes",Ee),Y(!0),je();const e={tigger_type:a,api_key:f,text:r,self_image:C,face_data:re.current,refresh_ask:y,client_user:w,force_db_root:k,session_listen:X,before_trigger_vars:ne,selected_actions:me,selected_nodes:Ee};console.log("api");const{data:i}=await s.a.post(n,e);if(console.log("data :>> ",i,e),i.self_image&&i.self_image!==C&&_e(i.self_image),T(i.text),u=[...i.text],le.current&&le.current.pause(),i.audio_path){const e=`${v}${i.audio_path}`;le.current=new Audio(e);try{await le.current.play(),U(!0),pe("Speaking"),await new Promise(e=>{le.current.onended=(()=>{console.log("Audio playback finished."),e()})})}catch(l){console.error("Audio playback error:",l)}finally{le.current=null,U(!1),pe("Listen")}}ce("Click and Ask"),pe("Listening"),U(!1),Y(!1),z(i.listen_after_reply),console.log("listen after reply",i.listen_after_reply,W),!1!==i.page_direct&&null!==i.page_direct&&(console.log("api has page direct",i.page_direct),window.location.href=i.page_direct),ie?oe(!1):1==W?(console.log("API END HIT listenAfterReply==TRUE"),pe("Awaiting your Answer please speak")):Q?V(!1):ee&&(console.log("convo mode"),Oe())}catch(l){console.log("api call on listen failed!",l),Y(!1),V(!1)}Se(),console.log("ReSize Window")};const Re=(null===y||void 0===y?void 0:null===(t=y.color_dict)||void 0===t?void 0:t.background_color_chat)||"transparent",Ae=`Chat with ${E.split(".")[0]}`;console.log("session_listen",X),console.log("selectedNodes",Ee);const Ie=Ee[0]||null,Le=Ie?function e(t,n){if(!t||"object"!==typeof t)return null;for(const[a,r]of Object.entries(t)){if(a===n)return r;if(r.children){const t=e(r.children,n);if(t)return t}}return null}(he,Ie):null,Te=null===Le||void 0===Le?void 0:Le.field_name,We=null===Le||void 0===Le?void 0:Le.hyperlink,[ze,He]=Object(a.useState)(!1),[Ne,$e]=Object(a.useState)(250);return r.a.createElement("div",{style:{display:"flex",width:"100%"}},r.a.createElement("div",{style:{display:"flex",flexDirection:"column"}},r.a.createElement("div",{style:{display:"flex",alignItems:"center",padding:"4px 8px"}},r.a.createElement("button",{onClick:()=>He(e=>!e),style:{fontSize:"18px",padding:"4px 10px",marginRight:"6px",border:"none",borderRadius:"50%",background:"transparent",color:"#2980b9",cursor:"pointer",height:"32px",width:"32px",boxShadow:"none",outline:"none",transition:"background 0.2s"},"aria-label":ze?"Hide Sidebar":"Show Sidebar"},ze?"\u23f4":"\u23f5")),ze&&r.a.createElement("button",{onClick:()=>$e(e=>250===e?450:250),style:{border:"transparent",background:"transparent",cursor:"pointer",height:"15px",margin:"6px 0 0 8px",width:"90px",alignSelf:"flex-start",display:"flex",alignItems:"center",gap:"4px"}},250===Ne?r.a.createElement(r.a.Fragment,null,r.a.createElement("span",{style:{}},"\u23e9")):r.a.createElement(r.a.Fragment,null,r.a.createElement("span",{style:{}},"\u23ea"))),ze&&r.a.createElement("div",{style:{width:Ne,borderRight:"1px solid #ccc",padding:10,transition:"width 0.2s"}},r.a.createElement(e=>{let{datatree:t={},onSelectionChange:n}=e;const[l,i]=Object(a.useState)({}),[o,s]=Object(a.useState)([]);Object(a.useEffect)(()=>{s(Ee)},[Ee]);const c=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(!e||"object"!==typeof e||Array.isArray(e))return null;const d=Object.entries(e);return d.map((e,p)=>{let[g,u]=e;const m=u.children&&"object"===typeof u.children&&!Array.isArray(u.children)&&Object.keys(u.children).length>0,b=l[g],h=p===d.length-1;return r.a.createElement("div",{key:g,style:{marginLeft:16*t,position:"relative",whiteSpace:"nowrap",display:"flex",flexDirection:"column",alignItems:"flex-start",fontSize:"14px",fontFamily:"inherit",marginBottom:"2px",paddingTop:"4px",paddingBottom:"4px"}},t>0&&r.a.createElement("div",{style:{position:"absolute",left:-5,top:0,height:"100%",width:16,zIndex:0}},r.a.createElement("div",{style:{position:"absolute",left:-5,top:0,bottom:h?"50%":0,width:2,background:"#bbb",height:m&&!b?"50%":"100%"}}),r.a.createElement("div",{style:{position:"absolute",left:7,top:12,width:9,height:2,background:"#bbb"}})),r.a.createElement("div",{style:{display:"flex",alignItems:"center",position:"relative",zIndex:1}},m&&r.a.createElement("button",{onClick:()=>(e=>{i(t=>({...t,[e]:!t[e]}))})(g),style:{border:"none",background:"transparent",cursor:"pointer",fontSize:"14px",marginRight:"4px",padding:0,width:"18px",height:"18px",lineHeight:"18px",userSelect:"none"},"aria-label":b?"Expand":"Collapse",tabIndex:-1},b?"\u25b6":"\u25bc"),r.a.createElement("input",{type:"checkbox",checked:o.includes(g),onChange:()=>(e=>{s(t=>{const a=t.includes(e)?t.filter(t=>t!==e):[...t,e];return n&&n(a),a})})(g),style:{marginRight:"10px"}}),u.hyperlink?r.a.createElement("a",{href:u.hyperlink,target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none",color:"#2980b9",fontWeight:500,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%",display:"inline-block",verticalAlign:"middle"},title:u.field_name},u.field_name):r.a.createElement("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"160px",display:"inline-block",verticalAlign:"middle"},title:u.field_name},u.field_name)),m&&!b&&r.a.createElement("div",{style:{width:"100%"}},c(u.children,t+1,[...a,g])))})};return fe&&t?r.a.createElement("div",{style:{width:"100%",padding:10,maxHeight:800,overflowY:"auto",background:"transparent"}},r.a.createElement("h4",{style:{margin:"0 0 8px 0",fontWeight:600}},fe),r.a.createElement("div",null,c(t))):null},{datatree:he,onSelectionChange:ve}))),r.a.createElement("div",{className:"p-2",style:{flex:1}},r.a.createElement("div",null,Ie&&Le?r.a.createElement("div",null,"Working Page:"," ",We?r.a.createElement("a",{href:We,target:"_blank",rel:"noopener noreferrer"},Te):Te):r.a.createElement("div",null)),r.a.createElement("div",{style:{display:"flex",flexDirection:"column",width:"100%"}},r.a.createElement("div",null,r.a.createElement(g,{showImage:ge,imageSrc:j,largeHeight:100,largeWidth:100,smallHeight:40,smallWidth:40})),r.a.createElement("div",{style:{flex:ge?1:"100%",overflowY:"auto",maxHeight:"350px"}},G&&r.a.createElement("div",{style:{display:"flex",flexDirection:"column",maxHeight:"350px",height:"350px",overflowY:"auto",padding:"10px"}},L.map((e,t)=>r.a.createElement("div",{key:t,className:"chat-message-container",style:{marginBottom:"5px",padding:"5px",borderRadius:"4px",border:"1px solid #ccc",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"}},r.a.createElement("div",{className:"chat-user",style:{backgroundColor:"#e4eafe",textAlign:"right",marginLeft:"auto",padding:"5px"}},w,": ",r.a.createElement("span",null,e.user)),r.a.createElement("div",{className:"chat-response-container",style:{display:"flex",alignItems:"flex-start",backgroundColor:Re,padding:"10px"}},j&&r.a.createElement("div",{className:"chat-image",style:{marginRight:"10px"}},r.a.createElement("img",{src:j,alt:"response",style:{width:"50px"}})),r.a.createElement("div",{className:"chat-response-text",style:{flex:1,wordBreak:"break-word"}},e.resp?r.a.createElement("span",{dangerouslySetInnerHTML:{__html:e.resp}}):r.a.createElement("span",{className:"spinner"})))))))),b&&r.a.createElement(r.a.Fragment,null,r.a.createElement("hr",{style:{margin:"3px 0"}}),r.a.createElement("div",{className:"form-group"},r.a.createElement("input",{className:"form-control",type:"text",placeholder:Ae,value:F,onChange:e=>{D(e.target.value),oe(!0)},onKeyDown:e=>{"Enter"===e.key&&(console.log("textString :>> ",F),Ce(F,{api_body:{keyword:""}},4),D(""))}})),r.a.createElement("hr",{style:{margin:"3px 0"}})),r.a.createElement("div",{style:{display:"flex",marginTop:"3px"}},r.a.createElement("div",{style:{flex:1,textAlign:"center"}},r.a.createElement("button",{style:{fontSize:"12px",padding:"5px",margin:"5px 0",backgroundColor:Q?"#478728":"rgb(196, 230, 252)",color:"black",border:"1px solid #2980b9",borderRadius:"4px",cursor:"pointer",width:"89%"},onClick:()=>{V(!0),J||Oe(),ce("Please Speak"),console.log("listening button listen click"),console.log(Q)}},se)),r.a.createElement("div",{style:{flex:1,textAlign:"center"}},r.a.createElement("button",{style:{fontSize:"12px",padding:"5px",margin:"5px 0",backgroundColor:ee?"rgb(87, 188, 100)":"rgb(196, 230, 252)",color:"black",border:"1px solid #2980b9",borderRadius:"4px",cursor:"pointer",width:"89%"},onClick:()=>{console.log("listening?",J),J?(console.log("Stopping listening..."),te(!1),je()):(console.log("Starting to listen..."),te(!0),Oe())}},ee?"End Conversation":"Start Conversation"),J&&r.a.createElement("div",{style:{width:"89%",height:"10px",backgroundImage:"linear-gradient(90deg, green, transparent 50%, green)",animation:"flashLine 1s infinite",marginTop:"5px"}},r.a.createElement("div",{style:{fontSize:"12px",color:"black"}},de)),M&&r.a.createElement("div",{style:{height:"10px",background:"linear-gradient(to right, blue, transparent, purple)",animation:"waveAnimation 1s infinite",marginTop:"5px",borderRadius:"10px"}},r.a.createElement("div",{style:{fontSize:"12px",color:"black"}},"Speaking"))),r.a.createElement("div",{style:{flex:1,textAlign:"center"}},r.a.createElement("button",{style:{fontSize:"12px",padding:"5px",margin:"5px 0",backgroundColor:X?"rgb(250, 234, 131)":"rgb(196, 230, 252)",color:"black",border:"1px solid #2980b9",borderRadius:"1px",cursor:"pointer",width:"89%"},onClick:()=>{Z(!X)}},X?"Stop Session":"Start Session"),X&&r.a.createElement("div",{style:{width:"89%",height:"10px",backgroundImage:"linear-gradient(90deg, orange, transparent 50%, orange)",animation:"flashLine 1s infinite",marginTop:"5px"}},r.a.createElement("div",{style:{fontSize:"12px",color:"black"}},"Session Started")))),Array.isArray(_)&&_.length>0&&r.a.createElement("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"center",marginTop:"8px",gap:"6px"}},_.map((e,t)=>{const n=me.includes(e);return r.a.createElement("button",{key:t,onClick:()=>{be(n?me.filter(t=>t!==e):[...me,e])},style:{fontSize:"12px",padding:"5px 10px",backgroundColor:n?"#1abc9c":"#ecf0f1",color:n?"white":"black",border:"1px solid #bdc3c7",borderRadius:"4px",cursor:"pointer"}},e)})),r.a.createElement("div",{className:"p-2",style:{marginBottom:"15px"}},r.a.createElement(p,{commands:i,myFunc:Ce,listenAfterReply:W,no_response_time:h,apiInProgress:P,listenButton:Q,session_listen:X,listening:J}))))};var b=Object(o.b)(e=>{const{api:t,kwargs:n}=e.args;return Object(a.useEffect)(()=>o.a.setFrameHeight()),r.a.createElement(r.a.Fragment,null,r.a.createElement(m,{api:t,kwargs:n}))}),h=n(54),x=n(20),f=n(52),y=n(42);const E=new h.a;i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(x.a,{value:E},r.a.createElement(f.a,{theme:y.a},r.a.createElement(b,null)))),document.getElementById("root"))}},[[21,1,2]]]);
//# sourceMappingURL=main.8b6520ce.chunk.js.map